<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>软件快捷键</title>
      <link href="/2022/09/28/%E8%BD%AF%E4%BB%B6%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
      <url>/2022/09/28/%E8%BD%AF%E4%BB%B6%E5%BF%AB%E6%8D%B7%E9%94%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="Auto-CAD-常用快捷键"><a href="#Auto-CAD-常用快捷键" class="headerlink" title="Auto CAD 常用快捷键"></a>Auto CAD 常用快捷键</h2><table><thead><tr><th align="left"><strong>1、圆 C</strong></th><th align="left"><strong>19、样条曲线 SPL</strong></th><th align="left"><strong>37、正多边形 POL</strong></th></tr></thead><tbody><tr><td align="left"><strong>2、直线 L</strong></td><td align="left"><strong>20、定距等分 ME</strong></td><td align="left"><strong>38、多行文字 T</strong></td></tr><tr><td align="left"><strong>3、椭圆 EL</strong></td><td align="left"><strong>21、定数等分 DIV</strong></td><td align="left"><strong>39、删除 E</strong></td></tr><tr><td align="left"><strong>4、圆弧 A</strong></td><td align="left"><strong>22、多段线 PL</strong></td><td align="left"><strong>40、偏移 O</strong></td></tr><tr><td align="left"><strong>5、点 PO</strong></td><td align="left"><strong>23、点样式 PT</strong></td><td align="left"><strong>41、复制 CO</strong></td></tr><tr><td align="left"><strong>6、填充 H</strong></td><td align="left"><strong>24、构造线 XL</strong></td><td align="left"><strong>42、旋转 RO</strong></td></tr><tr><td align="left"><strong>7、矩形 REC</strong></td><td align="left"><strong>25、平行线 ML</strong></td><td align="left"><strong>43、圆角 F</strong></td></tr><tr><td align="left"><strong>8、面域 REG</strong></td><td align="left"><strong>26、创建块 B</strong></td><td align="left"><strong>44、合并 J</strong></td></tr><tr><td align="left"><strong>9、插入块 I</strong></td><td align="left"><strong>27、创建边界 BO</strong></td><td align="left"><strong>45、延伸 EX</strong></td></tr><tr><td align="left"><strong>10、缩放 SC</strong></td><td align="left"><strong>28、移动 M</strong></td><td align="left"><strong>46、折弯标注 DJO</strong></td></tr><tr><td align="left"><strong>11、倒斜角 CHA</strong></td><td align="left"><strong>29、修剪 TR</strong></td><td align="left"><strong>47、连续标注 DCO</strong></td></tr><tr><td align="left"><strong>12、标注样式 D</strong></td><td align="left"><strong>30、对齐 AL</strong></td><td align="left"><strong>48、对齐标注 DAL</strong></td></tr><tr><td align="left"><strong>13、拉伸 S</strong></td><td align="left"><strong>31、拉长 LEN</strong></td><td align="left"><strong>49、直径标注 DDI</strong></td></tr><tr><td align="left"><strong>14、镜像 MI</strong></td><td align="left"><strong>32、打断 BR</strong></td><td align="left"><strong>50、弧长标注 DAR</strong></td></tr><tr><td align="left"><strong>15、阵列 AR</strong></td><td align="left"><strong>33、文字样式 ST</strong></td><td align="left"><strong>51、引线标注 LE</strong></td></tr><tr><td align="left"><strong>16、分解 X</strong></td><td align="left"><strong>34、线性标注 DLI</strong></td><td align="left"><strong>52、快速标注QDIM</strong></td></tr><tr><td align="left"><strong>17、移动 M</strong></td><td align="left"><strong>35、半径标注 DRA</strong></td><td align="left"><strong>53、用户坐标 USC</strong></td></tr><tr><td align="left"><strong>18、修剪 TR</strong></td><td align="left"><strong>36、角度标注 DAN</strong></td><td align="left"><strong>54、填充 H</strong></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 快捷键 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux安装</title>
      <link href="/2022/09/03/Linux%E5%AE%89%E8%A3%85/"/>
      <url>/2022/09/03/Linux%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h2 id="系统安装以及设置"><a href="#系统安装以及设置" class="headerlink" title="系统安装以及设置"></a>系统安装以及设置</h2><p>1、当确定按键不在界面中时，按住Alt键就可以用鼠标拖动安装界面。</p><p>2、在25G空白磁盘上安装分区</p><table><thead><tr><th>挂载点</th><th>大小</th><th>新分区的类型</th><th>新分区的位置</th><th>文件系统</th></tr></thead><tbody><tr><td>&#x2F;boot</td><td>250M</td><td>逻辑分区</td><td>空间起始位置</td><td>Ext4日志文件系统</td></tr><tr><td>交换空间</td><td>最大1.5内存</td><td>逻辑分区</td><td>空间起始位置</td><td>交换空间</td></tr><tr><td>&#x2F;home</td><td>10G</td><td>逻辑分区</td><td>空间起始位置</td><td>Ext4日志文件系统</td></tr><tr><td>&#x2F;</td><td>10G</td><td>主分区</td><td>空间起始位置</td><td>Ext4日志文件系统</td></tr></tbody></table><p>3、安装完成后，先修改镜像源再修改语言，改好重启后，勾选不再询问，点击使用旧名称。</p><p>4、软件安装及卸载命令</p><ul><li>更新可用软件包列表：sudo apt update</li><li>更新已安装的包：sudo apt upgrade</li><li>安装软件：sudo apt install 软件名</li><li>卸载软件：sudo apt remove 软件名</li></ul><p>5、常用工具</p><p>python</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install ipython</span><br><span class="line">sudo apt install ipython3</span><br><span class="line">sudo apt install python-pip</span><br><span class="line">sudo apt install python3-pip</span><br></pre></td></tr></table></figure><p>C++</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install cmake</span><br><span class="line">sudo apt install qtcreator</span><br></pre></td></tr></table></figure><p>ruby</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install ruby</span><br></pre></td></tr></table></figure><p>shh服务器安装</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install openssh-server</span><br></pre></td></tr></table></figure><p>6、软件卸载</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">libreoffice Amazon</span></span><br><span class="line">sudo apt remove libreoffice-common</span><br><span class="line">sudo apt removw unity-webapps-common</span><br></pre></td></tr></table></figure><p>**deb安装格式 **</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装软件</span></span><br><span class="line">sudo dpkg -i &lt;package.deb&gt;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修复软件之间的依赖关系；当安装软件时，提示：“在处理时有错误发生”时执行以下命令修复</span></span><br><span class="line">sudo apt -f install</span><br></pre></td></tr></table></figure><p>7、谷歌浏览器</p><ol><li><p>下载地址：<a href="https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb">https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb</a></p></li><li><p>安装命令</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install libappindicator1 libindicator7</span><br><span class="line">sudo dpkg –i google-chrome–stable_current_amd64.deb</span><br><span class="line">sudo apt –f install </span><br></pre></td></tr></table></figure></li></ol><p>8、安装搜狗输入法</p><p>fcitx被称为小企鹅输入法，是一个以GPL方式发布的输入法平台，可以通过安装引擎支持多种输入法。它<br>的优点是，短小精悍、跟程序的兼容性比较好！<br>1.打开系统设置语言支持<br>    ·将键盘输入法系统修改为fcitx<br>2.访问网站：<a href="http://pinyin.sogou.com/Linux/">http://pinyin.sogou.com/Linux/</a>下载最新版本的安装文件<br>3.在终端中执行以下命令：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo dpkg -i 搜狗安装名.deb</span><br><span class="line">sudo apt -f install</span><br></pre></td></tr></table></figure><p>9、Ubuntu  下安装 OpenSSH </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install openssh-server</span><br></pre></td></tr></table></figure><p>修改ssh默认端口</p><p>ssh - server 配置文件位于 &#x2F;etc&#x2F;ssh&#x2F;sshd_config ，在这里可以定义SSH的服务端口，默认端口是22，可以定义为其他的，如222，然后重启SSH服务：&#x2F;etc&#x2F;init.d&#x2F;ssh restart</p><p>加快ssh登录时间</p><p>vim &#x2F;etc.ssh&#x2F;sshd_config</p><p>找到 GSSAPI options 这一节，将下面两行注释掉：</p><p>GSSAPIAuthentication yes</p><p>GSSAPIDelegateCredentials no</p><p>然后重新启动 ssh 服务即可</p><p>&#x2F;etc&#x2F;init.d&#x2F;ssh restart</p><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="配置脚本"><a href="#配置脚本" class="headerlink" title="配置脚本"></a>配置脚本</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/sh</span></span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt install aptitude -y</span><br><span class="line">sudo apt install tree</span><br><span class="line">sudo apt install vim vim-gnome vim-tiny vim-athena vim-athena-py2 vim-gnome-py2 vim-gtk vim-gtk-py2 vim-gtk3 vim-gtk3-py2 vim-nox vim-nox-py2 -y </span><br><span class="line">sudo echo &quot;sudo cp vimrc /etc/vim/vimrc&quot;</span><br><span class="line">sudo cp vimrc /etc/vim/vimrc</span><br><span class="line"></span><br><span class="line">sudo apt install stardict -y</span><br><span class="line">sudo echo &quot;sudo cp dic /usr/share/stardict -r&quot;</span><br><span class="line">sudo cp dic /usr/share/stardict -r</span><br><span class="line"></span><br><span class="line">sudo apt install g++ -y</span><br><span class="line">sudo apt install vaftpd -y</span><br><span class="line">sudo apt install lftp -y</span><br><span class="line">sudo apt install nfs-kernel-server -y</span><br></pre></td></tr></table></figure><h2 id="vim插件配置脚本"><a href="#vim插件配置脚本" class="headerlink" title="vim插件配置脚本"></a>vim插件配置脚本</h2><p>【vim配置推荐 - ma6174】<a href="https://github.com/ma6174/vim">https://github.com/ma6174/vim</a></p><p>1、安装脚本下载：wget 47.93.11.51:88&#x2F;install_vim.sh</p><p>2、执行脚本：bash install_vim.sh</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;This script will install and configure vim and zsh automatic.&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The time this takes is related to the network conditions, please wait patiently.&quot;</span></span><br><span class="line"><span class="keyword">if</span> [[ `<span class="built_in">whoami</span>` == <span class="string">&quot;root&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[31mYou are  running this script with Root\033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[31mGenerally, we do not recommend using root for programming or directly controlling your Linux OS, especially when you are a beginner \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[31mSo, There is no necessary for you to configure with root.&quot;</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">&quot;Do you really want to do this?[N/y]&quot;</span> choice</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$&#123;choice&#125;</span> != y ]];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Bye.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">which</span> apt-get &gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">sudo apt-get install -y vim vim-gnome ctags xclip astyle python-setuptools python-dev git wget</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">which</span> yum &gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">sudo yum install -y gcc vim git ctags xclip astyle python-setuptools python-devel wget</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##Add HomeBrew support on  Mac OS</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">which</span> brew &gt;/dev/null;<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;You are using HomeBrew tool&quot;</span></span><br><span class="line">    brew install vim ctags git astyle</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">sudo easy_install -ZU autopep8 </span><br><span class="line">sudo <span class="built_in">ln</span> -s /usr/bin/ctags /usr/local/bin/ctags</span><br><span class="line"><span class="built_in">rm</span> -rf ~/vim* 2&gt;&amp;1 &gt;/dev/null</span><br><span class="line"><span class="built_in">rm</span> -rf ~/.vim* 2&gt;&amp;1 &gt;/dev/null</span><br><span class="line"><span class="built_in">mv</span> -f ~/vim ~/vim_old</span><br><span class="line"><span class="built_in">cd</span> ~/ &amp;&amp; git <span class="built_in">clone</span> https://gitee.com/suyelu/vim.git</span><br><span class="line"><span class="built_in">mv</span> -f ~/.vim ~/.vim_old 2&gt;&amp;1 &gt;/dev/null</span><br><span class="line"><span class="built_in">mv</span> -f ~/vim ~/.vim 2&gt;&amp;1 &gt;/dev/null</span><br><span class="line"><span class="built_in">mv</span> -f ~/.vimrc ~/.vimrc_old 2&gt;&amp;1 &gt;/dev/null</span><br><span class="line"><span class="built_in">mv</span> -f ~/.vim/.vimrc ~/ </span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/suyelu/vundle.git ~/.vim/bundle/vundle</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;程序正在自动安装相应插件&quot;</span> &gt; kaikeba</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;command-t插件需要等待时间较长，不要担心&quot;</span> &gt;&gt; kaikeba</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;切勿强制退出该界面，否则会导致错误，需重新配置&quot;</span> &gt;&gt; kaikeba</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;安装完毕将自动退出&quot;</span> &gt;&gt; kaikeba</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;请耐心等待&quot;</span> &gt;&gt; kaikeba</span><br><span class="line">vim kaikeba -c <span class="string">&quot;BundleInstall&quot;</span> -c <span class="string">&quot;q&quot;</span> -c <span class="string">&quot;q&quot;</span></span><br><span class="line"><span class="built_in">rm</span> kaikeba</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;安装完成&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="centos配置"><a href="#centos配置" class="headerlink" title="centos配置"></a>centos配置</h2><h3 id="最小安装"><a href="#最小安装" class="headerlink" title="最小安装"></a>最小安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#yum更新后面没有包名是更新所有，有包名就只更新指定的</span></span><br><span class="line">yum update -y</span><br><span class="line"><span class="comment">#安装Tab补全</span></span><br><span class="line">yum -y install bash-completion</span><br><span class="line"><span class="comment">#安装wget</span></span><br><span class="line">yum install -y wget</span><br><span class="line"><span class="comment">#安装vim</span></span><br><span class="line">yum -install -y vim-enhanced</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="nfs"><a href="#nfs" class="headerlink" title="nfs"></a>nfs</h3><p>1&gt; 安装nfs<br>                apt-get install nfs*<br>                yum install nfs*<br>2&gt; 配置<br>                &#x2F;etc&#x2F;exports<br>                添加如下一行<br>                &#x2F;filesystem *(rw)<br>3&gt; 重启nfs服务<br>                &#x2F;etc&#x2F;init.d&#x2F;nfs restart<br>4&gt; 查看配置是否成功<br>                [root@localhost filesystem]# showmount -e 192.168.0.254<br>                Export list for 192.168.0.254:<br>                &#x2F;ken       *<br>                &#x2F;tools     *<br>                &#x2F;homework  *<br>                &#x2F;filesystem *</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux系统编程</title>
      <link href="/2022/08/29/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/"/>
      <url>/2022/08/29/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="第一章"><a href="#第一章" class="headerlink" title="第一章"></a>第一章</h2><p>Linux系统： “所见皆文件”</p><p>Linux系统目录：</p><pre><code>bin：存放二进制可执行文件boot：存放开机启动程序dev：存放设备文件： 字符设备、块设备home：存放普通用户etc：用户信息和系统配置文件 passwd、grouplib：库文件：libc.so.6root：管理员宿主目录（家目录）usr：用户资源管理目录</code></pre><p>Linux系统文件类型： 7&#x2F;8 种</p><pre><code>普通文件：-目录文件：d字符设备文件：c块设备文件：b软连接：l管道文件：p套接字：s未知文件。</code></pre><p>软连接：快捷方式</p><pre><code>为保证软连接可以任意搬移， 创建时务必对源文件使用 绝对路径。</code></pre><p>硬链接：</p><pre><code>ln file  file.hard操作系统给每一个文件赋予唯一的 inode，当有相同inode的文件存在时，彼此同步。删除时，只将硬链接计数减一。减为0时，inode 被释放。</code></pre><p>创建用户：</p><pre><code>sudo adduser 新用户名--- useradd</code></pre><p>修改文件所属用户：</p><pre><code>sudo chown 新用户名 待修改文件。sudo chown wangwu a.c</code></pre><p>删除用户：<br>    sudo deluser 用户名</p><p>创建用户组：<br>    sudo addgroup 新组名</p><p>修改文件所属用户组：</p><pre><code>sudo chgrp 新用户组名 待修改文件。sudo chgrp g88 a.c</code></pre><p>删除组：<br>    sudo delgroup 用户组名</p><p>使用chown 一次修改所有者和所属组：</p><pre><code>sudo chown 所有者：所属组  待操作文件。</code></pre><p>find命令：找文件</p><pre><code>-type 按文件类型搜索  d/p/s/c/b/l/ f:文件-name 按文件名搜索    find ./ -name &quot;*file*.jpg&quot;-maxdepth 指定搜索深度。应作为第一个参数出现。    find ./ -maxdepth 1 -name &quot;*file*.jpg&quot;-size 按文件大小搜索. 单位：k、M、G    find /home/itcast -size +20M -size -50M-atime、mtime、ctime 天  amin、mmin、cmin 分钟。-exec：将find搜索的结果集执行某一指定命令。    find /usr/ -name &#39;*tmp*&#39; -exec ls -ld &#123;&#125; \;-ok: 以交互式的方式 将find搜索的结果集执行某一指定命令-xargs：将find搜索的结果集执行某一指定命令。  当结果集数量过大时，可以分片映射。    find /usr/ -name &#39;*tmp*&#39; | xargs ls -ld -print0：    find /usr/ -name &#39;*tmp*&#39; -print0 | xargs  -0 ls -ld </code></pre><p>grep命令：找文件内容</p><pre><code>grep -r &#39;copy&#39; ./ -n    -n参数：:显示行号ps aux | grep &#39;cupsd&#39;  -- 检索进程结果集。</code></pre><p>软件安装：</p><pre><code>1. 联网2. 更新软件资源列表到本地。  sudo apt-get update3. 安装 sudo apt-get install 软件名4. 卸载sudo apt-get remove 软件名5. 使用软件包（.deb） 安装：sudo dpkg -i 安装包名。</code></pre><p>tar压缩：</p><pre><code>1. tar -zcvf 要生成的压缩包名压缩材料。    tar zcvf  test.tar.gz  file1 dir2   使用 gzip方式压缩。    tar jcvf  test.tar.gz  file1 dir2   使用 bzip2方式压缩。</code></pre><p>tar解压：</p><pre><code>将 压缩命令中的 c --&gt; x    tar zxvf  test.tar.gz   使用 gzip方式解压缩。    tar jxvf  test.tar.gz   使用 bzip2方式解压缩。</code></pre><p>rar压缩：</p><pre><code>rar a -r  压缩包名（带.rar后缀） 压缩材料。    rar a -r testrar.rarstdio.h test2.mp3</code></pre><p>rar解压：</p><pre><code>unrar x 压缩包名（带.rar后缀）</code></pre><p>zip压缩：</p><pre><code>zip -r 压缩包名（带.zip后缀） 压缩材料。    zip -r testzip.zip dir stdio.h test2.mp3</code></pre><p>zip解压：<br>    unzip 压缩包名（带.zip后缀） </p><pre><code>    unzip  testzip.zip </code></pre><h2 id="第二章"><a href="#第二章" class="headerlink" title="第二章"></a>第二章</h2><p>跳转到指定行：</p><pre><code>1. 88G （命令模式）2. :88  (末行模式)</code></pre><p>跳转文件首：</p><pre><code>gg （命令模式）</code></pre><p>跳转文件尾：</p><pre><code>G（命令模式）</code></pre><p>自动格式化程序：</p><pre><code>gg=G（命令模式）</code></pre><p>大括号对应：</p><pre><code>% （命令模式）</code></pre><p>光标移至行首：</p><pre><code>0 （命令模式）执行结束，工作模式不变。</code></pre><p>光标移至行尾：</p><pre><code>$ （命令模式）执行结束，工作模式不变。</code></pre><p>删除单个字符：</p><pre><code>x （命令模式）执行结束，工作模式不变。</code></pre><p>替换单个字符：</p><pre><code>将待替换的字符用光标选中， r （命令模式），再按欲替换的字符</code></pre><p>删除一个单词：</p><pre><code>dw（命令模式）光标置于单词的首字母进行操作。</code></pre><p>删除光标至行尾：</p><pre><code>D 或者 d$（命令模式）</code></pre><p>删除光标至行首：</p><pre><code>d0 （命令模式）</code></pre><p>删除指定区域：</p><pre><code>按 V （命令模式）切换为 “可视模式”，使用 hjkl挪移光标来选中待删除区域。  按 d 删除该区域数据。</code></pre><p>删除指定1行：</p><pre><code>在光标所在行，按 dd （命令模式）</code></pre><p>删除指定N行：</p><pre><code>在光标所待删除首行，按 Ndd （命令模式）</code></pre><p>复制一行：</p><pre><code>yy</code></pre><p>粘贴：<br>    p：向后、P：向前。</p><p>查找：<br>    1. 找 设想 内容：</p><pre><code>    命令模式下， 按 “/” 输入欲搜索关键字，回车。使用 n 检索下一个。2. 找 看到的内容：    命令模式下，将光标置于单词任意一个字符上，按 “*”/ “#” </code></pre><p>单行替换：</p><pre><code>将光标置于待替换行上， 进入末行模式，输入 :s /原数据/新数据</code></pre><p>通篇替换：</p><pre><code>末行模式， :%s /原数据/新数据/g   g:不加，只替换每行首个。   sed </code></pre><p>指定行的替换：</p><pre><code>末行模式， :起始行号，终止行号s /原数据/新数据/g   g:不加，只替换每行首个。    :29,35s /printf/println/g</code></pre><p>撤销、反撤销：</p><pre><code>u、ctrl+r（命令模式）</code></pre><p>分屏：<br>    sp：横屏分。 Ctrl+ww 切换。</p><pre><code>vsp：竖屏分。Ctrl+ww 切换。</code></pre><p>跳转至 man 手册：</p><pre><code>将光标置于待查看函数单词上，使用 K（命令模式）跳转。 指定卷， nK</code></pre><p>查看宏定义：</p><pre><code>将光标置于待查看宏定义单词上，使用 [d 查看定义语句。</code></pre><p>在末行模式执行shell命令：</p><pre><code>:!命令:! ls -l </code></pre><hr><p>gcc编译：</p><pre><code>4步骤： 预处理、编译、汇编、连接。-I：指定头文件所在目录位置。-c：只做预处理、编译、汇编。得到 二进制 文件！！！-g：编译时添加调试语句。 主要支持 gdb 调试。-Wall： 显示所有警告信息。-D：向程序中“动态”注册宏定义。   #define NAME VALUE</code></pre><p>静态库制作及使用步骤：</p><pre><code>1. 将 .c 生成 .o 文件    gcc -c add.c -o add.o2. 使用 ar 工具制作静态库    ar rcs  lib库名.a  add.o sub.o div.o3. 编译静态库到可执行文件中：    gcc test.c lib库名.a -o a.out</code></pre><p>头文件守卫：防止头文件被重复包含</p><pre><code>#ifndef _HEAD_H_#define _HEAD_H_......#endif</code></pre><p>动态库制作及使用：</p><pre><code>1.  将 .c 生成 .o 文件， （生成与位置无关的代码 -fPIC）    gcc -c add.c -o add.o -fPIC2. 使用 gcc -shared 制作动态库    gcc -shared -o lib库名.soadd.o sub.o div.o3. 编译可执行程序时，指定所使用的动态库。  -l：指定库名(去掉lib前缀和.so后缀)  -L：指定库路径。    gcc test.c -o a.out -lmymath -L./lib4. 运行可以执行程序 ./a.out 出错！！！！ --- ldd a.out --&gt; &quot;not found&quot;    error while loading shared libraries: libxxx.so: cannot open shared object file: No such file or directory    原因：        链接器：工作于链接阶段， 工作时需要 -l 和 -L        动态链接器：工作于程序运行阶段，工作时需要提供动态库所在目录位置。    解决方式：        【1】 通过环境变量：  export LD_LIBRARY_PATH=动态库路径            ./a.out 成功！！！  （临时生效， 终端重启环境变量失效）        【2】 永久生效： 写入 终端配置文件。  .bashrc  建议使用绝对路径。            1) vi ~/.bashrc            2) 写入 export LD_LIBRARY_PATH=动态库路径  保存            3）. .bashrc/  source .bashrc / 重启 终端  ---&gt; 让修改后的.bashrc生效            4）./a.out 成功！！！         【3】 拷贝自定义动态库 到 /lib (标准C库所在目录位置)        【4】 配置文件法            1）sudo vi /etc/ld.so.conf            2) 写入 动态库绝对路径  保存            3）sudo ldconfig -v  使配置文件生效。            4）./a.out 成功！！！--- 使用 ldd  a.out 查看</code></pre><h2 id="第三章"><a href="#第三章" class="headerlink" title="第三章"></a>第三章</h2><p>gdb调试工具：   大前提：程序是你自己写的。  —逻辑错误</p><p>基础指令：<br>    -g：使用该参数编译可以执行文件，得到调试表。</p><pre><code>gdb ./a.outlist： list 1  列出源码。根据源码指定 行号设置断点。b：b 20在20行位置设置断点。run/r:运行程序n/next: 下一条指令（会越过函数）s/step: 下一条指令（会进入函数）p/print：p i  查看变量的值。continue：继续执行断点后续指令。finish：结束当前函数调用。 quit：退出gdb当前调试。</code></pre><p>其他指令：</p><pre><code>run：使用run查找段错误出现位置。set args： 设置main函数命令行参数 （在 start、run 之前）run 字串1 字串2 ...: 设置main函数命令行参数info b: 查看断点信息表b 20 if i = 5：设置条件断点。ptype：查看变量类型。bt：列出当前程序正存活着的栈帧。frame： 根据栈帧编号，切换栈帧。display：设置跟踪变量undisplay：取消设置跟踪变量。 使用跟踪变量的编号。</code></pre><p>makefile： 管理项目。</p><pre><code>命名：makefile Makefile  --- make 命令1 个规则：    目标：依赖条件    （一个tab缩进）命令    1. 目标的时间必须晚于依赖条件的时间，否则，更新目标    2. 依赖条件如果不存在，找寻新的规则去产生依赖条件。ALL：指定 makefile 的终极目标。2 个函数：    src = $(wildcard ./*.c): 匹配当前工作目录下的所有.c 文件。将文件名组成列表，赋值给变量 src。  src = add.c sub.c div1.c     obj = $(patsubst %.c, %.o, $(src)): 将参数3中，包含参数1的部分，替换为参数2。 obj = add.o sub.o div1.oclean:(没有依赖)    -rm -rf $(obj) a.out“-”：作用是，删除不存在文件时，不报错。顺序执行结束。3 个自动变量：    $@: 在规则的命令中，表示规则中的目标。    $^: 在规则的命令中，表示所有依赖条件。    $&lt;: 在规则的命令中，表示第一个依赖条件。如果将该变量应用在模式规则中，它可将依赖条件列表中的依赖依次取出，套用模式规则。模式规则：    %.o:%.c       gcc -c $&lt; -o %@静态模式规则：    $(obj):%.o:%.c       gcc -c $&lt; -o %@伪目标：    .PHONY: clean ALL参数：    -n：模拟执行make、make clean 命令。    -f：指定文件执行 make 命令。xxxx.mk作业：编写一个 makefile 可以将其所在目录下的所有独立 .c 文件编译生成同名可执行文件。</code></pre><h2 id="第四章"><a href="#第四章" class="headerlink" title="第四章"></a>第四章</h2><p>open函数：</p><pre><code>int open(char *pathname, int flags)#include &lt;unistd.h&gt;参数：    pathname: 欲打开的文件路径名    flags：文件打开方式：#include &lt;fcntl.h&gt;        O_RDONLY|O_WRONLY|O_RDWRO_CREAT|O_APPEND|O_TRUNC|O_EXCL|O_NONBLOCK ....返回值：    成功： 打开文件所得到对应的 文件描述符（整数）    失败： -1， 设置errnoint open(char *pathname, int flags， mode_t mode)123  775参数：    pathname: 欲打开的文件路径名    flags：文件打开方式：O_RDONLY|O_WRONLY|O_RDWRO_CREAT|O_APPEND|O_TRUNC|O_EXCL|O_NONBLOCK ....    mode: 参数3使用的前提， 参2指定了 O_CREAT。取值8进制数，用来描述文件的 访问权限。 rwx    0664        创建文件最终权限 = mode &amp; ~umask返回值：    成功： 打开文件所得到对应的 文件描述符（整数）    失败： -1， 设置errno</code></pre><p>close函数：</p><pre><code>int close(int fd);</code></pre><p>错误处理函数：与 errno 相关。</p><pre><code>printf(&quot;xxx error: %d\n&quot;, errno);char *strerror(int errnum);    printf(&quot;xxx error: %s\n&quot;, strerror(errno));void perror(const char *s);    perror(&quot;open error&quot;);</code></pre><p>read函数：</p><pre><code>ssize_t read(int fd, void *buf, size_t count);参数：    fd：文件描述符    buf：存数据的缓冲区    count：缓冲区大小返回值：    0：读到文件末尾。    成功；&gt; 0 读到的字节数。    失败：-1， 设置 errno    -1： 并且 errno = EAGIN 或 EWOULDBLOCK, 说明不是read失败，而是read在以非阻塞方式读一个设备文件（网络文件），并且文件无数据。</code></pre><p>write函数：</p><pre><code>ssize_t write(int fd, const void *buf, size_t count);参数：    fd：文件描述符    buf：待写出数据的缓冲区    count：数据大小返回值：    成功；写入的字节数。    失败：-1， 设置 errno</code></pre><p>文件描述符：</p><pre><code>PCB进程控制块：本质 结构体。成员：文件描述符表。文件描述符：0/1/2/3/4。。。。/1023     表中可用的最小的。0 - STDIN_FILENO1 - STDOUT_FILENO2 - STDERR_FILENO</code></pre><p>阻塞、非阻塞：  是设备文件、网络文件的属性。</p><pre><code>产生阻塞的场景。 读设备文件。读网络文件。（读常规文件无阻塞概念。）/dev/tty -- 终端文件。open(&quot;/dev/tty&quot;, O_RDWR|O_NONBLOCK)--- 设置 /dev/tty 非阻塞状态。(默认为阻塞状态)</code></pre><p>fcntl：<br>    int (int fd, int cmd, …)</p><pre><code>int flgs = fcntl(fd,  F_GETFL);flgs |= O_NONBLOCKfcntl(fd,  F_SETFL, flgs);获取文件状态： F_GETFL设置文件状态： F_SETFL</code></pre><p>lseek函数：</p><pre><code>off_t lseek(int fd, off_t offset, int whence);参数：    fd：文件描述符    offset： 偏移量    whence：起始偏移位置： SEEK_SET/SEEK_CUR/SEEK_END返回值：    成功：较起始位置偏移量    失败：-1 errno应用场景：    1. 文件的“读”、“写”使用同一偏移位置。    2. 使用lseek获取文件大小    3. 使用lseek拓展文件大小：要想使文件大小真正拓展，必须引起IO操作。        使用 truncate 函数，直接拓展文件。int ret = truncate(&quot;dict.cp&quot;, 250);</code></pre><p>传入参数：</p><pre><code>1. 指针作为函数参数。2. 同常有const关键字修饰。3. 指针指向有效区域， 在函数内部做读操作。</code></pre><p>传出参数：</p><pre><code>1. 指针作为函数参数。2. 在函数调用之前，指针指向的空间可以无意义，但必须有效。3. 在函数内部，做写操作。4。函数调用结束后，充当函数返回值。</code></pre><p>传入传出参数：</p><pre><code>1. 指针作为函数参数。2. 在函数调用之前，指针指向的空间有实际意义。3. 在函数内部，先做读操作，后做写操作。4. 函数调用结束后，充当函数返回值。</code></pre><p> void aaa();</p><p> int aaa(int *p, struct stat *p2, strcut student *p3);</p><p> bbb()<br> {<br>    aaa();<br> }</p><p>stat&#x2F;lstat 函数：</p><pre><code>int stat(const char *path, struct stat *buf);参数：    path： 文件路径    buf：（传出参数） 存放文件属性。返回值：    成功： 0    失败： -1 errno获取文件大小： buf.st_size获取文件类型： buf.st_mode获取文件权限： buf.st_mode符号穿透：stat会。lstat不会。</code></pre><p>link&#x2F;unlink:</p><pre><code>隐式回收。</code></pre><p>目录操作函数：</p><pre><code>DIR * opendir(char *name);int closedir(DIR *dp);struct dirent *readdir(DIR * dp);    struct dirent &#123;        inode        char dname[256];    &#125;</code></pre><h2 id="第五章"><a href="#第五章" class="headerlink" title="第五章"></a>第五章</h2><pre><code>./a.out ls.c  /home/itcast/28_Linux  ./abc/        /home/itcast/28_Linux/testdir/</code></pre><p>递归遍历目录：ls-R.c</p><pre><code>1. 判断命令行参数，获取用户要查询的目录名。int argc, char *argv[1]    argc == 1  --&gt; ./2. 判断用户指定的是否是目录。 stat  S_ISDIR(); --&gt; 封装函数 isFile() &#123;   &#125;3. 读目录： read_dir() &#123;     opendir（dir）    while （readdir（））&#123;        普通文件，直接打印        目录：            拼接目录访问绝对路径。sprintf(path, &quot;%s/%s&quot;, dir, d_name)             递归调用自己。--》 opendir（path） readdir closedir    &#125;    closedir（）    &#125;    read_dir() --&gt; isFile() ---&gt; read_dir()</code></pre><p>dup 和 dup2：</p><pre><code>int dup(int oldfd);文件描述符复制。    oldfd: 已有文件描述符    返回：新文件描述符。int dup2(int oldfd, int newfd); 文件描述符复制。重定向。</code></pre><p>fcntl 函数实现 dup：</p><pre><code>int fcntl(int fd, int cmd, ....)cmd: F_DUPFD参3:  被占用的，返回最小可用的。    未被占用的， 返回=该值的文件描述符。</code></pre><p>进程：<br>    程序：死的。只占用磁盘空间。——剧本。</p><pre><code>进程；活的。运行起来的程序。占用内存、cpu等系统资源。——戏。</code></pre><p>PCB进程控制块：</p><pre><code>进程id文件描述符表进程状态：初始态、就绪态、运行态、挂起态、终止态。进程工作目录位置*umask掩码 信号相关信息资源。用户id和组id</code></pre><p>fork函数：</p><pre><code>pid_t fork(void)创建子进程。父子进程各自返回。父进程返回子进程pid。 子进程返回 0.getpid();getppid();循环创建N个子进程模型。 每个子进程标识自己的身份。</code></pre><p>父子进程相同：</p><pre><code>刚fork后。 data段、text段、堆、栈、环境变量、全局变量、宿主目录位置、进程工作目录位置、信号处理方式</code></pre><p>父子进程不同：</p><pre><code>进程id、返回值、各自的父进程、进程创建时间、闹钟、未决信号集</code></pre><p>父子进程共享：</p><pre><code>读时共享、写时复制。———————— 全局变量。1. 文件描述符 2. mmap映射区。</code></pre><h2 id="第六章"><a href="#第六章" class="headerlink" title="第六章"></a>第六章</h2><p>gdb调试：</p><pre><code>设置父进程调试路径：set follow-fork-mode parent (默认)设置子进程调试路径：set follow-fork-mode child</code></pre><p>exec函数族：</p><pre><code>使进程执行某一程序。成功无返回值，失败返回 -1int execlp(const char *file, const char *arg, ...);借助 PATH 环境变量找寻待执行程序    参1： 程序名    参2： argv0    参3： argv1    ...： argvN    哨兵：NULLint execl(const char *path, const char *arg, ...);自己指定待执行程序路径。int execvp();</code></pre><p>ps ajx –&gt; pid ppid gid sid </p><p>孤儿进程：</p><pre><code>父进程先于子进终止，子进程沦为“孤儿进程”，会被 init 进程领养。</code></pre><p>僵尸进程：</p><pre><code>子进程终止，父进程尚未对子进程进行回收，在此期间，子进程为“僵尸进程”。  kill 对其无效。</code></pre><p>wait函数：回收子进程退出资源， 阻塞回收任意一个。</p><pre><code>pid_t wait(int *status)参数：（传出） 回收进程的状态。返回值：成功： 回收进程的pid    失败： -1， errno函数作用1：阻塞等待子进程退出函数作用2：清理子进程残留在内核的 pcb 资源函数作用3：通过传出参数，得到子进程结束状态</code></pre><p>​<br>​获取子进程正常终止值：<br>​<br>        WIFEXITED(status) –》 为真 –》调用 WEXITSTATUS(status) –》 得到 子进程 退出值。</p><pre><code>获取导致子进程异常终止信号：    WIFSIGNALED(status) --》 为真 --》调用 WTERMSIG(status) --》 得到 导致子进程异常终止的信号编号。</code></pre><p>waitpid函数：指定某一个进程进行回收。可以设置非阻塞。waitpid(-1, &amp;status, 0) &#x3D;&#x3D; wait(&amp;status);</p><pre><code>pid_t waitpid(pid_t pid, int *status, int options)参数：    pid：指定回收某一个子进程pid        &gt; 0: 待回收的子进程pid        -1：任意子进程        0：同组的子进程。    status：（传出） 回收进程的状态。    options：WNOHANG 指定回收方式为，非阻塞。返回值：    &gt; 0 : 表成功回收的子进程 pid    0 : 函数调用时， 参3 指定了WNOHANG， 并且，没有子进程结束。    -1: 失败。errno</code></pre><p>总结：</p><pre><code>wait、waitpid一次调用，回收一个子进程。        想回收多个。while </code></pre><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p><p>进程间通信的常用方式，特征：</p><pre><code>管道：简单信号：开销小mmap映射：非血缘关系进程间socket（本地套接字）：稳定</code></pre><p>管道：</p><pre><code>实现原理： 内核借助环形队列机制，使用内核缓冲区实现。特质；1. 伪文件    2. 管道中的数据只能一次读取。    3. 数据在管道中，只能单向流动。局限性：1. 自己写，不能自己读。    2. 数据不可以反复读。    3. 半双工通信。    4. 血缘关系进程间可用。</code></pre><p>pipe函数：创建，并打开管道。</p><pre><code>int pipe(int fd[2]);参数：fd[0]: 读端。    fd[1]: 写端。返回值： 成功： 0     失败： -1 errno</code></pre><p>管道的读写行为：</p><pre><code>读管道：    1. 管道有数据，read返回实际读到的字节数。    2. 管道无数据：1）无写端，read返回0 （类似读到文件尾）            2）有写端，read阻塞等待。写管道：    1. 无读端， 异常终止。 （SIGPIPE导致的）    2. 有读端：1） 管道已满， 阻塞等待            2） 管道未满， 返回写出的字节个数。</code></pre><h2 id="第七章"><a href="#第七章" class="headerlink" title="第七章"></a>第七章</h2><p>pipe管道： 用于有血缘关系的进程间通信。  ps aux | grep ls | wc -l</p><pre><code>父子进程间通信：兄弟进程间通信：</code></pre><p>fifo管道：可以用于无血缘关系的进程间通信。</p><pre><code>命名管道：  mkfifo 无血缘关系进程间通信：    读端，open fifo O_RDONLY    写端，open fifo O_WRONLY</code></pre><p>文件实现进程间通信：</p><pre><code>打开的文件是内核中的一块缓冲区。多个无血缘关系的进程，可以同时访问该文件。</code></pre><p>共享内存映射:</p><p>void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset);创建共享内存映射</p><pre><code>参数：    addr： 指定映射区的首地址。通常传NULL，表示让系统自动分配    length：共享内存映射区的大小。（&lt;= 文件的实际大小）    prot：共享内存映射区的读写属性。PROT_READ、PROT_WRITE、PROT_READ|PROT_WRITE    flags：标注共享内存的共享属性。MAP_SHARED、MAP_PRIVATE    fd:用于创建共享内存映射区的那个文件的 文件描述符。    offset：默认0，表示映射文件全部。偏移位置。需是 4k 的整数倍。返回值：    成功：映射区的首地址。    失败：MAP_FAILED (void*(-1))， errno</code></pre><p>int munmap(void *addr, size_t length);释放映射区。</p><pre><code>addr：mmap 的返回值length：大小</code></pre><p>使用注意事项：</p><pre><code>1. 用于创建映射区的文件大小为 0，实际指定非0大小创建映射区，出 “总线错误”。2. 用于创建映射区的文件大小为 0，实际制定0大小创建映射区， 出 “无效参数”。3. 用于创建映射区的文件读写属性为，只读。映射区属性为 读、写。 出 “无效参数”。4. 创建映射区，需要read权限。当访问权限指定为 “共享”MAP_SHARED是， mmap的读写权限，应该 &lt;=文件的open权限。只写不行。5. 文件描述符fd，在mmap创建映射区完成即可关闭。后续访问文件，用 地址访问。6. offset 必须是 4096的整数倍。（MMU 映射的最小单位 4k ）7. 对申请的映射区内存，不能越界访问。 8. munmap用于释放的 地址，必须是mmap申请返回的地址。9. 映射区访问权限为 “私有”MAP_PRIVATE, 对内存所做的所有修改，只在内存有效，不会反应到物理磁盘上。10.  映射区访问权限为 “私有”MAP_PRIVATE, 只需要open文件时，有读权限，用于创建映射区即可。</code></pre><p>mmap函数的保险调用方式：</p><pre><code>1. fd = open（&quot;文件名&quot;， O_RDWR）;2. mmap(NULL, 有效文件大小， PROT_READ|PROT_WRITE, MAP_SHARED, fd, 0);</code></pre><p>父子进程使用 mmap 进程间通信：</p><pre><code>父进程 先 创建映射区。 open（ O_RDWR） mmap( MAP_SHARED );指定 MAP_SHARED 权限fork() 创建子进程。一个进程读， 另外一个进程写。</code></pre><p>无血缘关系进程间 mmap 通信：  【会写】</p><pre><code>两个进程 打开同一个文件，创建映射区。指定flags 为 MAP_SHARED。一个进程写入，另外一个进程读出。【注意】：无血缘关系进程间通信。mmap：数据可以重复读取。                fifo：数据只能一次读取。</code></pre><p>匿名映射：只能用于 血缘关系进程间通信。</p><pre><code>p = (int *)mmap(NULL, 40, PROT_READ|PROT_WRITE, MAP_SHARED|MAP_ANONYMOUS, -1, 0);</code></pre><h2 id="第八章"><a href="#第八章" class="headerlink" title="第八章"></a>第八章</h2><p>信号共性：</p><pre><code>简单、不能携带大量信息、满足条件才发送。</code></pre><p>信号的特质：</p><pre><code>信号是软件层面上的“中断”。一旦信号产生，无论程序执行到什么位置，必须立即停止运行，处理信号，处理结束，再继续执行后续指令。所有信号的产生及处理全部都是由【内核】完成的。</code></pre><p>信号相关的概念：</p><pre><code>产生信号：    1. 按键产生    2. 系统调用产生    3. 软件条件产生    4. 硬件异常产生    5. 命令产生概念：    未决：产生与递达之间状态。      递达：产生并且送达到进程。直接被内核处理掉。    信号处理方式： 执行默认处理动作、忽略、捕捉（自定义）    阻塞信号集（信号屏蔽字）： 本质：位图。用来记录信号的屏蔽状态。一旦被屏蔽的信号，在解除屏蔽前，一直处于未决态。    未决信号集：本质：位图。用来记录信号的处理状态。该信号集中的信号，表示，已经产生，但尚未被处理。</code></pre><p>信号4要素：</p><pre><code>信号使用之前，应先确定其4要素，而后再用！！！编号、名称、对应事件、默认处理动作。</code></pre><p>kill命令 和 kill函数：</p><pre><code>int kill（pid_t pid, int signum）参数：    pid: &gt; 0:发送信号给指定进程        = 0：发送信号给跟调用kill函数的那个进程处于同一进程组的进程。        &lt; -1: 取绝对值，发送信号给该绝对值所对应的进程组的所有组员。        = -1：发送信号给，有权限发送的所有进程。    signum：待发送的信号返回值：    成功： 0    失败： -1 errno</code></pre><p>alarm 函数：使用自然计时法。</p><pre><code>定时发送SIGALRM给当前进程。unsigned int alarm(unsigned int seconds);    seconds：定时秒数    返回值：上次定时剩余时间。        无错误现象。    alarm（0）； 取消闹钟。time 命令 ： 查看程序执行时间。   实际时间 = 用户时间 + 内核时间 + 等待时间。  --》 优化瓶颈 IO</code></pre><p>setitimer函数：</p><pre><code>int setitimer(int which, const struct itimerval *new_value, struct itimerval *old_value);参数：    which：ITIMER_REAL： 采用自然计时。 ——&gt; SIGALRM        ITIMER_VIRTUAL: 采用用户空间计时  ---&gt; SIGVTALRM        ITIMER_PROF: 采用内核+用户空间计时 ---&gt; SIGPROF        new_value：定时秒数               类型：struct itimerval &#123;           struct timeval &#123;           time_t      tv_sec;         /* seconds */           suseconds_t tv_usec;        /* microseconds */       &#125;it_interval;---&gt; 周期定时秒数            struct timeval &#123;           time_t      tv_sec;                    suseconds_t tv_usec;               &#125;it_value;  ---&gt; 第一次定时秒数          &#125;;    old_value：传出参数，上次定时剩余时间。    e.g.        struct itimerval new_t;        struct itimerval old_t;        new_t.it_interval.tv_sec = 0;        new_t.it_interval.tv_usec = 0;        new_t.it_value.tv_sec = 1;        new_t.it_value.tv_usec = 0;        int ret = setitimer(&amp;new_t, &amp;old_t);  定时1秒返回值：    成功： 0    失败： -1 errno</code></pre><p>其他几个发信号函数：</p><pre><code>int raise(int sig);void abort(void);</code></pre><p>信号集操作函数：</p><pre><code>sigset_t set;  自定义信号集。sigemptyset(sigset_t *set);清空信号集sigfillset(sigset_t *set);全部置1sigaddset(sigset_t *set, int signum);将一个信号添加到集合中sigdelset(sigset_t *set, int signum);将一个信号从集合中移除sigismember（const sigset_t *set，int signum); 判断一个信号是否在集合中。 在--》1， 不在--》0</code></pre><p>设置信号屏蔽字和解除屏蔽：</p><pre><code>int sigprocmask(int how, const sigset_t *set, sigset_t *oldset);    how:SIG_BLOCK:设置阻塞        SIG_UNBLOCK:取消阻塞        SIG_SETMASK:用自定义set替换mask。    set：自定义set    oldset：旧有的 mask。</code></pre><p>查看未决信号集：</p><pre><code>int sigpending(sigset_t *set);    set： 传出的 未决信号集。</code></pre><p>【信号捕捉】：</p><pre><code>signal();【sigaction();】 重点！！！</code></pre><p>​</p><p>信号捕捉特性：</p><pre><code>1. 捕捉函数执行期间，信号屏蔽字 由 mask --&gt; sa_mask , 捕捉函数执行结束。 恢复回mask2. 捕捉函数执行期间，本信号自动被屏蔽(sa_flgs = 0).3. 捕捉函数执行期间，被屏蔽信号多次发送，解除屏蔽后只处理一次！</code></pre><p>借助信号完成 子进程回收。</p><h2 id="第九章"><a href="#第九章" class="headerlink" title="第九章"></a>第九章</h2><p>守护进程：</p><pre><code>daemon进程。通常运行与操作系统后台，脱离控制终端。一般不与用户直接交互。周期性的等待某个事件发生或周期性执行某一动作。不受用户登录注销影响。通常采用以d结尾的命名方式。</code></pre><p>守护进程创建步骤：</p><pre><code>1. fork子进程，让父进程终止。2. 子进程调用 setsid() 创建新会话3. 通常根据需要，改变工作目录位置 chdir()， 防止目录被卸载。4. 通常根据需要，重设umask文件权限掩码，影响新文件的创建权限。  022 -- 7550345 --- 432   r---wx-w-   4225. 通常根据需要，关闭/重定向 文件描述符6. 守护进程 业务逻辑。while（）</code></pre><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p><p>线程概念：</p><pre><code>进程：有独立的 进程地址空间。有独立的pcb。分配资源的最小单位。线程：有独立的pcb。没有独立的进程地址空间。最小单位的执行。ps -Lf 进程id ---&gt; 线程号。LWP  --》cpu 执行的最小单位。</code></pre><p>线程共享：</p><pre><code>独享 栈空间（内核栈、用户栈）共享 ./text./data ./rodataa ./bsss heap  ---&gt; 共享【全局变量】（errno）</code></pre><p>线程控制原语：</p><pre><code>pthread_t pthread_self(void);获取线程id。 线程id是在进程地址空间内部，用来标识线程身份的id号。    返回值：本线程id检查出错返回：  线程中。    fprintf(stderr, &quot;xxx error: %s\n&quot;, strerror(ret));int pthread_create(pthread_t *tid, const pthread_attr_t *attr, void *(*start_rountn)(void *), void *arg); 创建子线程。    参1：传出参数，表新创建的子线程 id    参2：线程属性。传NULL表使用默认属性。    参3：子线程回调函数。创建成功，ptherad_create函数返回时，该函数会被自动调用。        参4：参3的参数。没有的话，传NULL    返回值：成功：0        失败：errno循环创建N个子线程：    for （i = 0； i &lt; 5; i++）        pthread_create(&amp;tid, NULL, tfn, (void *)i);   // 将 int 类型 i， 强转成 void *， 传参。void pthread_exit(void *retval);  退出当前线程。    retval：退出值。 无退出值时，NULL    exit();退出当前进程。    return: 返回到调用者那里去。    pthread_exit(): 退出当前线程。int pthread_join(pthread_t thread, void **retval);阻塞 回收线程。    thread: 待回收的线程id    retval：传出参数。 回收的那个线程的退出值。        线程异常借助，值为 -1。    返回值：成功：0        失败：errnoint pthread_detach(pthread_t thread);设置线程分离    thread: 待分离的线程id</code></pre><p>​<br>​返回值：成功：0<br>​<br>            失败：errno</p><pre><code>int pthread_cancel(pthread_t thread);杀死一个线程。  需要到达取消点（保存点）    thread: 待杀死的线程id        返回值：成功：0        失败：errno    如果，子线程没有到达取消点， 那么 pthread_cancel 无效。    我们可以在程序中，手动添加一个取消点。使用 pthread_testcancel();    成功被 pthread_cancel() 杀死的线程，返回 -1.使用pthead_join 回收。线程控制原语进程控制原语pthread_create()fork();pthread_self()getpid();pthread_exit()exit(); / return pthread_join()wait()/waitpid()pthread_cancel()kill()pthread_detach()</code></pre><p>线程属性：</p><pre><code>设置分离属性。pthread_attr_t attr  创建一个线程属性结构体变量pthread_attr_init(&amp;attr);初始化线程属性pthread_attr_setdetachstate(&amp;attr,  PTHREAD_CREATE_DETACHED);设置线程属性为 分离态pthread_create(&amp;tid, &amp;attr, tfn, NULL); 借助修改后的 设置线程属性 创建为分离态的新线程pthread_attr_destroy(&amp;attr);销毁线程属性</code></pre><h2 id="第十章"><a href="#第十章" class="headerlink" title="第十章"></a>第十章</h2><p>线程同步：</p><pre><code>协同步调，对公共区域数据按序访问。防止数据混乱，产生与时间有关的错误。</code></pre><p>锁的使用：</p><pre><code>建议锁！对公共数据进行保护。所有线程【应该】在访问公共数据前先拿锁再访问。但，锁本身不具备强制性。</code></pre><p>使用mutex(互斥量、互斥锁)一般步骤：</p><pre><code>pthread_mutex_t 类型。 1. pthread_mutex_t lock;  创建锁2  pthread_mutex_init; 初始化13. pthread_mutex_lock;加锁1----&gt; 04. 访问共享数据（stdout)5. pthrad_mutext_unlock();解锁0++--&gt; 16. pthead_mutex_destroy；销毁锁初始化互斥量：    pthread_mutex_t mutex;    1. pthread_mutex_init(&amp;mutex, NULL);   动态初始化。    2. pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;静态初始化。注意事项：    尽量保证锁的粒度， 越小越好。（访问共享数据前，加锁。访问结束【立即】解锁。）    互斥锁，本质是结构体。 我们可以看成整数。 初值为 1。（pthread_mutex_init() 函数调用成功。）    加锁： --操作， 阻塞线程。    解锁： ++操作， 换醒阻塞在锁上的线程。    try锁：尝试加锁，成功--。失败，返回。同时设置错误号 EBUSY</code></pre><p>restrict关键字：</p><pre><code>用来限定指针变量。被该关键字限定的指针变量所指向的内存操作，必须由本指针完成。</code></pre><p>【死锁】：</p><pre><code>是使用锁不恰当导致的现象：    1. 对一个锁反复lock。    2. 两个线程，各自持有一把锁，请求另一把。</code></pre><p>读写锁：</p><pre><code>锁只有一把。以读方式给数据加锁——读锁。以写方式给数据加锁——写锁。读共享，写独占。写锁优先级高。相较于互斥量而言，当读线程多的时候，提高访问效率pthread_rwlock_t  rwlock;pthread_rwlock_init(&amp;rwlock, NULL);pthread_rwlock_rdlock(&amp;rwlock);trypthread_rwlock_wrlock(&amp;rwlock);trypthread_rwlock_unlock(&amp;rwlock);pthread_rwlock_destroy(&amp;rwlock);</code></pre><p>条件变量：</p><pre><code>本身不是锁！  但是通常结合锁来使用。 mutexpthread_cond_t cond;初始化条件变量：    1. pthread_cond_init(&amp;cond, NULL);   动态初始化。    2. pthread_cond_t cond = PTHREAD_COND_INITIALIZER;静态初始化。阻塞等待条件：    pthread_cond_wait(&amp;cond, &amp;mutex);    作用：1） 阻塞等待条件变量满足        2） 解锁已经加锁成功的信号量 （相当于 pthread_mutex_unlock(&amp;mutex)）        3)  当条件满足，函数返回时，重新加锁信号量 （相当于， pthread_mutex_lock(&amp;mutex);）pthread_cond_signal(): 唤醒阻塞在条件变量上的 (至少)一个线程。pthread_cond_broadcast()： 唤醒阻塞在条件变量上的 所有线程。【要求，能够借助条件变量，完成生成者消费者】</code></pre><p>信号量： </p><pre><code>应用于线程、进程间同步。相当于 初始化值为 N 的互斥量。  N值，表示可以同时访问共享数据区的线程数。函数：    sem_t sem;定义类型。    int sem_init(sem_t *sem, int pshared, unsigned int value);    参数：        sem： 信号量         pshared：0： 用于线程间同步                                1： 用于进程间同步        value：N值。（指定同时访问的线程数）    sem_destroy();    sem_wait();一次调用，做一次-- 操作， 当信号量的值为 0 时，再次 -- 就会阻塞。 （对比 pthread_mutex_lock）    sem_post();一次调用，做一次++ 操作. 当信号量的值为 N 时, 再次 ++ 就会阻塞。（对比 pthread_mutex_unlock）</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 系统编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>美国商业大亨传奇</title>
      <link href="/2022/08/24/%E7%BE%8E%E5%9B%BD%E5%95%86%E4%B8%9A%E5%A4%A7%E4%BA%A8%E4%BC%A0%E5%A5%87/"/>
      <url>/2022/08/24/%E7%BE%8E%E5%9B%BD%E5%95%86%E4%B8%9A%E5%A4%A7%E4%BA%A8%E4%BC%A0%E5%A5%87/</url>
      
        <content type="html"><![CDATA[<h1 id="美国商业大亨传奇"><a href="#美国商业大亨传奇" class="headerlink" title="美国商业大亨传奇"></a>美国商业大亨传奇</h1><h2 id="铁路之争"><a href="#铁路之争" class="headerlink" title="铁路之争"></a>铁路之争</h2><p>​1865年南北战争结束的五天后，时任总统的亚伯拉罕·林肯遇刺身亡，美国国内一片混乱，全世界都认为美国民主建国是一次失败的尝试，但是没有人意识到美国进入了一个新纪元，尽管伟大的总统去世，但是创业巨星的出现改变了全美的面貌。他们高瞻远瞩，足智多谋，前无古人，成就了一个全盛的国家。</p><p>​科尼利尔斯·范德比尔特是美国第一位极具领导力的非政治家人物。16岁时候，就用借来的100美元购买了一艘小船，作为商人，他冷酷无情，极具手段，很快就有一支运输船队，运输各地的商人和货物。他用40年左右的时间构建了庞大的运输帝国。在南北战争爆发前夕，他预感铁路运输将有巨大的需求，不是政府需求的那种，于是在航运巅峰时期卖掉船队，告别40余年的航运事业，他修建了第一条横跨北美大陆的铁路，全心投入铁路运输事业，当南北战争结束后，他已经成为美国首屈一指的首富。</p><p>​南北战争结束之后，人民都在为死去的人民悲伤时，范德比尔特也在黯然神伤，因为他的儿子乔治在战争中战死，范德比尔特一直培养乔治，希望乔治能接手家族的事业。乔治的战死，他不得不把希望寄托在一个儿子威廉身上。时年70岁的他比当时美国平均30多岁的人均寿命多活了很多，他让威廉做铁路运营总监，去与竞争对手谈判，但是竞争对手认为范德比尔特年事已高，不具备任何威胁力。很快他们就为他们的观念付出代价，范德比尔特为了重新确立在铁路行业的领导地位而出手，当时唯一一条连通全美最大港口纽约港的奥尔巴尼大桥由范德比尔特掌握，他关闭了奥尔巴尼大桥，将所有火车阻隔在纽约之外，消息传到纽约，导致对手公司(纽约中央铁路公司)的股票因此暴跌，范德比尔特让自己的人全部买入对手公司的股票，收购了对手公司。当时的范德比尔特掌握美国百分之四十的铁路运输，但是他依旧不满足，想掌握全美的铁路运输。</p><p>​当时连接芝加哥和纽约之间的铁路是美国最繁忙的铁路，但是这条伊利铁路并不属于范德尔特，于是他想收购伊利公司，便让其股票代理人不断收购伊利的股票，这种行为在现在称为恶意收购，即恶意收购由范德尔特开创。然而他的计划被两个无名之辈破幻，他们就是杰伊·古尔德和詹姆斯·菲斯克。他们是伊利的中间管理成，他们野心勃勃，看着范德比尔特他们也想建立自己的事业，他们私下悄悄印发了10万美元的伊利掺水股票，掺水股票稀释了范德比尔特的股权。这一次让巅峰的范德比尔特吃了一个大亏，同时也唤醒了这个沉睡的雄狮。</p><p>​具有卓远远见的范德比尔特很快认识到如今迅猛发展遍布全美的铁路其实已经处于过度建设了，今后铁路的利润将取决运输什么货物。为了掌控铁路运输业务，他必须寻找一种新类型的货物，确保火车一直有货可运送，并且他要垄断这种货物的市场。石油给美国的民众带来了翻天覆地的变化，他认识到，这就是他的下一个目标。克里夫兰生产石油，是当时附件最大的石油生产地。所以范德比尔特需要在这里找一个石油炼油生产商，当时附近刚好有一个濒临破产的炼油厂，他的所有者就是约翰·洛克菲勒。范德比尔特需要和他签订独家协议，专门运输他的石油，保证他的火车一直有货可运，于是他邀请洛克菲勒到纽约见面。去往纽约的火车在早上六点多发车，但是洛克菲勒没有按时赶到车站，错过了那趟列出，但是那趟列出发生了事故，因此洛克菲勒躲过一劫，他相信上帝不会无缘无故让他避过一劫。所以人们常说很多事情冥冥之中只有天意。之后范德比尔特以低于市场三分之二的价格帮洛克菲勒运输，条件是保准每天能装满范德比尔特60节的火车车厢，但是洛克菲勒当时并不能生产这么多煤油，一半都不行，但是他知道他与范德比尔特这次是一个难得的机遇。之后洛克菲勒不断并购其他炼油厂，不断构建自己的石油帝国。</p><h2 id="石油风云"><a href="#石油风云" class="headerlink" title="石油风云"></a>石油风云</h2><p>​当时煤油作为唯一照明的燃料，需求量巨大，但是煤油行业的不规范生产制造，让煤油极具危险性，煤油导致的火灾负面信息极大，导致他很难找到投资。于是洛克菲勒意识到此，就规范了生产制造和包装，并建立了美国标准石油公司。富有远见的他意识到石油勘探富有巨大的风险，他需要在石油行业以较低的风险获利，于是选择了炼油。之后洛克菲勒的标准石油公司成为全美最大的煤油生厂商，面对日益暴涨的煤油需求，与范德比尔特签订的独家运输协议已经无法满足运输需求。而范德比尔特的竞争对手以意识到了这一点，托马斯·斯科特拥有美国最大的铁路运输公司之一，他想取代范德比尔特成为铁路之王，于是他和助手安德鲁·卡内基面见洛克菲勒，以较低的运输价格达成运输协议。</p><p>​之后随着标准石油的产量不断增大，但运输价格极低，于是范德比尔特和托马斯·斯科特联手，要求提高煤油的运输价格，这无疑是向洛克菲勒进行宣战，洛克菲勒并不是那种遇到问题轻易服输的人。不久洛克菲勒发现炼油厂的煤油都是通过大型管道进行煤油输送的，这时他便意识到管道同样适用于长途运输。只要建成足够庞大的石油管道，便可以将铁路挤出石油市场。建设石油管道需要大量投入，但是他坚信这可以让他打败对手。之后石油运输管道遍布全美各大洲。过去25年里，铁路作为运输支柱，无人能撼动，当洛克菲勒用管道输送石油时，铁路受到了重挫，铁路股票价格大跌，恐慌造成三分之一铁路破产，股市恐慌，纽约交易关闭十天，暂停交易。在铁路行业最不景气的时候，范德比尔特去世了，终年82，留下了一亿多美元的庞大财产。之后随着洛克菲洛关闭位于匹兹堡唯一一家石油管道不能到达的炼油厂时，托马斯也失去了最后的石油运输业务，到时濒临破产，托马斯不得不削减工资裁员，工人的愤怒不满导致他们放火烧了斯科特的铁路货运站，斯科特的公司这样付之一炬。</p><p>​之后洛克菲勒成为继范德比尔特之后的美国首富，净值产1.5亿美元，相当于现如今的2250亿美元，他对煤油的垄断达到98%。</p><h2 id="复仇者的崛起"><a href="#复仇者的崛起" class="headerlink" title="复仇者的崛起"></a>复仇者的崛起</h2><p>​新兴的行业将改变整个世界，安德鲁·卡内基的复仇行动造成了意想不到的结果。1881年托马斯离世时，穷困潦倒，备受屈辱，而这一切都是洛克菲勒一手造成的。托马斯·斯科特是卡内基的良师益友，斯科特的离世对卡内基而言是沉重的打击。于是卡内基便决心向洛克菲勒复仇，争取超过洛克菲勒的财富。</p><p>​曾经斯科特想在密西西比河东西两岸建一座桥，他想建成的桥在后来成为美国第一座钢桥，但是当时卡内基并不知道该如何去建造。该桥长达1.6公里，当时很多大桥都以失败告终，从来没有人建成这样的大桥，但是卡内基坚定要建成。之后卡内基意识到也许全用钢可以，但是当时的条件并不能大规模生产钢材，且价格昂贵。为了建造大桥，卡内基到处寻找制造钢的方法，当时英国科学家发明了一种可以缩短造钢的方法，卡内基决定将它运用到钢材生产。当有钢时，卡内基开始建设大桥，但是钢材价格昂贵，一下卡内基就资金短缺，不得不终止，但是他并没有放弃，他积极向投资者求助，最终在投资者的帮助下，他最终建成了美国有史以来最大的钢桥。</p><p>​卡内基坚信钢材有巨大的运用价值，但是在他投身钢材行业之前，必须让人们意识到这一点，当卡内基让大象通过大桥时，人们无比兴奋。这次宣传的成功让人们对钢材的需求量暴增，尤其是他熟悉的铁路运输行业。卡内基找到斯科特筹到2100万巨额资金后，建成了自己的第一家炼钢厂，他似乎看到了未来。他的钢厂日产225吨钢材，铁路的扩张让卡内基获得了巨额的汇报，但是铁路的投资热不久就遇到了瓶颈。</p><p>​由于铁路运输被踢出煤油行业，造成铁路运输的萧条，因此卡内基的钢铁厂也迎来困境，卡内基将这一切归咎于洛克菲勒。但是卡内基很快就发现了一个新的机会，当时大量失业的劳动务工涌入芝加哥和纽约这样的大城市，政府需要大量的建房以满足住房要求。一个优秀的商人总能在困境中发现商机。他意识到钢材的未来不在铁路上，而在建筑上。随着房地产的繁荣，卡内基很快成为美国最富有的人之一，但是他的资产还是远远比不上洛克菲勒，洛克菲勒的资产是他的7倍之多。他坚信不能超过洛克菲勒，就不能帮助他的导师完成复仇。此时的他意识到他需要一个手段比洛克菲勒更毒辣的人帮他进行管理才行，于是他找到了亨利·弗里克，他是一个白手起家的百万富翁，是美国中西部最大的煤炭供应商之一。弗里克心狠手辣，未达到个人目的，不择手段。他对冷酷正是卡内基需要的。他的第一个任务就是整合钢铁业务。之后在弗里克的管理下，卡内基的量钢厂取得了巨大的进步，仅仅两年，利润就翻了一倍。很快卡内基就获得了巨大的利润，在19世纪的最后十年，他获得的利润达到了巅峰。为了答谢弗里克，他将弗里克提拔为董事长，权利仅次于他。他是弗里克的野心是成为公司的头号掌权者，像所有人证明他并不像他父亲一样是一个失败者。</p><p>​弗里克在匹兹堡东部购置了一块土地，并在那里创建了南福克渔猎俱乐部，只对美国最富有的人开放。俱乐部旁边是一个巨大的人工湖。卡内基也加入了这个俱乐部。他的俱乐部还获得了南福克坝的管理权，这座大坝蓄水约两千万吨，是世界上同类水坝中最大的一个。河流下游约23公里的地方便是约翰斯敦，炼钢厂的工人以及家人就居住在这里。雨季来临的时候，当地的人们便面临大坝决堤的威胁。当地的官员增多次加固大坝，但是弗里克都没有理会，更是为了自己的马车能在上面通行，削低了大坝的高度。最终在雨季的时候(美国士兵阵亡日)，大坝决堤，致使两千多人的生命被夺走，一千六百多住宅被摧毁，约翰斯顿超过10平方公里的地区别夷为平地。此次洪水事件是911事件之前，美国最为严重的人为灾难。志愿者从美国各地赶来帮忙重建，这是美国红十字会在和平时期展开的首次大型援助。</p><h2 id="嗜血工厂"><a href="#嗜血工厂" class="headerlink" title="嗜血工厂"></a>嗜血工厂</h2><p>​公众对洪水事件的愤怒日益增长，开始问责，大多数人将矛头指向南福克渔猎俱乐部的会员，但会员都拒绝承担责任，大家纷纷起诉南福克渔猎俱乐部，但都以失败告终。在愤怒的公众眼里，南福克渔猎俱乐部会员都是逍遥法外的凶手。这件事永远改变了安德鲁·卡内基，他人为自己对这起灾难负有责任，于是他便退出俱乐部，开始重新塑造自己的名誉。在随后的重建约翰斯顿中捐助了数百万美元，之后在全美国捐建公共建筑。之后又在纽约曼哈顿捐建一座大型音乐厅。</p><p>​卡内基生产的钢铁使得许多高楼大夏拔地而起，但是想要超过洛克菲勒成为美国最有权势的商人，他必须争取更多利润。卡内基之后也将为自己这个野心付出代价，可能失去自己苦心经营起来的一切。炼钢厂最大的成本就是人力，为了获取更多的利益，只能剥削工人，但是卡内基又要重塑形象，只能出行英国苏格兰度假，将这烫手的山芋抛给董事长弗里克，弗里克是可以为了达到目的不择手段的人，他不断的剥削工人，要求一天12个小时的工作时长，一周六天的工作，长时间的劳作，在如此恶劣的工作环境，工人不断在工作时出现伤亡，工人开始联合反抗，这时还没有完全形成的工会，佛里克不会让那个这样的情况发生，但是随正情况越来越恶劣，工人集体罢工，也不允许新招的工人进入工厂，工人们都认为炼钢厂能有如今的成就都是他们的功劳，这是他们的工厂。弗里克为了正压工人，雇佣了当时的平克顿私人侦探社的私人警力，他们曾经抓捕过火车劫匪名震一时，深知阻止了一场暗杀林肯的阴谋，被林肯雇佣为私人保镖。之后他们向工人开枪射杀，最终在州长派来民兵菜才得以解决。一夜之间，霍姆斯特德炼钢厂成为血腥之地的代名词。卡内基对霍姆斯特德炼钢厂发生的事情感到震惊，于是他延长了在苏格兰的时间，希望距离能淡化冲突。</p><p>​在美国国内，民众愤怒的呼声越来越高，一个自称为无政府的组织正在兴起，他们以暴力行事而闻名，并在他们认为任何不公平的地方拔刀相助。此时他们注意到了霍姆斯特德炼钢厂发生的惨剧，准备替天行道。他们盯上了炼钢厂的董事长佛里克。他们派去暗杀的人没能杀掉弗里克，还被佛里克反杀。董事长弗里克在被暗杀的同时，安德鲁·卡内基也开始拯救自己的钢铁帝国。卡内基为了自己的每况愈下的炼钢厂不被摩根收购，开始以净值的价格收购弗里克手里的股票，将他从董事除名。</p><h2 id="新的对手"><a href="#新的对手" class="headerlink" title="新的对手"></a>新的对手</h2><p>​约翰·皮尔庞特·摩根的父亲是美国的投资银行的行长。摩根重小就受父亲的熏陶，被教育不能让自己处于风险之中，要懂得用别人的钱来挣钱。摩根擅长的就是整合资源。他不断收购哪些萧条的企业进行整合，让他们重新获得盈利。他不断收购那些铁路竞争对手，并合并他们，以到达获利，最终摩根垄断了铁路运输业。摩根财团涉及的领域包括，铁路，运输业，房地产，制造业。</p><p>​与父亲教导不同的是，摩根见证了洛克菲勒和卡内基白手起家，构建了他们各自的商业帝国推动人们的生活，摩根也想像他们一样，投身创业中，建立属于自己的商业帝国。不久摩根就发现了托马斯·爱迪生发明的电灯。明锐的他意识到，电灯就将遍布千家万户，于是他投资了爱迪生的电灯，他认为的的机遇到了，将可以掌控一个行业，像卡内基和洛克菲勒一样成为这个领域的先驱。他们之后修建了中央发电站，大半个曼哈顿都被电灯点亮，他们不断创造财富。电灯的出现严重的威胁了洛克菲勒的煤油灯，这种威胁是致命的。之后洛克菲勒便想通过让人们认识到电是极度危险的，来阻止人们使用 电灯。摩根需要阻止洛克菲勒这个对手，但是不久，他和爱迪生的新对手就出现了，这个对手不是别人，正是爱迪生的助手，尼古拉·特斯拉。一场关乎电力未来之战的竞争，差点葬送了摩根。特斯拉发明了交流电，但是爱迪生认为交流电相较于直流电太过于威胁而没有在意与采纳特斯拉的交流电。最后特斯拉辞去了爱迪生的助手工作，开始小寻找支持他交流电的投资人，最后找到了由发明家到实业家的乔治·威廉汀豪斯的投资。之后特斯拉走遍全国不断向人们证明交流电的高效率和安全性，因此为乔治·威廉汀豪斯赢得了不少订单。为了阻止交流电的发展，爱迪生不断使用各种手段，不惜电死动物向人们证明交流电的危险，之后更是发明设计了第一张电刑椅。电刑椅没有阻止交流电，只是让人们认识到了电的危险和恐怖。</p><p>​摩根将自己的全部身家都压在了爱迪生身上，这是冒着巨大风险的行为，完全违背他父亲的教导。</p><p>​也许就是人们对电的不了解，当电刑出现的时候，人们只会知道电的危险，不管他是什么电，以及更多的是谴责谁发明设计了电刑。</p><h2 id="掌控全局"><a href="#掌控全局" class="headerlink" title="掌控全局"></a>掌控全局</h2><p>​一场关于电力的生存之战正在展开，摩根一心想成为一个传奇的改革者，但是电刑椅的出现，和父亲的逼迫，他的梦想开始破灭。但是之后一个新的项目点燃了他的希望，那就是在尼亚加拉大瀑布附近修建一个巨大的发电站，这将成为当时全世界最大的发电站。但是在该项目的竞争中，最终乔治·威廉汀豪斯赢得了该项目的合同。摩根遭受重创，他创建电气帝国的梦想破灭。摩根意识到，也许他父亲一直是正确的，但是他找到了将跌到谷底转变为机会的办法。他将重新夺回电力行业的控制权，他将采用父亲教导他的手段威胁对手使之屈服。他设法攻击威廉汀豪斯以及特斯拉的交流电专利权。因为输掉尼亚加拉水电站的建设，他和爱迪生的公司看上去就像个失败品，在摩根看来拯救公司的办法就只有一个，第一步就是开掉爱迪生。摩根将公司更名为通用电气，摩根的新公司立刻成为当时最强大的企业之一。市值高达5000万，相当于如今的10亿美元。</p><p>​摆脱爱迪生之后，摩根将通用电气的发展重点放在交流电上，美国通用电气逐渐成为全美最大的企业之一。之后摩根整合了整个电力行业，就像他对铁路行业和金融行业所做的那样，这是他从他父亲那里学到的方法。摩根成为了美国又一个极具影响力的人。</p><p>​摩根不想拘泥于一个产业，他想要拥有所有行业。作为当时最大投资银行的老板，他采用了老方法。之后经历了两年多的经济萧条的美国政府濒临破产，他们当时只能向一个人求助，那就是摩根，摩根借给政府一亿美元，相当于如今的30亿。</p><p>​由于电力的发展，洛克菲勒不得不另寻出路，当时汽油作为炼油的附属产品，没有任何用处，只能倒掉，但是洛克菲勒坚信汽油有巨大的使用价值，只是当时还没有人找到汽油的用途，于是洛克菲勒雇佣科学家试图寻找汽油的用途。一开始他们制作了一些小产品，比如合成蜂蜡和凡士林，但是洛克菲勒坚信汽油有更大的用途。当时人们对更高效发动机的渴望推动了内燃机的发展，汽油易燃的属性也恰恰使其成为驱动发电机的绝佳燃料。对洛克菲勒来说这是一个绝佳的机会，他拥有但时世界上最大的汽油供应链。当发现汽油比煤油拥有更大价值时，另一个人的出现成为了他的阻碍，这个人有可能摧毁洛克菲勒和他的对手们。</p><h2 id="权倾白宫"><a href="#权倾白宫" class="headerlink" title="权倾白宫"></a>权倾白宫</h2><p>​20世纪即将到来，洛克菲勒和摩根的行业竞争愈演愈烈，安德鲁·卡内基暂时置身事外，他悄悄的打造钢铁帝国，与美国海军签订了利润颇丰的合同，为军队建造军舰提供钢材。美国35商业发展在上商业大亨的构建下，使得美国反生了翻天覆地的变化，但是这种变化是有代价的，便是贫富差距越来越大很多底层民众生活得异常艰辛，90%的人每月只有不到100美元来维系生计，很多人希望夺回对国家的控制权。美国总统大选在即，他们的下一步行为将震惊全世界。1896年，有个人乘机利用穷人的愤怒帮助自己入主白宫，他就是威廉·詹宁斯·布莱恩。他倡导人人平等，发誓为穷人发声，与美国精英阶层抗争到底。布莱恩的出现让大亨们遇到了有史以来最大的威胁，他扬言要拆掉他们的公司，不把他们送进监狱誓不罢休。大亨们感受到了威胁，于是开始联合起来收买和扶持一个符合他们利益的总统。为了和捍卫他们的商业帝国，他们全力支持候选人俄亥俄州州长威廉·麦金莱竞选，为其提供了大量的资金，并买通媒体助其宣传。最终麦金莱当选总统，大亨们又可以继续以他们一贯的方式继续做生意。麦金莱重新颁布法令，洛克菲勒，卡内基和摩根他们的商业获得了前所未有的发展。</p><p>​之后卡内基将卡内基钢铁公司以自己随意定价的4.8亿美元高得离谱的价格卖给了摩根，摩根对价格没有一丝犹豫便收购了卡内基钢铁公司，并将其改名为美国钢铁公司。美国钢铁公司之后垄断了长达近百年的钢铁行业，地位从未被撼动。过去的30年中，卡内基和洛克菲勒一直争夺美国最富有的人的头衔，如今他终于打败了洛克菲勒。这场交易使卡内基过得了相当于今天3100亿美元的个人净资产。</p><p>​曾经当过警察和议员的西奥多·罗斯福注意到了控制全美国最大行业的摩根。罗斯福出生于纽约一个富裕的家庭，本可以成为大富豪的他却选择了一条完全不同的人生道路。相对于经济，政治对他更有吸引力。他年轻时的外在形象与政界格格不入，华丽的服装很快成为了人们的笑柄。罗斯福竭尽全力重塑政界的形象，在纽约的一个照相馆了，他身穿鹿皮裤，手握猎枪把政界扮成了荒山中的猎人形象，这张照片帮助了罗斯福从纨绔子弟的形象成功转变为平民形象。他从军之后，他所塑造的形象成为了现实，他在美西战争中成为了一名英雄。之后他成为纽约州州长，他通过立法来规范市场行为。他的最大目标时候美国最强大的垄断公司，以及在背后操控这些公司的人。洛克菲勒和摩根知道他们收买不了罗斯福这样的人，于是他们决定尽全力削弱罗斯福的势力。当时副总统是没有什么权利的职位，形同虚设。美国开始了新一轮的美国竞选，就像1896年一样，最富有的人成功的说服麦金莱推举罗斯福接任副总统职位。麦金莱成功连任，而罗斯福则成为了副总统。大亨成功让自己的人入主白宫，并将为吸血最大的人放在了无权的位置上。洛克菲勒和摩根以为他们的商业帝国安全了，但是这次他们可能是搬起石头砸自己的脚。1901年9月，美国总统麦金莱前往布法罗市发表演讲，向人们展示美国的繁荣经济，但不是所有人都从繁荣的经济中受益，许多人还挣扎在生存线上，他们极其厌恶麦金莱与大财团之间的密切往来。里昂·乔戈什本来是一名工人，但是近来他失业了，原因是摩根为了成立美国钢铁公司收购了他的雇主公司。乔戈什难以维持生计，开始对无政府主义思想产生兴趣，他深信政府在帮助夫人剥削穷人，他决定要结束这样的现状。乔戈什刺杀了麦金莱，麦金莱在遇刺杀8天后，不幸离世，成为美国第三个在任期间被刺杀的总统。这件事对美国最有权势的人来说简直在槽糕不过了，一位刺客就最有夺走了他们花费重金扶持起来的美国总统，他们的眼中钉罗斯福接任了总统一职。</p><h2 id="新的未来"><a href="#新的未来" class="headerlink" title="新的未来"></a>新的未来</h2><p>​摩根的铁路垄断公司被罗斯福在美国联邦法院起诉被诉后，洛克菲勒的美国标准石油公司也迎来的巨大的挑战。随后美国标准石油公司因垄断被联邦法院，政府希望洛克菲勒能到场出庭，但是洛克菲勒提前出逃了，在美国多个州窜逃数月。之后他的第一个孙子出生，他无法前去看望，从小就失去父亲的洛克菲洛被迫去做了记账的工作，从小的这段经历让他不想错过亲人，于是他出庭了标准石油的诉讼案。他被指责以不正当手段并购竞争对手的公司，还曾以1500万美金贿赂当时的议员，消除了当时对标准石油公司的不利诉讼案，以及通过了对标准石油有益的议案。在庭上，面对各种质控，洛克菲洛都以不记得进行搪塞，以及之后他不是公司董事表示之后的事情不知情为由回应，面对指责仍是幕后最大的决策者时，他回应只是个荣誉职位而已，同美国总统一样。对洛克菲勒质控和其他人提供的证词线索资料足足有一万二千多页。最终美国标准石油公司因垄断败诉，被拆分为34家新公司，最后被拆分出来的新公司在后来也成为了行业的垄断巨头；洛克菲勒在34家新公司中仍然是第一大股东，所以标准石油公司的拆分在后来依然为洛克菲勒挣到了比之前更多的财富。美国标准石油公司的拆分没有影响洛克菲勒获取财富的进度，但却给整个石油行业带来了生机活力，对石油行业以及其他行业的发展都有极大的促进意义，让国家和人民在创造中获得更多的利益。</p><p>​在洛克菲勒面对垄断诉讼案的同时，亨利·福特也面临着美国特许汽车制造协会对他的专利侵权起诉。在当时的美国，只有得到美国特许汽车制造协会的同意之后才能生产汽车，本质上，汽车行业由该协会所垄断。亨利·福特带着自己设计的汽车向美国特许汽车制造协会提出申请，希望自己可以创办企业生产自己的汽车。当时的汽车价格高昂，并且需要由一名专门的司机，所以当时的汽车只是少部分财阀贵族所拥有的物品。但是福特认为今后汽车将成为大众物品，人人都可以负担得起，所以他很坚定自己的造车梦。福特的第一次申请被协会拒绝了，因此他的梦想短暂的破灭了，但他依旧相信自己设计的汽车将来会成为主流。之后福特带着自己设计的汽车和当时最有名的赛车手比赛，对手是赛车记录的保持者，而福特这是第一次参赛，最终福特赢了，也因此福特开始名声鹊起，被人们所熟知这位英雄。之后福特就创办了自己的第一家汽车企业，因为他的名气和贴合大众的汽车，他的汽车销售很成功。因为福特的崛起，所以引来了美国特许汽车制造协会的侵权诉讼案，福特没有退缩，参与了出庭。这对福特来说也许是一次机会；和洛克菲勒不同的是，福特站在了洛克菲勒的对面，让原本只属于少部分人的汽车成为大众都能负担得起的消费品。最终法院判定美国特许汽车制造协会的专利无效，于是福特可以继续他的汽车制造。得益于他的经营管理，采用流水线生产，让原本一台12个小时才能组装完成的汽车在1.5个小时就能组装完成。流水线的生产模式使得他可以执行五天八小时的工作制，且员工的工资比其他工厂高出1倍多，一天能有5美元的工资，而当时的汽车只需要185美元。福特汽车极大的推动了国家社会的前进。</p><p>​随后不久，巧克力公司采用了福特的流水线生产模式生产巧克力销售，彩妆的出现，以及其他新兴行业的新起，让美国的经济越来越多元化。从南北战争结束后的50多年经济发展，一举让美国步入世界强国，使得美国能在之后的第一次世界大战中源源不断的输出大量的资源。</p><h2 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h2><p>​铁路大王范德比尔特，标准石油洛克菲勒，安德鲁·卡内基和摩根这四位商业大亨在南北战争结束后的30多年里，以超前的商业远见，高瞻远瞩的商业智慧不断开创着美国商业上的传奇，书写着商业辉煌，推动着美国经济发展。回顾美国的经济发展历程，从范德比尔特开始到洛克菲勒退出着几十年里，不难发现，美国的经济发展主要由这几个人在各自领域推动着，前三个都是白手起家，到行业的绝对垄断者，所以可以说，这几十年的商业是辉煌的，也是比较单调的。与其几乎形成反差的《激荡三十年》是一本记录中国改革开放后三十年的商业发展历程的书，从这本书里面可以看到山路十八弯的中国商业发展之路，与美国比较单一的发展路线不一样的是，中国商业发展极受政策和大众思想的影响，国营经济，集体经济和私人经济之间轮流角逐，所以从《激荡三十年》中，你会看到中国商业改革30年是非常曲折也非常多元化的。</p><p>​回顾美国商业大亨推动美国经济的传奇历程，几乎从零到20世纪步入世界经济强国，虽有几十年的历程，但了解这一段历程并不难，可以说这是一段非常让人看懂的商业历史。究其原因，也许就是这些商业大亨一开始就以<em><strong>大道至简</strong></em>的商业之道书写着这几十年辉煌的商业史，未添一丝一毫多余的繁枝末节。</p>]]></content>
      
      
      <categories>
          
          <category> 纪录片 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随写 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows</title>
      <link href="/2022/08/16/Windows/"/>
      <url>/2022/08/16/Windows/</url>
      
        <content type="html"><![CDATA[<h2 id="1、Windows基础设置"><a href="#1、Windows基础设置" class="headerlink" title="1、Windows基础设置"></a>1、Windows基础设置</h2><h3 id="1、D盘下新建目录"><a href="#1、D盘下新建目录" class="headerlink" title="1、D盘下新建目录"></a>1、D盘下新建目录</h3><ul><li>Program Files</li><li>Program Files (x86)</li><li>GoogleDown</li><li>InstallationPackage</li></ul><h3 id="2、常用软件安装"><a href="#2、常用软件安装" class="headerlink" title="2、常用软件安装"></a>2、常用软件安装</h3><ul><li>应用商店：SoftDownloader软件，现名：三点下载器；华为应用商店；联想应用商店</li><li>软件卸载软件：HiBitUninstaller-Portable      可注册表清理，系统还原，垃圾清理</li><li>压缩软件：RAR</li><li>截图软件：Snipaste       可将截图固定在屏幕上且置于其他应用窗口之上</li><li>影视播放软件：PotPlayer</li><li>录屏软件：Bandicam</li><li>记事本：Notepad++    与系统自带差不多，优势就是可以打开更多格式的文件进行编辑；也可以安装一个VScode编辑器，支持多种格式文件编辑，占用内存小</li><li>文件版本管理软件：git    下载地址： <a href="https://git-scm.com/download">https://git-scm.com/download</a></li></ul><h3 id="3、其他推荐软件"><a href="#3、其他推荐软件" class="headerlink" title="3、其他推荐软件"></a>3、其他推荐软件</h3><ul><li><p>PDF阅读器：JisuPdf</p></li><li><p>思维导图：ioDraw-v2.0.1-win32</p></li><li><p>围棋AI：KaTrain    GitHub开源</p></li><li><p>围棋摆谱软件：MultiGo</p></li><li><p>网盘：aDrive</p></li><li><p>Markdown编辑器：Typora</p></li><li><p>杀毒软件：火绒</p></li><li><p>远程控制软件：向日葵    免登陆得安装旧版</p></li><li><p>微软常见运行库安装：MSVBCRTAIO</p></li><li><p>博客搭建环境：nodejs    <a href="https://www.cnblogs.com/liuqiyun/p/8133904.html">https://www.cnblogs.com/liuqiyun/p/8133904.html</a></p></li><li><p>野狐围棋：下载地址：<a href="https://foxwq.com/soft.html">https://foxwq.com/soft.html</a></p></li><li><p>B站视频下载：鼠鼠下载器（高清下载，支持批量下载）下载地址：<a href="https://dmd.moyu.moe/">https://dmd.moyu.moe</a></p><p>另一个下载器：DownKyi，下载地址：<a href="https://suo.yt/J2nWUrs">https://suo.yt/J2nWUrs</a></p><p>项目地址：<a href="https://github.com/leiurayer/downkyi">https://github.com/leiurayer/downkyi</a></p><p>DownKyi不仅提供了解析下载，还有一个工具箱有一些水印去除之类的功能。</p></li><li><p>百度文库下载：小叶文库下载（下文软件获取公众号中的小白资源库中有安装包提供，可以下载VIP才能阅读的文章）</p></li></ul><h3 id="4、软件获取公众号"><a href="#4、软件获取公众号" class="headerlink" title="4、软件获取公众号"></a>4、软件获取公众号</h3><ul><li>办公软件安装管家</li><li>火耳软件管家</li><li>软件安装管家</li><li>软件目录</li><li>软件科技汇</li><li>小白资源库 ：<a href="https://mp.weixin.qq.com/s/uHPpFebNyFWnPw7g9hwc_A">https://mp.weixin.qq.com/s/uHPpFebNyFWnPw7g9hwc_A</a></li></ul><h2 id="2、其他软件设置"><a href="#2、其他软件设置" class="headerlink" title="2、其他软件设置"></a>2、其他软件设置</h2><h3 id="1、谷歌浏览器打开报信息错误"><a href="#1、谷歌浏览器打开报信息错误" class="headerlink" title="1、谷歌浏览器打开报信息错误"></a>1、谷歌浏览器打开报信息错误</h3><p>处理方式：删除C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default\下的Web Data文件即可；</p><p>可写一个bat脚本作为Google启动方式进行处理</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off#执行脚本时，dos窗口不显示执行命令</span><br><span class="line">#删除Web Data文件</span><br><span class="line"><span class="built_in">del</span> /q &quot;C:\Users\HASEE\AppData\Local\Google\Chrome\User Data\Default\Web Data&quot;</span><br><span class="line">#启动谷歌浏览器</span><br><span class="line"><span class="built_in">start</span> &quot;&quot; &quot;D:\Program Files\Google\Chrome\Application\chrome.exe&quot;</span><br></pre></td></tr></table></figure><h3 id="2、bat关机和重启命令"><a href="#2、bat关机和重启命令" class="headerlink" title="2、bat关机和重启命令"></a>2、bat关机和重启命令</h3><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">#运行时不显示dos窗口</span><br><span class="line"><span class="keyword">if</span> &quot;%<span class="number">1</span>&quot; == &quot;h&quot; <span class="keyword">goto</span> begin</span><br><span class="line">mshta vbscript:createobject(&quot;wscript.shell&quot;).run(&quot;&quot;&quot;%~nx0&quot;&quot; h&quot;,<span class="number">0</span>)(window.close)&amp;&amp;<span class="keyword">exit</span></span><br><span class="line">:begin</span><br><span class="line">#下面是要执行的命令</span><br><span class="line">slidetoshutdown#下拉关机命令</span><br><span class="line"></span><br><span class="line">shutdown -r -t <span class="number">1</span>#重启命令</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3、非常用软件安装"><a href="#3、非常用软件安装" class="headerlink" title="3、非常用软件安装"></a>3、非常用软件安装</h2><h3 id="1、手机投屏到电脑"><a href="#1、手机投屏到电脑" class="headerlink" title="1、手机投屏到电脑"></a>1、手机投屏到电脑</h3><p>1、手机投屏到电脑软件（用于投屏）</p><p>软件下载地址：<a href="https://github.com/Genymobile/scrcpy">https://github.com/Genymobile/scrcpy</a>     （该软件支持无线投屏）</p><p>2、调试软件（用于电脑端操作手机）</p><p>软件下载：用bing国际版搜索 platform-tools 然后下载zip</p><p>3、安装， 上面两个下载解压后就得到platform-tools和scrcpy-win64-v1.24这两个文件夹，然后将这两个文件夹放到C:\Program Files (x86)目录下，然后再将这两个文件夹的路径添加到环境变量里面。</p><p>4、手机端的设置，打开开发者选项，打开USB设置和USB(安全设置)。如果仅仅是投屏，电脑端不操作手机端的话，USB(安装设置)不需打开。</p><p>5、连上数据线，vin+r打开运行窗口，输入cmd后回车，然后输入scrcpy，手机就可以投屏到电脑。</p><p>6、安装该软件（Bluetooth Audio Receiver）就可以通过蓝牙将手机的声音投到电脑上。bing上搜索安装，win商店自带的软件。</p><h3 id="2、"><a href="#2、" class="headerlink" title="2、"></a>2、</h3>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python组件</title>
      <link href="/2022/08/15/Python%E7%BB%84%E4%BB%B6/"/>
      <url>/2022/08/15/Python%E7%BB%84%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h2 id="1-生成6位数字随机验证码"><a href="#1-生成6位数字随机验证码" class="headerlink" title="1. 生成6位数字随机验证码"></a>1. 生成6位数字随机验证码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">num_code</span>(<span class="params">length=<span class="number">6</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成长度为length的数字随机验证码</span></span><br><span class="line"><span class="string">    :param length: 验证码长度</span></span><br><span class="line"><span class="string">    :return: 验证码</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.choice(string.digits) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, length))</span><br></pre></td></tr></table></figure><h2 id="2-md5加密"><a href="#2-md5加密" class="headerlink" title="2.md5加密"></a>2.md5加密</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span>  hashlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># md5加密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_encrypt</span>(<span class="params">en_str</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用md5二次加密生成32位的字符串</span></span><br><span class="line"><span class="string">    :param en_str: 需要加密的字符串</span></span><br><span class="line"><span class="string">    :return: 加密后的字符串</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">   </span><br><span class="line">    md5 = hashlib.md5()  <span class="comment"># 使用MD5加密模式</span></span><br><span class="line">    md5.update(en_str.encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># 将参数字符串传入</span></span><br><span class="line">    md5.update(md5.hexdigest().encode(<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># md5二次加密</span></span><br><span class="line">    <span class="keyword">return</span> md5.hexdigest()</span><br></pre></td></tr></table></figure><h2 id="3-生成唯一token"><a href="#3-生成唯一token" class="headerlink" title="3. 生成唯一token"></a>3. 生成唯一token</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span>  hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">only_token</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用md5加密uuid生成唯一的32位token</span></span><br><span class="line"><span class="string">    :return: 加密后的字符串</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">md5 = hashlib.md5()  <span class="comment"># 使用MD5加密模式</span></span><br><span class="line">md5.update(<span class="built_in">str</span>(uuid.uuid1()).encode(<span class="string">&#x27;utf-8&#x27;</span>))  </span><br><span class="line"><span class="keyword">return</span> md5.hexdigest()</span><br></pre></td></tr></table></figure><h2 id="4、发送手机验证码"><a href="#4、发送手机验证码" class="headerlink" title="4、发送手机验证码"></a>4、发送手机验证码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#验证码管理表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AuthCode</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">10</span>,default=<span class="literal">None</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>,verbose_name=<span class="string">&#x27;姓名&#x27;</span>)</span><br><span class="line">    phone = models.CharField(max_length=<span class="number">11</span>, unique=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;手机号&#x27;</span>)</span><br><span class="line">    code = models.CharField(max_length=<span class="number">6</span>,verbose_name=<span class="string">&#x27;验证码&#x27;</span>)</span><br><span class="line">    purpose = models.IntegerField(default=<span class="number">0</span>,verbose_name=<span class="string">&#x27;用途:0-&gt;注册验证 1-&gt;找回密码 2-&gt;其它&#x27;</span>)</span><br><span class="line">    sendNum = models.IntegerField(default=<span class="number">0</span>,verbose_name=<span class="string">&#x27;发送次数&#x27;</span>)</span><br><span class="line">    isCanGet = models.BooleanField(default=<span class="number">0</span>,verbose_name=<span class="string">&#x27;0-&gt;可以获取,1-&gt;不可以获取&#x27;</span>)</span><br><span class="line">    recentlySendTime = models.DateTimeField(auto_now_add=<span class="literal">True</span>,verbose_name=<span class="string">&#x27;最近一次发送时间&#x27;</span>)</span><br><span class="line">    creation_time = models.DateTimeField(auto_now=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;创建时间&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        verbose_name = <span class="string">&#x27;手机验证码&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="实现逻辑"><a href="#实现逻辑" class="headerlink" title="实现逻辑"></a>实现逻辑</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> http.client</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="comment"># 使用互亿无线</span></span><br><span class="line">host = <span class="string">&quot;106.ihuyi.com&quot;</span></span><br><span class="line">sms_send_uri = <span class="string">&quot;/webservice/sms.php?method=Submit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看用户名 登录用户中心-&gt;验证码通知短信&gt;产品总览-&gt;API接口信息-&gt;APIID</span></span><br><span class="line">account = <span class="string">&quot;你的用户名&quot;</span></span><br><span class="line"><span class="comment"># 查看密码 登录用户中心-&gt;验证码通知短信&gt;产品总览-&gt;API接口信息-&gt;APIKEY</span></span><br><span class="line">password = <span class="string">&quot;你的密码&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_sms</span>(<span class="params">text, mobile</span>):</span><br><span class="line">    text = <span class="string">f&quot;您的验证码是：<span class="subst">&#123;text&#125;</span>。请不要把验证码泄露给其他人。&quot;</span></span><br><span class="line">    params = urllib.parse.urlencode(</span><br><span class="line">        &#123;<span class="string">&#x27;account&#x27;</span>: account, <span class="string">&#x27;password&#x27;</span>: password, <span class="string">&#x27;content&#x27;</span>: text, <span class="string">&#x27;mobile&#x27;</span>: mobile, <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;json&#x27;</span>&#125;)</span><br><span class="line">    headers = &#123;<span class="string">&quot;Content-type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/plain&quot;</span>&#125;</span><br><span class="line">    conn = http.client.HTTPConnection(host, port=<span class="number">80</span>, timeout=<span class="number">30</span>)</span><br><span class="line">    conn.request(<span class="string">&quot;POST&quot;</span>, sms_send_uri, params, headers)</span><br><span class="line">    response = conn.getresponse()</span><br><span class="line">    response_str = response.read()</span><br><span class="line">    conn.close()</span><br><span class="line">    <span class="keyword">return</span> response_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    mobile = <span class="string">&quot;手机号&quot;</span></span><br><span class="line">    text = <span class="string">&#x27;123122&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(json.loads(send_sms(text, mobile).decode(<span class="string">&#x27;utf-8&#x27;</span>)))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5、生成二维码"><a href="#5、生成二维码" class="headerlink" title="5、生成二维码"></a>5、生成二维码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> qrcode</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">maker_qrcode</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成二维码</span></span><br><span class="line"><span class="string">    :param url: 需要生成二维码的url</span></span><br><span class="line"><span class="string">    :return: 返回图片字节流</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    image = qrcode.make(url)  <span class="comment"># 创建二维码片</span></span><br><span class="line"></span><br><span class="line">    buffer = io.BytesIO()</span><br><span class="line">    <span class="comment"># 将图片内容丢入容器</span></span><br><span class="line">    image.save(buffer, <span class="string">&#x27;png&#x27;</span>)</span><br><span class="line">    <span class="comment"># 返回容器内的字节</span></span><br><span class="line">    <span class="keyword">return</span> buffer.getvalue()</span><br><span class="line">    </span><br><span class="line">或者</span><br><span class="line"><span class="keyword">from</span> .settings <span class="keyword">import</span> BASE_DIR</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_qrcode</span>(<span class="params">name, url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成机器扫码支付二维码</span></span><br><span class="line"><span class="string">    :param name: 图片名称</span></span><br><span class="line"><span class="string">    :param url: 支付路由</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    img = qrcode.make(url, border=<span class="number">0</span>)  <span class="comment"># 创建二维码片</span></span><br><span class="line">    save_path = BASE_DIR + <span class="string">&#x27;/&#x27;</span> + name + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(save_path)</span><br><span class="line">    img.save(save_path)</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-微信群发"><a href="#6-微信群发" class="headerlink" title="6.微信群发"></a>6.微信群发</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf8</span></span><br><span class="line"><span class="keyword">import</span> itchat, time</span><br><span class="line"></span><br><span class="line">itchat.auto_login(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">SINCERE_WISH = <span class="string">u&#x27;祝%s新年快乐！&#x27;</span></span><br><span class="line"></span><br><span class="line">friendList = itchat.get_friends(update=<span class="literal">True</span>)[<span class="number">35</span>:]</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>  index,friend <span class="keyword">in</span> <span class="built_in">enumerate</span>(friendList):</span><br><span class="line">    <span class="built_in">print</span>(index,friend[<span class="string">&#x27;DisplayName&#x27;</span>],friend[<span class="string">&#x27;NickName&#x27;</span>])</span><br><span class="line">    itchat.send(SINCERE_WISH % (friend[<span class="string">&#x27;DisplayName&#x27;</span>]</span><br><span class="line">                                <span class="keyword">or</span> friend[<span class="string">&#x27;NickName&#x27;</span>]), friend[<span class="string">&#x27;UserName&#x27;</span>])</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;备注名称&#x27;</span>,friend[<span class="string">&#x27;DisplayName&#x27;</span>],<span class="string">&#x27;昵称&#x27;</span>,friend[<span class="string">&#x27;NickName&#x27;</span>],<span class="string">&#x27;用户名&#x27;</span>,friend[<span class="string">&#x27;UserName&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;----end----&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># 发送文本</span></span><br><span class="line"><span class="string">itchat.send(&#x27;Hello, WeChat!&#x27;)</span></span><br><span class="line"><span class="string"># 发送图片</span></span><br><span class="line"><span class="string">itchat.send_image(&#x27;my_picture.png&#x27;)</span></span><br><span class="line"><span class="string"># 发送视频</span></span><br><span class="line"><span class="string">itchat.send_video(&#x27;my_video.mov&#x27;)</span></span><br><span class="line"><span class="string"># 发送文件</span></span><br><span class="line"><span class="string">itchat.send_file(&#x27;my_file.zip&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="7、微信自动回复"><a href="#7、微信自动回复" class="headerlink" title="7、微信自动回复"></a>7、微信自动回复</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding=utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> itchat</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="comment">#图灵机器人</span></span><br><span class="line"><span class="comment">#http://www.tuling123.com/member/robot/1380138/center/frame.jhtml?page=0&amp;child=0获取apikey</span></span><br><span class="line">KEY = <span class="string">&#x27;你的KEY&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_response</span>(<span class="params">msg</span>):</span><br><span class="line">    apiUrl = <span class="string">&#x27;http://www.tuling123.com/openapi/api&#x27;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;key&#x27;</span>    : KEY,</span><br><span class="line">        <span class="string">&#x27;info&#x27;</span>   : msg,</span><br><span class="line">        <span class="string">&#x27;userid&#x27;</span> : <span class="string">&#x27;wechat-robot&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = requests.post(apiUrl, data=data).json()</span><br><span class="line">        <span class="keyword">return</span> r.get(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@itchat.msg_register(<span class="params">itchat.content.TEXT</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tuling_reply</span>(<span class="params">msg</span>):</span><br><span class="line">    defaultReply = <span class="string">&#x27;I received: &#x27;</span> + msg[<span class="string">&#x27;Text&#x27;</span>]</span><br><span class="line">    robots=[<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>]</span><br><span class="line">    reply = get_response(msg[<span class="string">&#x27;Text&#x27;</span>])+random.choice(robots)</span><br><span class="line">    <span class="keyword">return</span> reply <span class="keyword">or</span> defaultReply</span><br><span class="line"></span><br><span class="line">itchat.auto_login(enableCmdQR=<span class="literal">False</span>)</span><br><span class="line">itchat.run()</span><br></pre></td></tr></table></figure><h2 id="8、提取Django中model中的字段名变成字典、列表"><a href="#8、提取Django中model中的字段名变成字典、列表" class="headerlink" title="8、提取Django中model中的字段名变成字典、列表"></a>8、提取Django中model中的字段名变成字典、列表</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">t = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    goods_id = models.IntegerField(verbose_name=&#x27;商品编号&#x27;)</span></span><br><span class="line"><span class="string">    label_code = models.CharField(max_length=20, verbose_name=&#x27;商品标签&#x27;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 字典</span></span><br><span class="line"><span class="built_in">print</span>(&#123;k:<span class="literal">None</span> <span class="keyword">for</span> k <span class="keyword">in</span> re.findall(<span class="string">&#x27;([a-z_A-Z]+)\s=\s&#x27;</span>,t)&#125;)</span><br><span class="line"><span class="comment"># 列表</span></span><br><span class="line"><span class="comment"># print([k for k in re.findall(&#x27;([a-z_A-Z]+)\s=\s&#x27;,t)])</span></span><br><span class="line"></span><br><span class="line">输出</span><br><span class="line">&#123;<span class="string">&#x27;goods_id&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;lable_code&#x27;</span>: <span class="literal">None</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="9、数据库中给表创建数据"><a href="#9、数据库中给表创建数据" class="headerlink" title="9、数据库中给表创建数据"></a>9、数据库中给表创建数据</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createData</span>(<span class="params">dataDict,tableName</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    给数据表创建数据</span></span><br><span class="line"><span class="string">    :param dataDict: 字典</span></span><br><span class="line"><span class="string">    :param tableName: 表名</span></span><br><span class="line"><span class="string">    :return: </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#连接数据库</span></span><br><span class="line">    conn = pymysql.connect(</span><br><span class="line">        host=<span class="string">&#x27;192.168.0.188&#x27;</span>, <span class="comment">#数据库所在地址URL</span></span><br><span class="line">        user=<span class="string">&#x27;root&#x27;</span>, <span class="comment">#用户名</span></span><br><span class="line">        password=<span class="string">&#x27;123456&#x27;</span>, <span class="comment">#密码</span></span><br><span class="line">        database=<span class="string">&#x27;名称&#x27;</span>, <span class="comment">#数据库名称</span></span><br><span class="line">        port=<span class="number">3306</span>,  <span class="comment">#端口号</span></span><br><span class="line">        charset=<span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment">#拿到查询游标</span></span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    clos,value = <span class="built_in">zip</span>(*dataDict.items())</span><br><span class="line">    sql = <span class="string">&quot;INSERT INTO `%s`(%s) VALUES (%s)&quot;</span> % (tableName,</span><br><span class="line">                                                <span class="string">&#x27;,&#x27;</span>.join(clos),</span><br><span class="line">                                                <span class="string">&#x27;,&#x27;</span>.join([<span class="string">&#x27;%s&#x27;</span>] * <span class="built_in">len</span>(value))</span><br><span class="line">                                                )</span><br><span class="line">    <span class="built_in">print</span>(sql)</span><br><span class="line">    cursor.execute(sql, value)</span><br><span class="line">    conn.commit()</span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Done&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="10-捕捉异常"><a href="#10-捕捉异常" class="headerlink" title="10.捕捉异常"></a>10.捕捉异常</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">except</span> 异常类型 <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">异常类型</span><br><span class="line">Exception  全部异常</span><br><span class="line">AttributeError 试图访问一个对象没有的属性，比如foo.x，但是foo没有属性x</span><br><span class="line">IOError 输入/输出异常；基本上是无法打开文件</span><br><span class="line">ImportError 无法引入模块或包；基本上是路径问题或名称错误</span><br><span class="line">IndentationError 语法错误（的子类） ；代码没有正确对齐</span><br><span class="line">IndexError 下标索引超出序列边界，比如当x只有三个元素，却试图访问x[<span class="number">5</span>]</span><br><span class="line">KeyError 试图访问字典里不存在的键</span><br><span class="line">KeyboardInterrupt Ctrl+C被按下</span><br><span class="line">NameError 使用一个还未被赋予对象的变量</span><br><span class="line">SyntaxError Python代码非法，代码不能编译(个人认为这是语法错误，写错了）</span><br><span class="line">TypeError 传入对象类型与要求的不符合</span><br><span class="line">UnboundLocalError 试图访问一个还未被设置的局部变量，基本上是由于另有一个同名的全局变量，导致你以为正在访问它</span><br><span class="line">ValueError 传入一个调用者不期望的值，即使值的类型是正确的</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="11、获取当前时间"><a href="#11、获取当前时间" class="headerlink" title="11、获取当前时间"></a>11、获取当前时间</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">current_time = <span class="built_in">str</span>(datetime.datetime.now())[:<span class="number">19</span>]</span><br><span class="line"><span class="built_in">print</span>(current_time)</span><br><span class="line"></span><br><span class="line">输出格式如：<span class="number">2018</span>-<span class="number">10</span>-<span class="number">20</span> <span class="number">10</span>:01:<span class="number">43</span></span><br><span class="line">local_time = time.strftime(<span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>, time.localtime(time.time()))</span><br><span class="line"><span class="built_in">print</span>(local_time)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="12、订单编号"><a href="#12、订单编号" class="headerlink" title="12、订单编号"></a>12、订单编号</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">random_str</span>(<span class="params">randomlength=<span class="number">8</span></span>):</span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    chars = <span class="string">&#x27;AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789&#x27;</span></span><br><span class="line">    length = <span class="built_in">len</span>(chars) - <span class="number">1</span></span><br><span class="line">    random = Random()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(randomlength):</span><br><span class="line">        <span class="built_in">str</span>+=chars[random.randint(<span class="number">0</span>, length)]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">order_num</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成付款订单号</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    local_time = time.strftime(<span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>, time.localtime(time.time()))</span><br><span class="line">    result = local_time + random_str(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(order_num())</span><br></pre></td></tr></table></figure><h2 id="13、mysql自动填写当前时间"><a href="#13、mysql自动填写当前时间" class="headerlink" title="13、mysql自动填写当前时间"></a>13、mysql自动填写当前时间</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CURRENT_TIMESTAMP</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20190312172747658.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">为表添加索引</span><br><span class="line"></span><br><span class="line">ALTER table tableName ADD INDEX indexName(columnName)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="14、drf动态过滤查询"><a href="#14、drf动态过滤查询" class="headerlink" title="14、drf动态过滤查询"></a>14、drf动态过滤查询</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># page.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserPagination</span>(<span class="title class_ inherited__">PageNumberPagination</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;用户分页器&quot;&quot;&quot;</span></span><br><span class="line">    page_size = <span class="number">10</span>  <span class="comment"># 默认的页面数据数量</span></span><br><span class="line">    page_query_param = <span class="string">&#x27;page&#x27;</span>  <span class="comment"># 定制取数据页码key </span></span><br><span class="line">    page_size_query_param = <span class="string">&#x27;page_size&#x27;</span>  <span class="comment"># 默认取数据页码key </span></span><br><span class="line">    max_page_size = <span class="number">15</span>   <span class="comment"># 数据每页取值的最大上限</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># serializers.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> user.models <span class="keyword">import</span> UserInfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserSerializers</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;用户收货地址&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = UserInfo</span><br><span class="line">    <span class="comment"># 所有字段</span></span><br><span class="line">        <span class="comment">#fields = &#x27;__all__&#x27;</span></span><br><span class="line">        fields = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;title&#x27;</span>,  <span class="string">&#x27;province&#x27;</span>, <span class="string">&#x27;city&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;quxian&#x27;</span>, <span class="string">&#x27;address&#x27;</span>, <span class="string">&#x27;code__gte&#x27;</span>, <span class="string">&#x27;code__lte&#x27;</span>]</span><br><span class="line">        <span class="comment"># 显示外键</span></span><br><span class="line">        depth = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MachineViews</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="comment"># 从前端获取出来的过滤参数，解析成字典传进filter()函数中</span></span><br><span class="line">        <span class="comment"># 动态过滤，</span></span><br><span class="line">        kwargs = &#123;&#125;</span><br><span class="line">        <span class="comment"># 表中的字段名</span></span><br><span class="line">        columns = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;title&#x27;</span>,  <span class="string">&#x27;province&#x27;</span>, <span class="string">&#x27;city&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;quxian&#x27;</span>, <span class="string">&#x27;address&#x27;</span>, <span class="string">&#x27;code__gte&#x27;</span>, <span class="string">&#x27;code__lte&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> request.query_params.items():</span><br><span class="line">            <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> columns:</span><br><span class="line">                <span class="keyword">return</span> Response(<span class="string">&#x27;参数不对&#x27;</span>, status=status.HTTP_400_BAD_REQUEST)</span><br><span class="line"><span class="keyword">if</span> v:</span><br><span class="line">            kwargs[k] = v</span><br><span class="line"></span><br><span class="line">        users = UserInfo.objects.<span class="built_in">filter</span>(**kwargs)</span><br><span class="line">        page = UserPagination()</span><br><span class="line">        page_goods_list = page.paginate_queryset(users, self.request, self)</span><br><span class="line">        ser = UserSerializers(page_goods_list, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> page.get_paginated_response(ser.data)</span><br><span class="line">        </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="15、linux后台运行python程序"><a href="#15、linux后台运行python程序" class="headerlink" title="15、linux后台运行python程序"></a>15、linux后台运行python程序</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">nohup /home/project_venv/user/<span class="built_in">bin</span>/python3 -u /home/user/user_server.py &gt;&gt; /home/user/user.log <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;   </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="16、追加外键"><a href="#16、追加外键" class="headerlink" title="16、追加外键"></a>16、追加外键</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ALTER TABLE tb_commentPhoto ADD CONSTRAINT FK_comment_phone</span><br><span class="line">FOREIGN KEY tb_goodsComment(<span class="built_in">id</span>) REFERENCES tb_commentPhoto(comment_id);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="17、写-x2F-读CSV文件，查看是否存在，若存在就从csv中删除"><a href="#17、写-x2F-读CSV文件，查看是否存在，若存在就从csv中删除" class="headerlink" title="17、写&#x2F;读CSV文件，查看是否存在，若存在就从csv中删除"></a>17、写&#x2F;读CSV文件，查看是否存在，若存在就从csv中删除</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_invite_code</span>(<span class="params">random_code_pool=<span class="literal">None</span>, length=<span class="number">6</span>, num=<span class="number">10</span>, is_append=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建随机邀请码,并写入txt文件</span></span><br><span class="line"><span class="string">    :param: random_code_pool 随机邀请码</span></span><br><span class="line"><span class="string">    :param: length 邀请码长度</span></span><br><span class="line"><span class="string">    :param: num 邀请码个数</span></span><br><span class="line"><span class="string">    :param: is_append True追加,False 覆盖</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> random_code_pool:</span><br><span class="line">        code_pool = string.ascii_uppercase + string.digits</span><br><span class="line">        random_code_pool = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">            s = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">                s += random.choice(code_pool)</span><br><span class="line">            <span class="keyword">if</span> s <span class="keyword">and</span> s <span class="keyword">not</span> <span class="keyword">in</span> random_code_pool:</span><br><span class="line">                random_code_pool.append(s)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 写入方法。是追加还是覆盖</span></span><br><span class="line">    write_method = <span class="string">&#x27;a+&#x27;</span> <span class="keyword">if</span> is_append <span class="keyword">else</span> <span class="string">&#x27;w&#x27;</span></span><br><span class="line">    <span class="comment"># 写入文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./invite_code.csv&#x27;</span>, write_method, newline=<span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        writer = csv.writer(f)</span><br><span class="line">        <span class="keyword">for</span> rowData <span class="keyword">in</span> random_code_pool:</span><br><span class="line">            <span class="comment"># 按行写入</span></span><br><span class="line">            writer.writerow((rowData,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_invite_code</span>(<span class="params">code</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    查看邀请码是否存在txt文件中，</span></span><br><span class="line"><span class="string">    若存在就返回True，并在txt文件中删除</span></span><br><span class="line"><span class="string">    若不存在就返回False</span></span><br><span class="line"><span class="string">    :param code:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    code_pool = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./invite_code.csv&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>,errors=<span class="string">&#x27;ignore&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        allFileInfo = csv.reader(f)</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> allFileInfo:</span><br><span class="line">            code_pool.append(row[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> code <span class="keyword">in</span> code_pool:</span><br><span class="line">        <span class="comment"># 删除查询的code</span></span><br><span class="line">        code_pool.pop(code_pool.index(code))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 重新写入文件</span></span><br><span class="line">        create_invite_code(code_pool,is_append=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># create_invite_code(length=9,num=100)</span></span><br><span class="line">    <span class="built_in">print</span>(check_invite_code(<span class="string">&#x27;WJ4PSTJG2&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="18、django中从request获取访问路径"><a href="#18、django中从request获取访问路径" class="headerlink" title="18、django中从request获取访问路径"></a>18、django中从request获取访问路径</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;获取相对路径&#x27;</span>, request.get_full_path())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;获取绝对路径&#x27;</span>, request.build_absolute_uri())</span><br><span class="line"><span class="built_in">print</span>(request.build_absolute_uri(<span class="string">&#x27;?&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(request.build_absolute_uri(<span class="string">&#x27;/&#x27;</span>)[:-<span class="number">1</span>].strip(<span class="string">&quot;/&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(request.build_absolute_uri(<span class="string">&#x27;/&#x27;</span>).strip(<span class="string">&quot;/&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(request.build_absolute_uri(<span class="string">&#x27;/&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;----------&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(request.META[<span class="string">&#x27;HTTP_HOST&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(request.META[<span class="string">&#x27;PATH_INFO&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(request.META[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">iphost = request.META.get(<span class="string">&#x27;REMOTE_ADDR&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  <span class="comment"># 获取访问来源IP</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出如：</span></span><br><span class="line">获取相对路径 /QRcode/?d=<span class="number">1</span></span><br><span class="line">获取绝对路径 http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/QRcode/?d=<span class="number">1</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/QRcode/</span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span></span><br><span class="line">http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span>/</span><br><span class="line">----------</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8000</span></span><br><span class="line">/QRcode/</span><br><span class="line">d=<span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="19、Django收集静态文件"><a href="#19、Django收集静态文件" class="headerlink" title="19、Django收集静态文件"></a>19、Django收集静态文件</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">先在项目根目录下创建一个static文件夹</span><br><span class="line">然后在settings.py中设置</span><br><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">&#x27;static&#x27;</span>)</span><br><span class="line">最后执行下面的命令：</span><br><span class="line">python manage.py collectstatic</span><br></pre></td></tr></table></figure><h2 id="20、xadmin插件"><a href="#20、xadmin插件" class="headerlink" title="20、xadmin插件"></a>20、xadmin插件</h2><p><a href="https://www.cnblogs.com/lanqie/p/8340215.html">https://www.cnblogs.com/lanqie/p/8340215.html</a></p><h2 id="21、uwsgi自动重启"><a href="#21、uwsgi自动重启" class="headerlink" title="21、uwsgi自动重启"></a>21、uwsgi自动重启</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[uwsgi]</span><br><span class="line"><span class="comment"># 使用nginx连接时 使用</span></span><br><span class="line">socket=<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">2019</span></span><br><span class="line"><span class="comment"># 直接作为web服务器使用</span></span><br><span class="line"><span class="comment">#http=0.0.0.1:8000</span></span><br><span class="line"><span class="comment"># 配置工程目录</span></span><br><span class="line">chdir=/home/user</span><br><span class="line"><span class="comment"># 配置项目的wsgi目录。相对于工程目录</span></span><br><span class="line">wsgi-file=user/wsgi.py</span><br><span class="line">virtualenv=/home/project_venv/user</span><br><span class="line"><span class="comment">#配置进程，线程信息</span></span><br><span class="line">processes=<span class="number">1</span></span><br><span class="line">threads=<span class="number">1</span></span><br><span class="line">enable-threads=<span class="literal">True</span></span><br><span class="line">master=<span class="literal">True</span></span><br><span class="line">pidfile=uwsgi.pid</span><br><span class="line">daemonize=uwsgi.log</span><br><span class="line"><span class="comment">#启动uwsgi的用户名和用户组</span></span><br><span class="line">uid=root</span><br><span class="line">gid=root</span><br><span class="line"><span class="comment">#uwsgi自动重启</span></span><br><span class="line">py-autoreload=<span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="22、谷歌浏览器快捷键"><a href="#22、谷歌浏览器快捷键" class="headerlink" title="22、谷歌浏览器快捷键"></a>22、谷歌浏览器快捷键</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">浏览器缓存</span><br><span class="line"></span><br><span class="line">Ctrl+Shift+Del  清除Google浏览器缓存的快捷键</span><br><span class="line"></span><br><span class="line">Ctrl+Shift+R  重新加载当前网页而不使用缓存内容</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="23、git克隆分支"><a href="#23、git克隆分支" class="headerlink" title="23、git克隆分支"></a>23、git克隆分支</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone -b dev 地址 </span><br></pre></td></tr></table></figure><h2 id="24、mysql更新语句、新增列、删除列"><a href="#24、mysql更新语句、新增列、删除列" class="headerlink" title="24、mysql更新语句、新增列、删除列"></a>24、mysql更新语句、新增列、删除列</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">update user <span class="built_in">set</span> name=<span class="string">&#x27;张三&#x27;</span> where <span class="built_in">id</span>=<span class="number">111</span></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">DELETE FROM table_name [WHERE Clause]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加字段</span></span><br><span class="line">alter table 表名 add column 列名 类型;</span><br><span class="line"><span class="comment"># 删除字段</span></span><br><span class="line">alter table 表名 dropcolumn 列名 ;</span><br></pre></td></tr></table></figure><h2 id="25、删除指定格式的文件"><a href="#25、删除指定格式的文件" class="headerlink" title="25、删除指定格式的文件"></a>25、删除指定格式的文件</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remove_specified_format_file</span>(<span class="params">file_dir, format_name</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    删除指定格式的文件</span></span><br><span class="line"><span class="string">    :param file_dir: 文件根目录</span></span><br><span class="line"><span class="string">    :param format_name: 格式</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(file_dir):</span><br><span class="line">        <span class="comment"># print(root) #当前目录路径</span></span><br><span class="line">        <span class="comment"># print(dirs) #当前路径下所有子目录</span></span><br><span class="line">        <span class="comment"># print(files) #当前路径下所有非目录子文件</span></span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            <span class="keyword">if</span> re.<span class="keyword">match</span>(format_name, file):</span><br><span class="line">                <span class="built_in">print</span>(os.path.join(root, file))</span><br><span class="line">                os.remove(os.path.join(root, file))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">remove_specified_format_file(<span class="string">r&#x27;D:\学习\LDC\java&#x27;</span>, <span class="string">r&#x27;\._*&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="26、计算文件总数"><a href="#26、计算文件总数" class="headerlink" title="26、计算文件总数"></a>26、计算文件总数</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">file_count</span>(<span class="params">file_dir</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    :param file_dir: 文件根目录</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(file_dir):</span><br><span class="line">        <span class="comment"># print(root) #当前目录路径</span></span><br><span class="line">        <span class="comment"># print(dirs) #当前路径下所有子目录</span></span><br><span class="line">        <span class="comment"># print(files) #当前路径下所有非目录子文件</span></span><br><span class="line">        count += <span class="built_in">len</span>(files)</span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(file_count(<span class="string">r&#x27;D:\学习\LDC\java\Java学习\newEstore\estore\js&#x27;</span>))</span><br></pre></td></tr></table></figure><h2 id="27、计算文件夹大小"><a href="#27、计算文件夹大小" class="headerlink" title="27、计算文件夹大小"></a>27、计算文件夹大小</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">file_size</span>(<span class="params">file_dir</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    删除指定格式的文件</span></span><br><span class="line"><span class="string">    :param file_dir: 文件根目录</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    size = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(file_dir):</span><br><span class="line">        <span class="comment"># print(root) #当前目录路径</span></span><br><span class="line">        <span class="comment"># print(dirs) #当前路径下所有子目录</span></span><br><span class="line">        <span class="comment"># print(files) #当前路径下所有非目录子文件</span></span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            size += os.path.getsize(os.path.join(root, file))</span><br><span class="line"><span class="comment"># M为单位</span></span><br><span class="line">    <span class="keyword">return</span> size / <span class="number">1024</span> / <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file_name = <span class="string">r&#x27;D:\学习&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(file_size(file_name))</span><br></pre></td></tr></table></figure><h2 id="28、Django实现jsonp跨域"><a href="#28、Django实现jsonp跨域" class="headerlink" title="28、Django实现jsonp跨域"></a>28、Django实现jsonp跨域</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># html</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">                    url: <span class="string">&#x27;请求路由&#x27;</span>,</span><br><span class="line">                    <span class="built_in">type</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">                    dataType: <span class="string">&#x27;JSONP&#x27;</span>,</span><br><span class="line">                    data:&#123;</span><br><span class="line">                      code: <span class="string">&#x27;yes&#x27;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    jsonp: <span class="string">&#x27;callback&#x27;</span>,</span><br><span class="line">                    success: function(res) &#123;</span><br><span class="line">                       var selectData = $.parseJSON(res);</span><br><span class="line">                       alert(selectData);</span><br><span class="line">                    &#125;,</span><br><span class="line">                    error: function(err) &#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        code = request.GET.get(<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="comment"># 跨域请求</span></span><br><span class="line">        callback = request.GET.get(<span class="string">&#x27;callback&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;%s(&#x27;%s&#x27;)&quot;</span> % (callback, json.dumps(&#123;<span class="string">&#x27;code&#x27;</span>: code&#125;)), status=status.HTTP_200_OK)</span><br><span class="line">                    </span><br><span class="line">cors解决跨域</span><br><span class="line"></span><br><span class="line">https://www.cnblogs.com/wxiaoyu/p/<span class="number">9578848.</span>html</span><br></pre></td></tr></table></figure><h2 id="29、微信获取用户信息"><a href="#29、微信获取用户信息" class="headerlink" title="29、微信获取用户信息"></a>29、微信获取用户信息</h2><p>参考：<a href="https://blog.csdn.net/weixin_39735923/article/details/79202563">https://blog.csdn.net/weixin_39735923/article/details/79202563</a></p><h2 id="30、uwsgi初始配置问题"><a href="#30、uwsgi初始配置问题" class="headerlink" title="30、uwsgi初始配置问题"></a>30、uwsgi初始配置问题</h2><p><a href="https://blog.csdn.net/weixin_39735923/article/details/79202563">https://blog.csdn.net/weixin_39735923/article/details/79202563</a></p><h2 id="31、django中drf序列化"><a href="#31、django中drf序列化" class="headerlink" title="31、django中drf序列化"></a>31、django中drf序列化</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 序列化器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MsgSerializers</span>(serializers.ModelSerializer):</span><br><span class="line">    addtime = serializers.DateTimeField(read_only=<span class="literal">True</span>, <span class="built_in">format</span>=<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">    hasread = serializers.CharField(source=<span class="string">&#x27;get_hasread_display&#x27;</span>)</span><br><span class="line">    msgtype = serializers.CharField(source=<span class="string">&#x27;get_msgtype_display&#x27;</span>)</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = MallMsg</span><br><span class="line">        <span class="comment"># 可以混合使用</span></span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span>  <span class="comment"># &#x27;__all__&#x27; 所有字段</span></span><br><span class="line">        <span class="comment"># 数据库层级控制（序列化链表操作）</span></span><br><span class="line">        <span class="comment"># depth = 1  # 外键层级</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#分页器</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.pagination <span class="keyword">import</span> PageNumberPagination</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyLimitOffsetPagination</span>(<span class="title class_ inherited__">PageNumberPagination</span>):</span><br><span class="line"></span><br><span class="line">    page_size = <span class="number">3</span>  <span class="comment"># 默认的页面数据数量</span></span><br><span class="line">    page_query_param = <span class="string">&#x27;page&#x27;</span>  <span class="comment"># 定制取数据页码key ？</span></span><br><span class="line">    page_size_query_param = <span class="string">&#x27;page_size&#x27;</span>  <span class="comment"># 默认取数据页码key &amp;</span></span><br><span class="line">    max_page_size = <span class="number">15</span>  <span class="comment"># 数据每页取值的最大上限</span></span><br></pre></td></tr></table></figure><h2 id="32、第三方库"><a href="#32、第三方库" class="headerlink" title="32、第三方库"></a>32、第三方库</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">安装openssl</span><br><span class="line"> pip3 install pyOpenSSL</span><br></pre></td></tr></table></figure><h2 id="33、requests请求https携带CA证书"><a href="#33、requests请求https携带CA证书" class="headerlink" title="33、requests请求https携带CA证书"></a>33、requests请求https携带CA证书</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> OpenSSL</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib3.contrib.pyopenssl</span><br><span class="line"></span><br><span class="line">urllib3.contrib.pyopenssl.inject_into_urllib3()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">p12_to_pem</span>(<span class="params">certname, pwd</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    从.p12文件中提取pem</span></span><br><span class="line"><span class="string">    :param certname:</span></span><br><span class="line"><span class="string">    :param pwd:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    pem_name = certname + <span class="string">&quot;.pem&quot;</span></span><br><span class="line">    f_pem = <span class="built_in">open</span>(pem_name, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    p12file = certname + <span class="string">&quot;.p12&quot;</span></span><br><span class="line">    p12 = OpenSSL.crypto.load_pkcs12(<span class="built_in">open</span>(p12file, <span class="string">&#x27;rb&#x27;</span>).read(), pwd)</span><br><span class="line">    f_pem.write(OpenSSL.crypto.dump_privatekey(OpenSSL.crypto.FILETYPE_PEM, p12.get_privatekey()))</span><br><span class="line">    f_pem.write(OpenSSL.crypto.dump_certificate(OpenSSL.crypto.FILETYPE_PEM, p12.get_certificate()))</span><br><span class="line">    ca = p12.get_ca_certificates()</span><br><span class="line">    <span class="keyword">if</span> ca <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">for</span> cert <span class="keyword">in</span> ca:</span><br><span class="line">            f_pem.write(OpenSSL.crypto.dump_certificate(OpenSSL.crypto.FILETYPE_PEM, cert))</span><br><span class="line">    f_pem.close()</span><br><span class="line">    <span class="keyword">return</span> pem_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">post_cert_request</span>(<span class="params">url, data,header, certname, pwd</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用证书发起https请求</span></span><br><span class="line"><span class="string">    :param url:</span></span><br><span class="line"><span class="string">    :param data:</span></span><br><span class="line"><span class="string">    :param certname:</span></span><br><span class="line"><span class="string">    :param pwd:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (certname != <span class="string">&quot;&quot;</span>):</span><br><span class="line">        cert = p12_to_pem(certname, pwd)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cert = <span class="literal">None</span></span><br><span class="line">    r = requests.post(url, header=header, data=data, cert=cert)</span><br><span class="line">    <span class="keyword">return</span> r</span><br></pre></td></tr></table></figure><h2 id="34、django创建缓存命令"><a href="#34、django创建缓存命令" class="headerlink" title="34、django创建缓存命令"></a>34、django创建缓存命令</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python manage.py createcachetable 缓存表名</span><br></pre></td></tr></table></figure><h2 id="35、Django-更改超级用户密码"><a href="#35、Django-更改超级用户密码" class="headerlink" title="35、Django 更改超级用户密码"></a>35、Django 更改超级用户密码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">在工程文件目录下敲入：</span><br><span class="line">python manage.py shell</span><br><span class="line"></span><br><span class="line">再在python交互界面输入：</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line">user = User.objects.get(username = <span class="string">&#x27;用户名&#x27;</span>)</span><br><span class="line">user.set_password(<span class="string">&#x27;密码&#x27;</span>)</span><br><span class="line">user.save()</span><br></pre></td></tr></table></figure><h2 id="36、restframe使用缓存"><a href="#36、restframe使用缓存" class="headerlink" title="36、restframe使用缓存"></a>36、restframe使用缓存</h2><p><a href="https://blog.csdn.net/Odyssues_lee/article/details/80872586">https://blog.csdn.net/Odyssues_lee/article/details/80872586</a></p><h2 id="37、数据库"><a href="#37、数据库" class="headerlink" title="37、数据库"></a>37、数据库</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">select * <span class="keyword">from</span> user  where ISNULL(code)</span><br><span class="line">update user <span class="built_in">set</span> code=<span class="string">&#x27;111&#x27;</span>,info=<span class="string">&#x27;微信&#x27;</span> where ISNULL(code)</span><br></pre></td></tr></table></figure><h2 id="38、linux常用命令"><a href="#38、linux常用命令" class="headerlink" title="38、linux常用命令"></a>38、linux常用命令</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tail -f 日志名  实时监控日志</span><br><span class="line">tail -f 80_v10.log</span><br><span class="line"></span><br><span class="line">netstat -na|grep <span class="number">80</span>  查看端口tcp连接数</span><br><span class="line">netstat -na|grep <span class="number">80</span> | wc -l 计算端口tcp连接数</span><br><span class="line"></span><br><span class="line">ps -ef|grep python  查看有多少python程序在运行</span><br><span class="line"></span><br><span class="line">gunzip <span class="number">2015.</span>csv.gz   <span class="comment"># 解压</span></span><br><span class="line">unzip <span class="number">19.</span><span class="built_in">zip</span> <span class="comment"># 解压zip</span></span><br><span class="line">wc -l <span class="number">2015.</span>csv   <span class="comment"># 查看行数</span></span><br><span class="line">apt install lrzsz  <span class="comment"># 安装</span></span><br><span class="line">sz 文件名  <span class="comment"># 下载文件</span></span><br><span class="line"></span><br><span class="line">查找文件</span><br><span class="line">find / -name 文件名</span><br><span class="line"></span><br><span class="line">匹配执行过的以find为开头的命令</span><br><span class="line">history | grep find</span><br></pre></td></tr></table></figure><h2 id="39、xadmin禁止增加、删除"><a href="#39、xadmin禁止增加、删除" class="headerlink" title="39、xadmin禁止增加、删除"></a>39、xadmin禁止增加、删除</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># models.py</span></span><br><span class="line"><span class="comment"># 用户管理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserManage</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">&#x27;用户名&#x27;</span>)</span><br><span class="line">    phone = models.CharField(max_length=<span class="number">11</span>, unique=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;手机号&#x27;</span>)</span><br><span class="line">    code = models.CharField(max_length=<span class="number">11</span>, unique=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;编号&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    user = models.ForeignKey(User, on_delete=models.CASCADE, editable=<span class="literal">False</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;管理员&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># adminx.py</span></span><br><span class="line"><span class="comment"># 用户列表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserAdmin</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    list_display = [ <span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>, <span class="string">&#x27;name&#x27;</span>,]</span><br><span class="line">    search_fields = [<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>]</span><br><span class="line">    list_filter = [<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>]</span><br><span class="line">    list_editable = [<span class="string">&#x27;name&#x27;</span>]  <span class="comment"># 数据即时编辑</span></span><br><span class="line">    readonly_fields = [<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>, <span class="string">&#x27;name&#x27;</span>]  <span class="comment"># 只读字段，不能编辑</span></span><br><span class="line">    model_icon = <span class="string">&#x27;fa fa-square&#x27;</span></span><br><span class="line">    model = UserInfo</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_delete_permission</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">    <span class="comment"># 禁止删除</span></span><br><span class="line">        <span class="keyword">if</span> args:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">has_add_permission</span>(<span class="params">self,*args,**kwargs</span>):</span><br><span class="line"><span class="comment"># 禁止增加</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_models</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="comment"># 用户级别设置</span></span><br><span class="line">        self.new_obj.user = self.request.user</span><br><span class="line">        flag = self.org_obj <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="string">&#x27;create&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;change&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> flag == <span class="string">&#x27;create&#x27;</span>:</span><br><span class="line">        <span class="comment"># 对密码字段进行加密</span></span><br><span class="line">            self.new_obj.password = encrypt_oracle(self.new_obj.password)</span><br><span class="line">        <span class="keyword">elif</span> flag == <span class="string">&#x27;change&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> self.change_message():</span><br><span class="line">                self.new_obj.password = encrypt_oracle(self.new_obj.password)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        <span class="built_in">super</span>().save_models()</span><br><span class="line"></span><br><span class="line">xadmin.site.register(UserInfo, UserAdmin)</span><br></pre></td></tr></table></figure><h2 id="40、时间格式字符串相减"><a href="#40、时间格式字符串相减" class="headerlink" title="40、时间格式字符串相减"></a>40、时间格式字符串相减</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start = <span class="built_in">str</span>(datetime.datetime.now())[:<span class="number">19</span>]</span><br><span class="line">time.sleep(<span class="number">60</span>)</span><br><span class="line">end = <span class="built_in">str</span>(datetime.datetime.now())[:<span class="number">19</span>]</span><br><span class="line"><span class="built_in">print</span>(start,end)</span><br><span class="line">link_start = datetime.datetime.strptime(start, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">link_end = datetime.datetime.strptime(end, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">link_min = <span class="built_in">round</span>((link_end - link_start).seconds / <span class="number">60</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(link_min,<span class="string">&#x27;分钟&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="41、显示循环进度条"><a href="#41、显示循环进度条" class="headerlink" title="41、显示循环进度条"></a>41、显示循环进度条</h2><p>参考：<a href="https://blog.csdn.net/zejianli/article/details/77915751">https://blog.csdn.net/zejianli/article/details/77915751</a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm,trange</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line">text = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> tqdm([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>]):</span><br><span class="line">    text = text + char</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_bar</span>(<span class="params">percent, index, total,start_time, start_str=<span class="string">&#x27;&#x27;</span>, end_str=<span class="string">&#x27;&#x27;</span>, total_length=<span class="number">100</span></span>):</span><br><span class="line">    <span class="comment"># 进度条</span></span><br><span class="line">    percent_length = <span class="built_in">int</span>(percent)</span><br><span class="line">    bar = <span class="string">&#x27;\r&#x27;</span> + start_str + (<span class="string">&#x27;\033[1;31;41m \033[0m&#x27;</span> * percent_length + <span class="string">&#x27;\033[1;37;47m \033[0m&#x27;</span> * (</span><br><span class="line">                total_length - percent_length)) + <span class="string">f&#x27;  <span class="subst">&#123;<span class="built_in">round</span>(index / total * <span class="number">100</span>, <span class="number">2</span>)&#125;</span>%  &#x27;</span> + <span class="string">f&#x27; <span class="subst">&#123;index&#125;</span>|<span class="subst">&#123;end_str&#125;</span>&#x27;</span>+ <span class="string">f&#x27;   |已进行时间: <span class="subst">&#123;<span class="built_in">round</span>(time.time() - start_time, <span class="number">2</span>)&#125;</span>秒&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(bar, end=<span class="string">&#x27;&#x27;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    data_set = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>)]</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    total = <span class="built_in">len</span>(data_set)</span><br><span class="line">    end_str = <span class="string">&#x27;&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(total)</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> data_set:</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        process_bar(i * <span class="number">100</span> / total, i, total, start_time, start_str=<span class="string">&#x27;&#x27;</span>, end_str=end_str, total_length=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式三</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">d = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(d)):</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    sys.stdout.write(<span class="string">&#x27;\r&gt;&gt; Downloading  %.2f%%&#x27;</span> % (<span class="built_in">float</span>(i) / <span class="built_in">float</span>(<span class="built_in">len</span>(d)) * <span class="number">100.0</span>))</span><br><span class="line">sys.stdout.flush()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="42、把列表中的字典转成csv文件"><a href="#42、把列表中的字典转成csv文件" class="headerlink" title="42、把列表中的字典转成csv文件"></a>42、把列表中的字典转成csv文件</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">lists = [&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">2</span>&#125;,&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">3</span>&#125;]</span><br><span class="line">df = pd.DataFrame(lists)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line">df.to_csv(<span class="string">&#x27;result2.csv&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="43、windows添加右键新建MarkDown文件"><a href="#43、windows添加右键新建MarkDown文件" class="headerlink" title="43、windows添加右键新建MarkDown文件"></a>43、windows添加右键新建MarkDown文件</h2><p>在网上下载Typora软件安装后<br>1、在桌面上新建一个txt文件，输入以下内容：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Windows Registry Editor Version <span class="number">5.00</span></span><br><span class="line">[HKEY_CLASSES_ROOT\.md\ShellNew]</span><br><span class="line"><span class="string">&quot;NullFile&quot;</span>=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="string">&quot;FileName&quot;</span>=<span class="string">&quot;template.md&quot;</span></span><br></pre></td></tr></table></figure><p>2、另存为，改后缀为.reg，保存类型为.txt，编码为Unicode</p><p><img src="https://img-blog.csdnimg.cn/20200526232015169.png" alt="在这里插入图片描述"></p><p>3、双击运行，确定，重启电脑，此时在桌面右键就有了新建md文件</p><h2 id="44、redis设置值定时过期"><a href="#44、redis设置值定时过期" class="headerlink" title="44、redis设置值定时过期"></a>44、redis设置值定时过期</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">redis_client = redis.Redis(</span><br><span class="line">    host=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    port=<span class="number">6379</span>,</span><br><span class="line">    db=<span class="number">0</span>,</span><br><span class="line">    password=<span class="string">&#x27;123456&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redis_set</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    redis设置值定时过期</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">global</span> redis_client</span><br><span class="line"></span><br><span class="line">    redis_client.<span class="built_in">set</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;ldc&#x27;</span>)</span><br><span class="line">    now = datetime.datetime.now()</span><br><span class="line">    <span class="comment"># 设置‘name’50秒过期</span></span><br><span class="line">    expire_time = now + datetime.timedelta(hours=<span class="number">0</span>, minutes=<span class="number">0</span>, seconds=<span class="number">50</span>)</span><br><span class="line">    redis_client.expireat(<span class="string">&#x27;name&#x27;</span>, expire_time)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    redis_set()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="45、linux根据端口杀进程"><a href="#45、linux根据端口杀进程" class="headerlink" title="45、linux根据端口杀进程"></a>45、linux根据端口杀进程</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">killport</span>(<span class="params">port</span>):</span><br><span class="line">    command = <span class="string">&#x27;&#x27;&#x27;kill -9 $(netstat -nlp | grep :&#x27;&#x27;&#x27;</span> + <span class="built_in">str</span>(port) + <span class="string">&#x27;&#x27;&#x27; | awk &#x27;&#123;print $7&#125;&#x27; | awk -F&quot;/&quot; &#x27;&#123; print $1 &#125;&#x27;)&#x27;&#x27;&#x27;</span></span><br><span class="line">    os.system(command)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始执行</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    port = <span class="number">4237</span></span><br><span class="line">    killport(port)</span><br></pre></td></tr></table></figure><h2 id="46、监控linux网络流量"><a href="#46、监控linux网络流量" class="headerlink" title="46、监控linux网络流量"></a>46、监控linux网络流量</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">iftop -n -N -i eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nethogs eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim +/字符串 文件</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="47、win10添加右键打开cmd"><a href="#47、win10添加右键打开cmd" class="headerlink" title="47、win10添加右键打开cmd"></a>47、win10添加右键打开cmd</h2><p>通过添加注册表项实现</p><p>win + r 输入 regedit</p><p>找到注册表位置：HKEY_CLASSES_ROOT\Directory\Background\shell\</p><p>右键“shel”l,新建“项”，命名为“以管理员身份打开cmd”，</p><p>右键“以管理员身份打开cmd”，新建“DWORD(32位)值”，命名为”ShowBasedOnVelocityId”,值为“639bc8”</p><p>右键“以管理员身份打开cmd”，新建“项”，命名为“command”</p><p>右键“command”，点击“默认”，点击“修改”，填写数值为 cmd.exe &#x2F;s &#x2F;k pushd “%V”</p><h2 id="48、xadmin后台无法显示下拉框完整内容"><a href="#48、xadmin后台无法显示下拉框完整内容" class="headerlink" title="48、xadmin后台无法显示下拉框完整内容"></a>48、xadmin后台无法显示下拉框完整内容</h2><p>解决方案 在根目录中找到&#x2F;static&#x2F;xadmin&#x2F;vendor&#x2F;selectize&#x2F;selectize.bootstrap3.css<br>在331行后加入 position: static;</p><p><img src="https://img-blog.csdnimg.cn/20190704184201572.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="49、xadmin单点登录"><a href="#49、xadmin单点登录" class="headerlink" title="49、xadmin单点登录"></a>49、xadmin单点登录</h2><p>使用中间件实现。</p><p>新建一个utils.py文件，存放以下代码：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.sessions.models <span class="keyword">import</span> Session</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XadminMiddleware</span>(<span class="title class_ inherited__">MiddlewareMixin</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;xadmin后台单点登录&quot;&quot;&quot;</span></span><br><span class="line">        PATH_INFO = request.META.get(<span class="string">&#x27;PATH_INFO&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> PATH_INFO <span class="keyword">and</span> <span class="string">&#x27;xadmin&#x27;</span> <span class="keyword">in</span> PATH_INFO:</span><br><span class="line">            request.session.clear_expired()   <span class="comment"># 清除过期的key</span></span><br><span class="line">            session_key = request.session.session_key</span><br><span class="line">            <span class="keyword">for</span> session <span class="keyword">in</span> Session.objects.<span class="built_in">filter</span>(~Q(session_key=session_key), expire_date__gte=timezone.now()):</span><br><span class="line">                data = session.get_decoded()</span><br><span class="line">                <span class="keyword">if</span> data.get(<span class="string">&#x27;_auth_user_id&#x27;</span>, <span class="literal">None</span>) == <span class="built_in">str</span>(request.user.<span class="built_in">id</span>):</span><br><span class="line">                    session.delete()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后在urls.py中设置：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">...</span><br><span class="line">re_path(<span class="string">&#x27;^xadmin/&#x27;</span>, xadmin.site.urls),</span><br><span class="line">...</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>然后在settings.py中注册中间件</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">   MIDDLEWARE = [</span><br><span class="line">   ...</span><br><span class="line">   </span><br><span class="line">   <span class="string">&#x27;utils.xadminauth.XadminMiddleware&#x27;</span>,</span><br><span class="line">   ...</span><br><span class="line">   ]</span><br><span class="line">SESSION_COOKIE_AGE = <span class="number">1209600</span>  <span class="comment"># 设置过期时间</span></span><br><span class="line">   SESSION_SAVE_EVERY_REQUEST = Ture  <span class="comment"># 每次请求都更新</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>【参考】 <a href="https://blog.csdn.net/Python_anning">https://blog.csdn.net/Python_anning</a></p><h2 id="50、Django-restful-多个models数据表序列化合并返回（一次请求返回多个序列化器数据）"><a href="#50、Django-restful-多个models数据表序列化合并返回（一次请求返回多个序列化器数据）" class="headerlink" title="50、Django restful 多个models数据表序列化合并返回（一次请求返回多个序列化器数据）"></a>50、Django restful 多个models数据表序列化合并返回（一次请求返回多个序列化器数据）</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导入第三方包</span></span><br><span class="line">pip install django-crispy-forms==<span class="number">1.7</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在settings.py中添加应用</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">...</span><br><span class="line"><span class="string">&#x27;drf_multiple_model&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">...</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在views.py中使用</span></span><br><span class="line">    <span class="keyword">from</span> drf_multiple_model.pagination <span class="keyword">import</span> MultipleModelLimitOffsetPagination</span><br><span class="line">    <span class="keyword">from</span> drf_multiple_model.views <span class="keyword">import</span> ObjectMultipleModelAPIView</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">LimitPagination</span>(<span class="title class_ inherited__">MultipleModelLimitOffsetPagination</span>):</span><br><span class="line">        <span class="comment"># 多个models数据表联合查询，分页，每页限制数据10条</span></span><br><span class="line">        default_limit = <span class="number">10</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">StudentSerializers</span>(serializers.ModelSerializer):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;学生表序列化器&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># merchant = MerchantSerializers()</span></span><br><span class="line">        </span><br><span class="line">        register_time = serializers.DateTimeField(read_only=<span class="literal">True</span>, <span class="built_in">format</span>=<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">            model = Student</span><br><span class="line">            fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ClassesSerializers</span>(serializers.ModelSerializer):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;班级表序列化器&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># merchant = MerchantSerializers()</span></span><br><span class="line">        </span><br><span class="line">        add_time = serializers.DateTimeField(read_only=<span class="literal">True</span>, <span class="built_in">format</span>=<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">            model = Classes</span><br><span class="line">            fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">SchoolSerializers</span>(serializers.ModelSerializer):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;学校表序列化器&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># merchant = MerchantSerializers()</span></span><br><span class="line">        </span><br><span class="line">        add_time = serializers.DateTimeField(read_only=<span class="literal">True</span>, <span class="built_in">format</span>=<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">            model = School</span><br><span class="line">            fields = <span class="string">&#x27;__all__&#x27;</span>      </span><br><span class="line">            </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">StudentInfo</span>(<span class="title class_ inherited__">ObjectMultipleModelAPIView</span>):</span><br><span class="line">        <span class="comment"># 获取学生信息，班级信息，学校信息</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">            uid = request.GET.get(<span class="string">&#x27;uid&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  <span class="comment"># 学生id</span></span><br><span class="line">            cid = request.GET.get(<span class="string">&#x27;cid&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  <span class="comment"># 班级id</span></span><br><span class="line">            sid = request.GET.get(<span class="string">&#x27;sid&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  <span class="comment"># 学校id</span></span><br><span class="line">            </span><br><span class="line">            self.querylist = [</span><br><span class="line">                &#123;<span class="string">&#x27;queryset&#x27;</span>: Student.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=uid).order_by(<span class="string">&#x27;-id&#x27;</span>),</span><br><span class="line">                    <span class="string">&#x27;serializer_class&#x27;</span>:  StudentSerializers, <span class="string">&#x27;label&#x27;</span>: <span class="string">&#x27;student&#x27;</span>, &#125;,</span><br><span class="line">                &#123;<span class="string">&#x27;queryset&#x27;</span>: Classes.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=cid).order_by(<span class="string">&#x27;-id&#x27;</span>),</span><br><span class="line">                    <span class="string">&#x27;serializer_class&#x27;</span>:  ClassesSerializers, <span class="string">&#x27;label&#x27;</span>: <span class="string">&#x27;classes&#x27;</span>, &#125;,</span><br><span class="line">                &#123;<span class="string">&#x27;queryset&#x27;</span>: School.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=sid).order_by(<span class="string">&#x27;-id&#x27;</span>),</span><br><span class="line">                    <span class="string">&#x27;serializer_class&#x27;</span>:  SchoolSerializers, <span class="string">&#x27;label&#x27;</span>: <span class="string">&#x27;school&#x27;</span>, &#125;,</span><br><span class="line">            ]</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">return</span> self.<span class="built_in">list</span>(request, *args, **kwargs)</span><br><span class="line">    </span><br><span class="line">        pagination_class = LimitPagination</span><br></pre></td></tr></table></figure><h2 id="51、-Django序列化器返回外键关联数据"><a href="#51、-Django序列化器返回外键关联数据" class="headerlink" title="51、 Django序列化器返回外键关联数据"></a>51、 Django序列化器返回外键关联数据</h2><p>通过 related_name&#x3D;’goods_price’把两个表关联起来，当返回Goods的信息时也会返回相应的GoodsPrice信息</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GoodsPriceSerializers</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;商品价格表序列化器&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = GoodsPrice</span><br><span class="line">        fields = [<span class="string">&#x27;price&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoodsSerializers</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;商品表序列化器&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    goods_price = GoodsPriceSerializers(many=<span class="literal">True</span>, read_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Goods</span><br><span class="line">        fields = [<span class="string">&#x27;title&#x27;</span>,<span class="string">&#x27;goods_price&#x27;</span>]</span><br><span class="line">        depth = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Goods</span>(models.Model):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;商品表&quot;&quot;&quot;</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">50</span>, verbose_name=<span class="string">&#x27;商品名称&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;goods&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;商品信息表&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.title</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoodsPrice</span>(models.Model):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;商品价格表,通过外键关联商品信息表&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">10</span>, decimal_places=<span class="number">2</span>, default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;售价&#x27;</span>)</span><br><span class="line">    goods = models.ForeignKey(to=<span class="string">&#x27;Goods&#x27;</span>, related_name=<span class="string">&#x27;goods_price&#x27;</span>, on_delete=models.SET_NULL, blank=<span class="literal">True</span>, null=<span class="literal">True</span>,verbose_name=<span class="string">&#x27;商品&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(self.price)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        managed = <span class="literal">True</span></span><br><span class="line">        db_table = <span class="string">&#x27;goodsPrice&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;商品售价&#x27;</span></span><br><span class="line">        verbose_name_plural = verbose_name</span><br></pre></td></tr></table></figure><h2 id="52、python-Django通过User-Agent判断请求来源是微信扫一扫或者是支付宝扫一扫"><a href="#52、python-Django通过User-Agent判断请求来源是微信扫一扫或者是支付宝扫一扫" class="headerlink" title="52、python Django通过User Agent判断请求来源是微信扫一扫或者是支付宝扫一扫"></a>52、python Django通过User Agent判断请求来源是微信扫一扫或者是支付宝扫一扫</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Footest</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">     <span class="comment"># print(request.META)</span></span><br><span class="line">     <span class="keyword">if</span> <span class="string">&#x27;MicroMessenger&#x27;</span> <span class="keyword">in</span> request.META[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>]:</span><br><span class="line">         <span class="keyword">return</span> Response(data=&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;访问来源是微信&#x27;</span>&#125;)</span><br><span class="line">     <span class="keyword">elif</span> <span class="string">&#x27;AlipayClient&#x27;</span> <span class="keyword">in</span> request.META[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>]:</span><br><span class="line">         <span class="keyword">return</span> Response(data=&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;访问来源是支付宝&#x27;</span>&#125;)</span><br><span class="line">     <span class="keyword">else</span>:</span><br><span class="line">         <span class="keyword">return</span> Response(data=&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;访问来源是其他&#x27;</span>&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>User Agent中文名为用户代理，简称 UA，它是一个特殊字符串头，使得服务器能够识别客户使用的操作系统及版本、CPU 类型、浏览器及版本、浏览器渲染引擎、浏览器语言、浏览器插件等。</p><p>浏览器的 UA 字串</p><p>标准格式为： 浏览器标识 (操作系统标识; 加密等级标识; 浏览器语言) 渲染引擎标识 版本信息</p><p>获取user-Agent 之后，<br>通过识别MicroMessenger或者AlipayClient这样的关键字应该就可以判断是微信还是支付宝<br>【参考文章】 <a href="https://blog.csdn.net/fly910905/article/details/82498813?utm_source=blogxgwz4">https://blog.csdn.net/fly910905/article/details/82498813?utm_source=blogxgwz4</a></p><h2 id="53、xadmin后台集成’导入‘插件，导入excel文件"><a href="#53、xadmin后台集成’导入‘插件，导入excel文件" class="headerlink" title="53、xadmin后台集成’导入‘插件，导入excel文件"></a>53、xadmin后台集成’导入‘插件，导入excel文件</h2><p>效果图：</p><p><img src="https://img-blog.csdnimg.cn/20190426190357134.png" alt="在这里插入图片描述"></p><p>1、添加</p><p>在虚拟环境根目录\Lib\site-packages\xadmin\plugins中添加excel.py文件</p><p><img src="https://img-blog.csdnimg.cn/20190426190440451.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xadmin.views <span class="keyword">import</span> BaseAdminPlugin, ListAdminView</span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> loader</span><br><span class="line"><span class="keyword">import</span> xadmin</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ListExcelImportPlugin</span>(<span class="title class_ inherited__">BaseAdminPlugin</span>):</span><br><span class="line">    <span class="comment"># 重写init_request</span></span><br><span class="line">    import_excel = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init_request</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> self.import_excel</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">block_top_toolbar</span>(<span class="params">self, context, nodes</span>):</span><br><span class="line">        <span class="comment"># 这里 xadmin/excel/model_list.top_toolbar.import.html 是自己写的html文件</span></span><br><span class="line">      nodes.append(loader.render_to_string(<span class="string">&quot;xadmin/excel/model_list.top_toolbar.import.html&quot;</span>))</span><br><span class="line"></span><br><span class="line">xadmin.site.register_plugin(ListExcelImportPlugin, ListAdminView)</span><br></pre></td></tr></table></figure><p>在虚拟环境根目录\Lib\site-packages\xadmin\plugins__init__.py中</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PLUGINS = (</span><br><span class="line">...</span><br><span class="line">    <span class="string">&#x27;excel&#x27;</span>,</span><br><span class="line">...</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>2、添加html文件</p><p><img src="https://img-blog.csdnimg.cn/20190426190455263.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>在虚拟环境根目录\Lib\site-packages\xadmin\templates\xadmin\中增加文件夹excel,在文件夹中添加model_list.top_toolbar.import.html文件</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">    &#123;% load i18n %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-group export&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-toggle btn btn-default btn-sm&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;dropdown&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-share&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 导入数据 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;caret&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-menu&quot;</span> <span class="attr">role</span>=<span class="string">&quot;menu&quot;</span> <span class="attr">aria-labelledby</span>=<span class="string">&quot;dLabel&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">data-toggle</span>=<span class="string">&quot;modal&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#export-modal-import-excel&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-circle-arrow-down&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 导入</span><br><span class="line">            Excel<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;export-modal-import-excel&quot;</span> <span class="attr">class</span>=<span class="string">&quot;modal fade&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-dialog&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-content&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--&#123;% csrf_token %&#125;--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-header&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;close&quot;</span> <span class="attr">data-dismiss</span>=<span class="string">&quot;modal&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span>×<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;modal-title&quot;</span>&gt;</span>导入 Excel<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-body&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">onchange</span>=<span class="string">&quot;fileChange(this)&quot;</span> <span class="attr">name</span>=<span class="string">&quot;excel&quot;</span> <span class="attr">id</span>=<span class="string">&quot;submit_upload&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-footer&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span> <span class="attr">data-dismiss</span>=<span class="string">&quot;modal&quot;</span>&gt;</span>&#123;% trans &quot;Close&quot; %&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;submit_upload_b&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;icon-share&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 导入</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.modal-content --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.modal-dalog --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.modal --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">fileChange</span>(<span class="params">target</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//检测上传文件的类型</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> imgName = <span class="variable language_">document</span>.<span class="property">all</span>.<span class="property">submit_upload</span>.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> ext, idx;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (imgName == <span class="string">&#x27;&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="property">all</span>.<span class="property">submit_upload_b</span>.<span class="property">disabled</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&quot;请选择需要上传的 xls 文件!&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            idx = imgName.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (idx != -<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                ext = imgName.<span class="title function_">substr</span>(idx + <span class="number">1</span>).<span class="title function_">toUpperCase</span>();</span></span><br><span class="line"><span class="language-javascript">                ext = ext.<span class="title function_">toLowerCase</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (ext != <span class="string">&#x27;xls&#x27;</span> &amp;&amp; ext != <span class="string">&#x27;xlsx&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">document</span>.<span class="property">all</span>.<span class="property">submit_upload_b</span>.<span class="property">disabled</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(<span class="string">&quot;只能上传 .xls 类型的文件!&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="property">all</span>.<span class="property">submit_upload_b</span>.<span class="property">disabled</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(<span class="string">&quot;只能上传 .xls 类型的文件!&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#submit_upload_b&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> form_data = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> file_info = $(<span class="string">&#x27;#submit_upload&#x27;</span>)[<span class="number">0</span>].<span class="property">files</span>[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript">            form_data.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file_info);</span></span><br><span class="line"><span class="language-javascript">            form_data.<span class="title function_">append</span>(<span class="string">&#x27;file_source&#x27;</span>, $(<span class="string">&#x27;.breadcrumb li&#x27;</span>).<span class="title function_">eq</span>(<span class="number">1</span>).<span class="title function_">text</span>().<span class="title function_">trim</span>());</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> url = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">protocol</span> + <span class="string">&#x27;//&#x27;</span> + <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">host</span> + <span class="string">&#x27;/importkdorderno/&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">url</span>: url,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: form_data,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">beforeSend</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;X-CSRFToken&quot;</span>, $.<span class="title function_">getCookie</span>(<span class="string">&quot;csrftoken&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">processData</span>: <span class="literal">false</span>,  <span class="comment">// tell jquery not to process the data</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">contentType</span>: <span class="literal">false</span>, <span class="comment">// tell jquery not to set contentType</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(res.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>();</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3、在views.py处理上传的excel文件</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImportKDOrderNo</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        file = request.FILES.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">        <span class="comment"># read = InMemoryUploadedFile().open()</span></span><br><span class="line">        data = pd.read_excel(file)  <span class="comment"># 使用pandas处理excel文件</span></span><br><span class="line">file_source = request.POST.get(<span class="string">&#x27;file_source&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  <span class="comment"># 文件来源</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;订单号&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;物流单号&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> Response(data=&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;文件格式有误，第一行第一列应该为【订单号】，第一行第二列应该为【物流单号】&#x27;</span>&#125;)</span><br><span class="line">        ordernos = data[<span class="string">&#x27;订单号&#x27;</span>]</span><br><span class="line">        logistics = data[<span class="string">&#x27;物流单号&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ordernos)):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;订单号&#x27;</span>, ordernos[i], <span class="string">&#x27;物流单号&#x27;</span>, logistics[i])</span><br><span class="line">          </span><br><span class="line">        <span class="keyword">return</span> Response(data=&#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;上传成功&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p>4、在urls.py中添加访问路由</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> 你的应用名称 <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">app_name = <span class="string">&#x27;你的应用名称&#x27;</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 其他路由</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 导入物流单号</span></span><br><span class="line">    path(<span class="string">&#x27;importkdorderno/&#x27;</span>, views.ImportKDOrderNo.as_view(), name=<span class="string">&#x27;importkdorderno&#x27;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="54、Django中查找今天进账金额"><a href="#54、Django中查找今天进账金额" class="headerlink" title="54、Django中查找今天进账金额"></a>54、Django中查找今天进账金额</h2><p>views.py</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CountFee</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line"><span class="comment"># 获取当前时间的年月日，然后使用聚合函数添加fee字段的值</span></span><br><span class="line">    year = datetime.now().year</span><br><span class="line">        month = datetime.now().month</span><br><span class="line">        day = datetime.now().day</span><br><span class="line">        count_fees = FeeDetail.objects.<span class="built_in">filter</span>(addtime__year=year, addtime__month=month, addtime__day=day).aggregate(Sum(<span class="string">&#x27;fee&#x27;</span>))</span><br><span class="line">        all_fee = count_fees[<span class="string">&#x27;fee__sum&#x27;</span>] <span class="keyword">if</span> count_fees[<span class="string">&#x27;fee__sum&#x27;</span>] <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        <span class="built_in">print</span>(all_fee)</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;data&#x27;</span>: &#123;<span class="string">&#x27;all_fee&#x27;</span>: all_fee&#125;&#125;)</span><br></pre></td></tr></table></figure><h2 id="55、判断是什么系统"><a href="#55、判断是什么系统" class="headerlink" title="55、判断是什么系统"></a>55、判断是什么系统</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> platform</span><br><span class="line">PlATFORM = platform.system()</span><br><span class="line"><span class="keyword">if</span> PlATFORM == <span class="string">&quot;Linux&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;其他&#x27;</span>) </span><br></pre></td></tr></table></figure><h2 id="56、sql查询"><a href="#56、sql查询" class="headerlink" title="56、sql查询"></a>56、sql查询</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 联合更新</span></span><br><span class="line">update malluser <span class="built_in">set</span> master_master_id=<span class="number">3</span> where master_id <span class="keyword">in</span> (select a.<span class="built_in">id</span> <span class="keyword">from</span> (select <span class="built_in">id</span> <span class="keyword">from</span>  malluser where <span class="built_in">id</span> like <span class="string">&#x27;15%&#x27;</span>)a) </span><br><span class="line"><span class="comment"># 统计某字段重复数据</span></span><br><span class="line">SELECT phone, COUNT(*) AS sumCount FROM malluser GROUP BY phone HAVING sumCount &gt; <span class="number">1</span>;</span><br></pre></td></tr></table></figure><h2 id="57、-xadmin后台删除数据出现错误"><a href="#57、-xadmin后台删除数据出现错误" class="headerlink" title="57、 xadmin后台删除数据出现错误"></a>57、 xadmin后台删除数据出现错误</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">`get_deleted_objects() takes <span class="number">3</span> positional arguments but <span class="number">5</span> were given`</span><br></pre></td></tr></table></figure><p>这是由于Django2.1版本和xadmin不兼容导致的</p><p>知道虚拟环境\Lib\site-packages\xadmin\plugins\actions.py</p><p>修改93行，</p><p>把</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">deletable_objects, model_count, perms_needed, protected = get_deleted_objects(</span><br><span class="line">            queryset, self.opts, self.user, self.admin_site, using)</span><br></pre></td></tr></table></figure><p>改为</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">deletable_objects, model_count, perms_needed, protected = get_deleted_objects(</span><br><span class="line">            queryset, self.user, self.admin_site)</span><br></pre></td></tr></table></figure><p>然后在adminx.py文件中对应的模型类中允许删除</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MaterialAdmin</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;素材库分类&quot;&quot;&quot;</span></span><br><span class="line">    list_display = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;class_id&#x27;</span>, <span class="string">&#x27;is_delete&#x27;</span>, <span class="string">&#x27;addtime&#x27;</span>]</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_delete_permission</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h2 id="58、xdamin限制用户点击"><a href="#58、xdamin限制用户点击" class="headerlink" title="58、xdamin限制用户点击"></a>58、xdamin限制用户点击</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">//如果登录z=xadmin后台的账号不是【root】的就不能点击更新操作</span><br><span class="line">    var master_name = $(<span class="string">&#x27;#top-nav&#x27;</span>).find(<span class="string">&#x27;strong&#x27;</span>).text();</span><br><span class="line">        master_name =  master_name.substring(<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">if</span>(master_name != <span class="string">&#x27;root&#x27;</span>)&#123;</span><br><span class="line">            $(<span class="string">&quot;.grid-item a&quot;</span>).each(function(index, element) &#123;</span><br><span class="line">                $(this).attr(<span class="string">&#x27;href&#x27;</span>,<span class="string">&#x27;#&#x27;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h2 id="59、获取公众号关注url"><a href="#59、获取公众号关注url" class="headerlink" title="59、获取公众号关注url"></a>59、获取公众号关注url</h2><p>在微信网页版，打开公众号，点击右上角“…”，在弹框中选择右下角中间的“查看历史记录”，然后在弹框中选择左上角倒数第一个，“用默认浏览器打开”，就可以在打开的浏览器中获取该公众号的关注url，当把这个url发给好友时，好友点开的就是去关注公众号的页面。</p><h2 id="60、xadmin后台用户操作表权限"><a href="#60、xadmin后台用户操作表权限" class="headerlink" title="60、xadmin后台用户操作表权限"></a>60、xadmin后台用户操作表权限</h2><p>虚拟环境根目录\Lib\site-packages\xadmin\views\base.py</p><p>可以找到：</p><p><img src="https://img-blog.csdnimg.cn/20190627140512311.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>在项目子应用下的adminx.py中使用</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xadmin</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> machine.models <span class="keyword">import</span> Machine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MachineAdmin</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    list_display = [<span class="string">&#x27;code&#x27;</span>,]  <span class="comment"># 显示的字段</span></span><br><span class="line"></span><br><span class="line">    search_fields = [<span class="string">&#x27;code&#x27;</span>]  <span class="comment"># 搜索的字段</span></span><br><span class="line">    list_filter = [<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;is_delete&#x27;</span>] <span class="comment"># 过滤的字段</span></span><br><span class="line">    ordering = (<span class="string">&#x27;-id&#x27;</span>,) <span class="comment"># 按id降序排序</span></span><br><span class="line">    list_editable = [<span class="string">&#x27;is_delete&#x27;</span>, ]  <span class="comment"># 数据即时编辑</span></span><br><span class="line">    list_per_page = <span class="number">30</span>  <span class="comment"># 每页显示数据数量</span></span><br><span class="line">    model_icon = <span class="string">&#x27;fa fa-cog fa-spin&#x27;</span>  <span class="comment"># 左侧显示的小图标</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_delete_permission</span>(<span class="params">self, *args, **kwargs</span>): </span><br><span class="line">        <span class="comment"># 删除权限</span></span><br><span class="line">        <span class="keyword">if</span> self.request.user.is_superuser:  <span class="comment"># 管理员才能增加</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_add_permission</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> self.request.user.is_superuser:  <span class="comment"># 管理员才能增加</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_change_permission</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> self.request.user.is_superuser: <span class="comment"># 管理员才能修改</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">queryset</span>(<span class="params">self</span>):</span><br><span class="line">        qs = <span class="built_in">super</span>(MachineAdmin, self).queryset()</span><br><span class="line">        <span class="keyword">if</span> self.request.user.is_superuser:  <span class="comment"># 管理员可以查看所有</span></span><br><span class="line">            <span class="keyword">return</span> qs</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 登录用户只能看到自己修改的数据</span></span><br><span class="line">            <span class="keyword">return</span> qs.<span class="built_in">filter</span>(master_id=self.request.user.last_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xadmin.site.register(MallMachine, MallMachineAdmin)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="61、使用nginx部署项目"><a href="#61、使用nginx部署项目" class="headerlink" title="61、使用nginx部署项目"></a>61、使用nginx部署项目</h2><p>先在&#x2F;etc&#x2F;nginx&#x2F;sites-available中创建一个配置文件，文件名为test(注意没有后缀):</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#设定虚拟主机配置</span></span><br><span class="line">    server &#123;</span><br><span class="line">        <span class="comment">#侦听80端口</span></span><br><span class="line">        listen <span class="number">80</span>;</span><br><span class="line">        listen <span class="number">443</span> ssl;</span><br><span class="line">        <span class="comment">#定义使用 www.nginx.cn访问</span></span><br><span class="line"><span class="comment">#ssl on;</span></span><br><span class="line">        server_name  xxx.xxx.com;</span><br><span class="line">        <span class="comment">#定义服务器的默认网站根目录位置</span></span><br><span class="line">        root /root/项目名称;</span><br><span class="line">ssl_session_timeout 5m; </span><br><span class="line">        ssl_certificate   /etc/nginx/cert/xxx.pem;</span><br><span class="line">        ssl_certificate_key  /etc/nginx/cert/xxx.key;</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1<span class="number">.1</span> TLSv1<span class="number">.2</span>;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        <span class="comment">#设定本虚拟主机的访问日志</span></span><br><span class="line">        <span class="comment">#access_log  logs/nginx.access.log  main;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">#默认请求</span></span><br><span class="line">        location / &#123;</span><br><span class="line">            <span class="comment">#倒入了uwsgi的配置</span></span><br><span class="line">            include uwsgi_params; </span><br><span class="line">    client_max_body_size50m;</span><br><span class="line">            <span class="comment">#连接uwsgi的超时时间</span></span><br><span class="line">           <span class="comment"># uwsgi_connect_timeout 30; </span></span><br><span class="line">     <span class="comment">#设定了uwsig服务器位置</span></span><br><span class="line">     uwsgi_pass <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8002</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        location /static&#123;</span><br><span class="line">      alias /root/项目名称/static;</span><br><span class="line">        &#125;</span><br><span class="line">location /media &#123;</span><br><span class="line">alias /root/项目名称/media;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其中xxx.xxx.com表示域名.如果没有https，就使用#把ssl注释掉就可以了。</p><p>然后把test映射到&#x2F;etc&#x2F;nginx&#x2F;sites-enabled</p><p>命令</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ln -s /etc/nginx/sites-available/test /etc/nginx/sites-enabled/test</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>即可<br>注意：<br>uwsgi中配置listen&#x3D;1024时，启动uwsgi时可能会报错：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">django + uwsgi + nginx 日志Listen queue size <span class="keyword">is</span> greater than the system <span class="built_in">max</span> net.core.somaxconn (<span class="number">128</span>).</span><br></pre></td></tr></table></figure><p>解决方法:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">修改系统参数</span><br><span class="line"></span><br><span class="line">/proc/sys/net/ipv4/tcp_max_syn_backlog  原来<span class="number">2048</span>    改为<span class="number">8192</span></span><br><span class="line">/proc/sys/net/core/somaxconn原来<span class="number">128</span>     改为<span class="number">262144</span></span><br></pre></td></tr></table></figure><p>重启nginx</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h2 id="62、xadmin后台发送邮件找回密码"><a href="#62、xadmin后台发送邮件找回密码" class="headerlink" title="62、xadmin后台发送邮件找回密码"></a>62、xadmin后台发送邮件找回密码</h2><p><img src="https://img-blog.csdnimg.cn/20190710230444358.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>输入你用户绑定的邮箱</p><p><img src="https://img-blog.csdnimg.cn/20190710230454725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>想要发送邮件，需要在settings.py中设置邮件发送器</p><p>settings.py最下面增加</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ------------------------邮箱配置-----------------------------------------</span></span><br><span class="line">EMAIL_BACKEND = <span class="string">&#x27;django.core.mail.backends.smtp.EmailBackend&#x27;</span> <span class="comment">#把要发送的邮件显示再控制台上，方便调试</span></span><br><span class="line">EMAIL_USE_SSL = <span class="literal">True</span></span><br><span class="line">EMAIL_HOST = <span class="string">&#x27;smtp.qq.com&#x27;</span>  <span class="comment"># 如果是 163 改成 smtp.163.com</span></span><br><span class="line">EMAIL_PORT = <span class="number">465</span></span><br><span class="line">EMAIL_HOST_USER = <span class="string">&#x27;邮箱账号&#x27;</span> <span class="comment"># 帐号</span></span><br><span class="line">EMAIL_HOST_PASSWORD = <span class="string">&#x27;授权码&#x27;</span>  <span class="comment"># 到邮箱里开通</span></span><br><span class="line">DEFAULT_FROM_EMAIL = EMAIL_HOST_USER</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>由于django2与xadmin有些地方不兼容，需要修改源码：</p><p>找到虚拟环境根目录\Lib\site-packages\xadmin\plugins\passwords.py</p><p>在passwords.py文件中大概79行，修改为</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> password_reset_confirm(request=request, uidb36=uidb36, token=token,</span><br><span class="line">                                      template_name=self.password_reset_confirm_template,</span><br><span class="line">                                      token_generator=self.password_reset_token_generator,</span><br><span class="line">                                      set_password_form=self.password_reset_set_form,</span><br><span class="line">                                      post_reset_redirect=self.get_admin_url(<span class="string">&#x27;xadmin_password_reset_complete&#x27;</span>),</span><br><span class="line">                                      current_app=self.admin_site.name, extra_context=context).dispatch(request=request,</span><br><span class="line">                                                                                                        uidb64=uidb36,token=token)</span><br><span class="line">             </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>找到虚拟环境根目录Lib\site-packages\django\contrib\auth\views.py</p><p>在views.py文件中大概258行，增加：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 成功后跳转路由,根据自己实际来定</span></span><br><span class="line">self.success_url = self.request.build_absolute_uri(<span class="string">&#x27;/&#x27;</span>) + <span class="string">&#x27;xadmin/&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2020052620533440.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="63、xadmin外键下拉框添加过滤"><a href="#63、xadmin外键下拉框添加过滤" class="headerlink" title="63、xadmin外键下拉框添加过滤"></a>63、xadmin外键下拉框添加过滤</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MallGoodsAdmin</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;商品管理&quot;&quot;&quot;</span></span><br><span class="line">    list_display = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;show_photo&#x27;</span>, <span class="string">&#x27;nickname&#x27;</span>, <span class="string">&#x27;merchant&#x27;</span>, <span class="string">&#x27;goods_class&#x27;</span>, <span class="string">&#x27;label&#x27;</span>,]</span><br><span class="line">    search_fields = [<span class="string">&#x27;nickname&#x27;</span>]</span><br><span class="line">    list_filter = [<span class="string">&#x27;goods_class&#x27;</span>, <span class="string">&#x27;label&#x27;</span>,]</span><br><span class="line">    model_icon = <span class="string">&#x27;fa fa-bars&#x27;</span></span><br><span class="line">    list_editable = [<span class="string">&#x27;goods_class&#x27;</span>, ]</span><br><span class="line">    <span class="comment">#,重写虚拟环境根目录下\Lib\site-packages\xadmin\views\edit.py中的formfield_for_dbfield</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">formfield_for_dbfield</span>(<span class="params">self, db_field, **kwargs</span>):</span><br><span class="line">        <span class="comment"># 对MallGoodsClass这个表项的下拉框选择进行过滤</span></span><br><span class="line">        <span class="comment"># MallGoods中有一个goods_class商品分类外键MallGoodsClass，过滤掉外键MallGoodsClass中 </span></span><br><span class="line">        <span class="comment"># master_class为空的值</span></span><br><span class="line">        <span class="keyword">if</span> db_field.name == <span class="string">&quot;goods_class&quot;</span>:</span><br><span class="line">            kwargs[<span class="string">&quot;queryset&quot;</span>] = MallGoodsClass.objects.<span class="built_in">filter</span>(master_class__isnull=<span class="literal">False</span>)</span><br><span class="line">            <span class="comment"># 对assigned_recipient这个表项的下拉选择进行过滤</span></span><br><span class="line">        <span class="keyword">return</span> db_field.formfield(**<span class="built_in">dict</span>(**kwargs))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().formfield_for_dbfield(db_field, **kwargs)</span><br><span class="line"></span><br><span class="line">xadmin.site.register(models.MallGoods, MallGoodsAdmin)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="64、xadmin即时编辑器去掉空标签"><a href="#64、xadmin即时编辑器去掉空标签" class="headerlink" title="64、xadmin即时编辑器去掉空标签"></a>64、xadmin即时编辑器去掉空标签</h2><p><img src="https://img-blog.csdnimg.cn/20190716151440115.png" alt="在这里插入图片描述"></p><p>虚拟环境根目录下\Lib\site-packages\xadmin\plugins\editable.py，在大概</p><p>129行增加：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">form.fields[fields[<span class="number">0</span>]].empty_label = <span class="literal">None</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20190716151459680.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="65、用户增加的小组件，让其他用户可见"><a href="#65、用户增加的小组件，让其他用户可见" class="headerlink" title="65、用户增加的小组件，让其他用户可见"></a>65、用户增加的小组件，让其他用户可见</h2><p>找到虚拟环境根目录\Lib\site-packages\xadmin\views\dashboard.py</p><p>在548行、554行</p><p><img src="https://img-blog.csdnimg.cn/20190723175537371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>改为：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@filter_hook</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_widgets</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.widget_customiz:</span><br><span class="line">            portal_pos = UserSettings.objects.<span class="built_in">filter</span>(</span><br><span class="line">               key=self.get_portal_key())</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(portal_pos):</span><br><span class="line">                portal_pos = portal_pos[<span class="number">0</span>].value</span><br><span class="line">                widgets = []</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> portal_pos:</span><br><span class="line">                    user_widgets = <span class="built_in">dict</span>([(uw.<span class="built_in">id</span>, uw) <span class="keyword">for</span> uw <span class="keyword">in</span> UserWidget.objects.<span class="built_in">filter</span>(page_id=self.get_page_id())])</span><br><span class="line">                    <span class="keyword">for</span> col <span class="keyword">in</span> portal_pos.split(<span class="string">&#x27;|&#x27;</span>):</span><br><span class="line">                        ws = []</span><br><span class="line">                        <span class="keyword">for</span> wid <span class="keyword">in</span> col.split(<span class="string">&#x27;,&#x27;</span>):</span><br><span class="line">                            <span class="keyword">try</span>:</span><br><span class="line">                                widget = user_widgets.get(<span class="built_in">int</span>(wid))</span><br><span class="line">                                <span class="keyword">if</span> widget:</span><br><span class="line">                                    ws.append(self.get_widget(widget))</span><br><span class="line">                            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                                <span class="keyword">import</span> logging</span><br><span class="line">                                logging.error(e, exc_info=<span class="literal">True</span>)</span><br><span class="line">                        widgets.append(ws)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> widgets</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.get_init_widget()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="66、pip-install-uwsgi出错"><a href="#66、pip-install-uwsgi出错" class="headerlink" title="66、pip install uwsgi出错"></a>66、pip install uwsgi出错</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plugins/python/uwsgi_python.h:<span class="number">2</span>:<span class="number">20</span>: fatal error: Python.h: No such file <span class="keyword">or</span> directory</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>首先安装python3环境</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install python3-dev</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后再虚拟环境中</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install uwsgi</span><br></pre></td></tr></table></figure><h2 id="66、xadmin后台加载数据慢，解决方案"><a href="#66、xadmin后台加载数据慢，解决方案" class="headerlink" title="66、xadmin后台加载数据慢，解决方案"></a>66、xadmin后台加载数据慢，解决方案</h2><p>list_filter: 过滤器要慎用，不要使用类似id这些数据量大的字段</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MallUserAdmin</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;用户管理&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    list_display = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;tp_icon&#x27;</span>, <span class="string">&#x27;nickname&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>, <span class="string">&#x27;level&#x27;</span>, <span class="string">&#x27;balance&#x27;</span>, <span class="string">&#x27;province&#x27;</span>, <span class="string">&#x27;city&#x27;</span>, <span class="string">&#x27;quxian&#x27;</span>]  <span class="comment"># 显示字段</span></span><br><span class="line">    search_fields = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;nickname&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>]  <span class="comment"># 搜索</span></span><br><span class="line">    list_filter = [<span class="string">&#x27;level&#x27;</span>, <span class="string">&#x27;province&#x27;</span>, <span class="string">&#x27;city&#x27;</span>, <span class="string">&#x27;quxian&#x27;</span>]  <span class="comment"># 过滤器</span></span><br><span class="line">    <span class="comment"># list_filter = [&#x27;id&#x27;, &#x27;level&#x27;, &#x27;province&#x27;, &#x27;city&#x27;, &#x27;quxian&#x27;]  # 如果加id，xadmin加载回来的数据就会很慢，所以不要在过滤器上使用id</span></span><br><span class="line">    list_per_page = <span class="number">30</span>  <span class="comment"># 默认每页数量</span></span><br><span class="line">    model_icon = <span class="string">&#x27;fa fa-users&#x27;</span>  <span class="comment"># 左侧图标</span></span><br><span class="line">    ordering = [<span class="string">&#x27;-id&#x27;</span>]  <span class="comment"># 排序</span></span><br><span class="line">    readonly_fields = [<span class="string">&#x27;subscribe&#x27;</span>, <span class="string">&#x27;wx_openid&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>]  <span class="comment"># 只读字段</span></span><br><span class="line">    is_addbalance = <span class="literal">True</span>   <span class="comment"># 加载自定义的插件</span></span><br><span class="line">    relfield_style = <span class="string">&#x27;fk-ajax&#x27;</span>  <span class="comment"># 其他表如果外键到用户表就做ajax搜索查询，不一次性加载数据</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="67-、xadmin导出插件处理，增加导出勾选数据项"><a href="#67-、xadmin导出插件处理，增加导出勾选数据项" class="headerlink" title="67 、xadmin导出插件处理，增加导出勾选数据项"></a>67 、xadmin导出插件处理，增加导出勾选数据项</h2><p>常规的导出只有两个选择【导出表头】、【导出全部数据】</p><p><img src="https://img-blog.csdnimg.cn/20190917141511283.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>现在想要做的是增加一个选择，即【导出表头】、【导出全部数据】、【导出勾选数据】，如下图：</p><p><img src="https://img-blog.csdnimg.cn/20190917141839822.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>需要修改xadmin源代码，具体如下</p><h4 id="1、加载js文件"><a href="#1、加载js文件" class="headerlink" title="1、加载js文件"></a>1、加载js文件</h4><p>找到虚拟环境\Lib\site-packages\xadmin\views\list.py，在607行增加’xadmin.plugin.importexport.js’，如下图所示</p><p><img src="https://img-blog.csdnimg.cn/20190917141853832.png" alt="在这里插入图片描述"></p><h4 id="2、修改export-py，后端处理下载文件"><a href="#2、修改export-py，后端处理下载文件" class="headerlink" title="2、修改export.py，后端处理下载文件"></a>2、修改export.py，后端处理下载文件</h4><p>找到虚拟环境\Lib\site-packages\xadmin\plugins\export.py</p><p>在84行把rows &#x3D; context[‘results’]修改成如下函数</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 新增导出所选数据</span></span><br><span class="line"><span class="comment"># rows = context[&#x27;results&#x27;]  </span></span><br><span class="line">rows = []</span><br><span class="line">select_across = self.request.GET.get(<span class="string">&#x27;_select_across&#x27;</span>, <span class="literal">False</span>) == <span class="string">&#x27;1&#x27;</span></span><br><span class="line">selected = self.request.GET.get(<span class="string">&#x27;_selected_actions&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> self.request.GET.get(<span class="string">&#x27;selected&#x27;</span>, <span class="string">&#x27;off&#x27;</span>) == <span class="string">&#x27;on&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> select_across:</span><br><span class="line">        selected_pk = selected.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> context[<span class="string">&#x27;results&#x27;</span>]:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">str</span>(i[<span class="string">&#x27;object&#x27;</span>].<span class="built_in">id</span>) <span class="keyword">in</span> selected_pk:</span><br><span class="line">                rows.append(i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rows = context[<span class="string">&#x27;results&#x27;</span>]</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    rows = context[<span class="string">&#x27;results&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/2019091714200418.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>3、 修改model_list.top_toolbar.exports.html<br>找到虚拟环境\Lib\site-packages\xadmin\templates\xadmin\blocks\model_list.top_toolbar.exports.html</p><p>使用以下代码覆盖原文件</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% load i18n %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-group export&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;export-menu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-toggle btn btn-default btn-sm&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;dropdown&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-share&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> &#123;% trans &quot;Export&quot; %&#125; <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;caret&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-menu&quot;</span> <span class="attr">role</span>=<span class="string">&quot;menu&quot;</span> <span class="attr">aria-labelledby</span>=<span class="string">&quot;dLabel&quot;</span>&gt;</span></span><br><span class="line">        &#123;% for et in export_types %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">data-toggle</span>=<span class="string">&quot;modal&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#export-modal-&#123;&#123;et.type&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-arrow-circle-down&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">i</span>&gt;</span> &#123;% trans &quot;Export&quot; %&#125; &#123;&#123;et.name&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% for et in export_types %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;export-modal-&#123;&#123;et.type&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;modal fade&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-dialog&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-content&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-header&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;close&quot;</span> <span class="attr">data-dismiss</span>=<span class="string">&quot;modal&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="symbol">&amp;times;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;modal-title&quot;</span>&gt;</span>&#123;% trans &quot;Export&quot; %&#125; &#123;&#123;et.name&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-body&quot;</span>&gt;</span></span><br><span class="line">                        &#123;&#123; form_params|safe &#125;&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;export_type&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;et.type&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 增加 导出所选数据 一栏 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_selected_actions&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_select_across&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">                            &#123;% if et.type == &quot;xlsx&quot; %&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;export_xlsx_header&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> <span class="attr">value</span>=<span class="string">&quot;on&quot;</span>&gt;</span></span><br><span class="line">                            &#123;% trans &quot;Export with table header.&quot; %&#125;</span><br><span class="line">                            &#123;% endif %&#125;</span><br><span class="line">                            &#123;% if et.type == &quot;xls&quot; %&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;export_xls_header&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> <span class="attr">value</span>=<span class="string">&quot;on&quot;</span>&gt;</span></span><br><span class="line">                            &#123;% trans &quot;Export with table header.&quot; %&#125;</span><br><span class="line">                            &#123;% endif %&#125;</span><br><span class="line">                            &#123;% if et.type == &quot;csv&quot; %&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;export_csv_header&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> <span class="attr">value</span>=<span class="string">&quot;on&quot;</span>&gt;</span></span><br><span class="line">                            &#123;% trans &quot;Export with table header.&quot; %&#125;</span><br><span class="line">                            &#123;% endif %&#125;</span><br><span class="line">                            &#123;% if et.type == &quot;xml&quot; %&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;export_xml_format&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> <span class="attr">value</span>=<span class="string">&quot;on&quot;</span>&gt;</span></span><br><span class="line">                            &#123;% trans &quot;Export with format.&quot; %&#125;</span><br><span class="line">                            &#123;% endif %&#125;</span><br><span class="line">                            &#123;% if et.type == &quot;json&quot; %&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;export_json_format&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;checked&quot;</span> <span class="attr">value</span>=<span class="string">&quot;on&quot;</span>&gt;</span></span><br><span class="line">                            &#123;% trans &quot;Export with format.&quot; %&#125;</span><br><span class="line">                            &#123;% endif %&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;all&quot;</span> <span class="attr">value</span>=<span class="string">&quot;on&quot;</span>&gt;</span> &#123;% trans &quot;Export all data.&quot; %&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 增加 导出所选数据 一栏 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;selected&quot;</span> <span class="attr">value</span>=<span class="string">&quot;on&quot;</span>&gt;</span> 导出勾选数据</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-footer&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span> <span class="attr">data-dismiss</span>=<span class="string">&quot;modal&quot;</span>&gt;</span>&#123;% trans &quot;Close&quot; %&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success myexport  glyphicon glyphicon-export &quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">class</span>=<span class="string">&quot;fa fa-share&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> &#123;% trans &quot;Export&quot; %&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.modal-content --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.modal-dalog --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.modal --&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 如果是订单导出，把待出货订单设置成待收货订单</span></span></span><br><span class="line"><span class="language-javascript">    $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;.myexport&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 当把订单导出时，需要修改订单状态为待收货状态</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> url = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">protocol</span> + <span class="string">&#x27;//&#x27;</span> + <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">host</span> + <span class="string">&quot;/exportorder/&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&quot;input[name=&#x27;_select_across&#x27;]&quot;</span>).<span class="title function_">val</span>($(<span class="string">&quot;input[name=&#x27;select_across&#x27;]&quot;</span>).<span class="title function_">val</span>());</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> ($(<span class="string">&quot;input[name=&#x27;selected&#x27;]&quot;</span>).<span class="title function_">is</span>(<span class="string">&#x27;:checked&#x27;</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> arr = [];</span></span><br><span class="line"><span class="language-javascript">                $.<span class="title function_">each</span>($(<span class="string">&#x27;.action-select&#x27;</span>), <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (<span class="literal">true</span> == $(<span class="variable language_">this</span>).<span class="title function_">prop</span>(<span class="string">&#x27;checked&#x27;</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">                        arr.<span class="title function_">push</span>($(<span class="variable language_">this</span>).<span class="title function_">val</span>());</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span>(arr.<span class="property">length</span> == <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(<span class="string">&#x27;请先勾选导出数据&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> arr = []</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> order_type = $(<span class="string">&#x27;.breadcrumb li&#x27;</span>).<span class="title function_">eq</span>(<span class="number">1</span>).<span class="title function_">text</span>().<span class="title function_">trim</span>()</span></span><br><span class="line"><span class="language-javascript">                $(<span class="string">&#x27;.grid-item&#x27;</span>).<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">index, el</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    arr.<span class="title function_">push</span>($(el).<span class="title function_">find</span>(<span class="string">&#x27;td&#x27;</span>).<span class="title function_">eq</span>(<span class="number">1</span>).<span class="title function_">text</span>().<span class="title function_">trim</span>())</span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (($(<span class="string">&#x27;.breadcrumb &gt; li&#x27;</span>).<span class="title function_">eq</span>(<span class="number">1</span>).<span class="title function_">text</span>()).<span class="title function_">indexOf</span>(<span class="string">&#x27;订单&#x27;</span>) != -<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 5秒后执行</span></span></span><br><span class="line"><span class="language-javascript">                <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">url</span>: url,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: &#123;<span class="string">&#x27;orderlist&#x27;</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(arr), <span class="string">&#x27;order_type&#x27;</span>: order_type,&#125;,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">beforeSend</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                            xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;X-CSRFToken&quot;</span>, $.<span class="title function_">getCookie</span>(<span class="string">&quot;csrftoken&quot;</span>))</span></span><br><span class="line"><span class="language-javascript">                        &#125;,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>();</span></span><br><span class="line"><span class="language-javascript">                        &#125;,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="title function_">alert</span>(<span class="string">&quot;出现未知错误&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>();</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;, <span class="number">5000</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="68、使用F查询更新用户重要数据"><a href="#68、使用F查询更新用户重要数据" class="headerlink" title="68、使用F查询更新用户重要数据"></a>68、使用F查询更新用户重要数据</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line"><span class="comment"># 使用F查询更新用户余额</span></span><br><span class="line">balance = <span class="number">5</span>  </span><br><span class="line">MallUser.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">1</span>).update(balance=F(<span class="string">&#x27;balance&#x27;</span>) + balance)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>相当于sql的</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">update Malluser <span class="built_in">set</span> balance=balance + <span class="number">5</span> where <span class="built_in">id</span>=<span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="69、日志输出模块"><a href="#69、日志输出模块" class="headerlink" title="69、日志输出模块"></a>69、日志输出模块</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="comment"># 全局函数</span></span><br><span class="line">PlATFORM = platform.system()</span><br><span class="line"><span class="keyword">if</span> (PlATFORM == <span class="string">&quot;Linux&quot;</span>):</span><br><span class="line">    <span class="comment"># linux系统,文件保存在var下</span></span><br><span class="line">    SERVER_LOG_PATH = <span class="string">&#x27;/var/mylog.log&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># windows系统,文件保存在D盘下</span></span><br><span class="line">    SERVER_LOG_PATH = <span class="string">&#x27;D:\mylog.log&#x27;</span></span><br><span class="line"><span class="comment"># 定义一个logging的对象，命名为mylog</span></span><br><span class="line">LOGGER = logging.getLogger(<span class="string">&#x27;mylog&#x27;</span>)</span><br><span class="line"><span class="comment"># 设置级别为WARNING</span></span><br><span class="line">LOGGER.setLevel(logging.WARNING)</span><br><span class="line"><span class="comment"># 创建一个handler，用于写入日志文件</span></span><br><span class="line">fh = logging.FileHandler(SERVER_LOG_PATH, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">fh.setLevel(logging.WARNING)</span><br><span class="line"><span class="comment"># 定义handler的输出格式</span></span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>, datefmt=<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">fh.setFormatter(formatter)</span><br><span class="line"><span class="comment"># 给Logger添加handler</span></span><br><span class="line">LOGGER.addHandler(fh)</span><br><span class="line"><span class="comment"># 不在控制台显示</span></span><br><span class="line">LOGGER.propagate = <span class="literal">False</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="70、字典排序"><a href="#70、字典排序" class="headerlink" title="70、字典排序"></a>70、字典排序</h2><p>字典在内存中发布是无序的，当想对键值或者键名进行排序时可以先把字典转成元组，这可以达到排序的目的。</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">score = &#123;<span class="string">&#x27;小明&#x27;</span>: &#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">90</span>, &#125;,</span><br><span class="line">     <span class="string">&#x27;小红&#x27;</span>: &#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">60</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">60</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">61</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">59</span>, &#125;,</span><br><span class="line">     <span class="string">&#x27;小黑&#x27;</span>: &#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">70</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">75</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">65</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">70</span>, &#125;,</span><br><span class="line">     <span class="string">&#x27;小白&#x27;</span>: &#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">80</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">95</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">65</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">80</span>, &#125;,</span><br><span class="line">     &#125;</span><br><span class="line"><span class="comment"># 对姓名进行排序，即对键名进行排序</span></span><br><span class="line">b = <span class="built_in">sorted</span>(score.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">show_str = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> info <span class="keyword">in</span> b:</span><br><span class="line">    <span class="comment"># print(info)</span></span><br><span class="line">    key, value = info[<span class="number">0</span>], info[<span class="number">1</span>]</span><br><span class="line">    show_str += <span class="string">&#x27;姓名：&#123;&#125;,平均分：&#123;&#125;，成绩：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(key,value[<span class="string">&#x27;avg_score&#x27;</span>], value) + <span class="string">&#x27;\r\n&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;对姓名进行排序&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(show_str)</span><br><span class="line"><span class="comment"># 对平均分进行排序</span></span><br><span class="line">b = <span class="built_in">sorted</span>(score.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>][<span class="string">&#x27;avg_score&#x27;</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">show_str = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> info <span class="keyword">in</span> b:</span><br><span class="line">    <span class="comment"># print(info)</span></span><br><span class="line">    key, value = info[<span class="number">0</span>], info[<span class="number">1</span>]</span><br><span class="line">    show_str += <span class="string">&#x27;姓名：&#123;&#125;,平均分：&#123;&#125;，成绩：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(key,value[<span class="string">&#x27;avg_score&#x27;</span>], value) + <span class="string">&#x27;\r\n&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;对平均分进行排序&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(show_str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对英语成绩进行排序</span></span><br><span class="line">b = <span class="built_in">sorted</span>(score.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>][<span class="string">&#x27;English&#x27;</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">show_str = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> info <span class="keyword">in</span> b:</span><br><span class="line">    <span class="comment"># print(info)</span></span><br><span class="line">    key, value = info[<span class="number">0</span>], info[<span class="number">1</span>]</span><br><span class="line">    show_str += <span class="string">&#x27;姓名：&#123;&#125;,平均分：&#123;&#125;，成绩：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(key,value[<span class="string">&#x27;avg_score&#x27;</span>], value) + <span class="string">&#x27;\r\n&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;对英语成绩进行排序&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(show_str)</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">对姓名进行排序</span><br><span class="line">姓名：小黑,平均分：<span class="number">70</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">70</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">75</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">65</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">70</span>&#125;</span><br><span class="line">姓名：小红,平均分：<span class="number">60</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">60</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">60</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">61</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">59</span>&#125;</span><br><span class="line">姓名：小白,平均分：<span class="number">80</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">80</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">95</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">65</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">80</span>&#125;</span><br><span class="line">姓名：小明,平均分：<span class="number">90</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">90</span>&#125;</span><br><span class="line"></span><br><span class="line">对平均分进行排序</span><br><span class="line">姓名：小明,平均分：<span class="number">90</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">90</span>&#125;</span><br><span class="line">姓名：小白,平均分：<span class="number">80</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">80</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">95</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">65</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">80</span>&#125;</span><br><span class="line">姓名：小黑,平均分：<span class="number">70</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">70</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">75</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">65</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">70</span>&#125;</span><br><span class="line">姓名：小红,平均分：<span class="number">60</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">60</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">60</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">61</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">59</span>&#125;</span><br><span class="line"></span><br><span class="line">对英语成绩进行排序</span><br><span class="line">姓名：小白,平均分：<span class="number">80</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">80</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">95</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">65</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">80</span>&#125;</span><br><span class="line">姓名：小明,平均分：<span class="number">90</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">90</span>&#125;</span><br><span class="line">姓名：小黑,平均分：<span class="number">70</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">70</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">75</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">65</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">70</span>&#125;</span><br><span class="line">姓名：小红,平均分：<span class="number">60</span>，成绩：&#123;<span class="string">&#x27;avg_score&#x27;</span>: <span class="number">60</span>, <span class="string">&#x27;English&#x27;</span>: <span class="number">60</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">61</span>, <span class="string">&#x27;Chniese&#x27;</span>: <span class="number">59</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="对列表中字典按多个键值排序"><a href="#对列表中字典按多个键值排序" class="headerlink" title="对列表中字典按多个键值排序"></a>对列表中字典按多个键值排序</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter</span><br><span class="line">data = [</span><br><span class="line">    &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">300</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">255</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">256</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">500</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">455</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">322</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">676</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;,</span><br><span class="line">]</span><br><span class="line">data = <span class="built_in">sorted</span>(data, key=itemgetter(<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;position&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">300</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;, </span><br><span class="line">&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">322</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;, </span><br><span class="line">&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">500</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;, </span><br><span class="line">&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">255</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;, </span><br><span class="line">&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">256</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;, </span><br><span class="line">&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">455</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;, </span><br><span class="line">&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;position&#x27;</span>: <span class="number">676</span>, <span class="string">&#x27;time&#x27;</span>: <span class="string">&#x27;1620442242&#x27;</span>&#125;]</span><br></pre></td></tr></table></figure><h2 id="71、时间格式与字符串互转、比较大小"><a href="#71、时间格式与字符串互转、比较大小" class="headerlink" title="71、时间格式与字符串互转、比较大小"></a>71、时间格式与字符串互转、比较大小</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前时间转字符串</span></span><br><span class="line">now = datetime.datetime.strftime(datetime.datetime.now(), <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"><span class="comment"># 字符串转时间格式</span></span><br><span class="line">now = datetime.datetime.strptime(now, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">a = now + datetime.timedelta(minutes=-<span class="number">15</span>)</span><br><span class="line"><span class="comment"># 时间比较大小</span></span><br><span class="line"><span class="keyword">if</span> a &lt; now:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;yes&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="72、python把’-u’开头的字符串转中文"><a href="#72、python把’-u’开头的字符串转中文" class="headerlink" title="72、python把’\u’开头的字符串转中文"></a>72、python把’\u’开头的字符串转中文</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">str_data = <span class="string">&#x27;\\u7528\\u6237 ID \\u6216\\u5bc6\\u7801\\u9519\\u8bef&#x27;</span></span><br><span class="line"><span class="comment"># 字符串.encode(&#x27;utf-8&#x27;).decode(&#x27;unicode_escape&#x27;)</span></span><br><span class="line">str_data_to_zh = str_data.encode(<span class="string">&#x27;utf-8&#x27;</span>).decode(<span class="string">&#x27;unicode_escape&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(str_data_to_zh)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">用户 ID 或密码错误</span><br></pre></td></tr></table></figure><h2 id="73、django进行数据迁移时出现No-changes-detected解决方案"><a href="#73、django进行数据迁移时出现No-changes-detected解决方案" class="headerlink" title="73、django进行数据迁移时出现No changes detected解决方案"></a>73、django进行数据迁移时出现No changes detected解决方案</h2><p>原因：可能是由于app下面没有migrations文件夹<br>所以需要创建这个文件夹，命令</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python manage.py makemigrations --empty 你的app名称</span><br></pre></td></tr></table></figure><h2 id="74、ubuntu下载文件到windows桌面"><a href="#74、ubuntu下载文件到windows桌面" class="headerlink" title="74、ubuntu下载文件到windows桌面"></a>74、ubuntu下载文件到windows桌面</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">apt install lrzsz</span><br><span class="line">sz <span class="number">123.</span>txt</span><br></pre></td></tr></table></figure><h2 id="75、git查看提交日志"><a href="#75、git查看提交日志" class="headerlink" title="75、git查看提交日志"></a>75、git查看提交日志</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">git log --author=<span class="string">&quot;ldc&quot;</span></span><br></pre></td></tr></table></figure><h2 id="76、python翻译模块"><a href="#76、python翻译模块" class="headerlink" title="76、python翻译模块"></a>76、python翻译模块</h2><p>可以把英文翻译成中文，也可以把中文翻译成英文</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install  translate</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> translate <span class="keyword">import</span> Translator</span><br><span class="line"></span><br><span class="line">name = <span class="string">&#x27;giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca&#x27;</span></span><br><span class="line">translator = Translator(to_lang=<span class="string">&quot;chinese&quot;</span>)</span><br><span class="line">translation = translator.translate(name)</span><br><span class="line"><span class="built_in">print</span>(translation)</span><br><span class="line"></span><br><span class="line">translator= Translator(from_lang=<span class="string">&quot;chinese&quot;</span>,to_lang=<span class="string">&quot;english&quot;</span>)</span><br><span class="line">translation = translator.translate(<span class="string">&quot;我想你&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(translation)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"></span><br><span class="line">大熊猫，熊猫，熊猫熊，浣熊，大熊猫</span><br><span class="line">I missed you.</span><br></pre></td></tr></table></figure><h2 id="77、python实现字符串转字典"><a href="#77、python实现字符串转字典" class="headerlink" title="77、python实现字符串转字典"></a>77、python实现字符串转字典</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">target_str = <span class="string">&#x27;&#123;&quot;h&quot;: 1, &quot;e&quot;: 2, &quot;l&quot;: 3, &quot;l&quot;: 4, &quot;o&quot;: 5&#125;&#x27;</span></span><br><span class="line">target_str2 = <span class="string">&quot;&#123;&#x27;h&#x27;: 1, &#x27;e&#x27;: 2, &#x27;l&#x27;: 3, &#x27;l&#x27;: 4, &#x27;o&#x27;: 5&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式1：使用json，缺点，字符串中不能出现单引号</span></span><br><span class="line"><span class="comment"># 由于 json 语法规定 数组或对象之中的字符串必须使用双引号，不能使用单引号</span></span><br><span class="line"><span class="comment"># 官网https://www.json.org/json-en.html上有一段描述是</span></span><br><span class="line"><span class="comment"># A string is a sequence of zero or more Unicode characters, wrapped in double quotes, using backslash escapes</span></span><br><span class="line"><span class="built_in">print</span>(json.loads(target_str))</span><br><span class="line"><span class="comment"># print(json.loads(target_str2))   # 使用json转这个字符串会报错 Expecting property name enclosed in double quotes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式2：使用eval函数，缺点，不安全</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">eval</span>(target_str))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">eval</span>(target_str2))</span><br><span class="line"><span class="comment"># print(eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;dir&#x27;)&quot;))  # 会列出当前的目录文件，如果字符串是一些删除命令，则可以把整个目录清空！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式3，使用ast.literal_eval，没有json与eval的缺点，推荐使用这个</span></span><br><span class="line"><span class="built_in">print</span>(ast.literal_eval(target_str))</span><br><span class="line"><span class="built_in">print</span>(ast.literal_eval(target_str2))</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;h&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;e&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;l&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;o&#x27;</span>: <span class="number">5</span>&#125;</span><br><span class="line">&#123;<span class="string">&#x27;h&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;e&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;l&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;o&#x27;</span>: <span class="number">5</span>&#125;</span><br><span class="line">&#123;<span class="string">&#x27;h&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;e&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;l&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;o&#x27;</span>: <span class="number">5</span>&#125;</span><br><span class="line">&#123;<span class="string">&#x27;h&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;e&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;l&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;o&#x27;</span>: <span class="number">5</span>&#125;</span><br><span class="line">&#123;<span class="string">&#x27;h&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;e&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;l&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;o&#x27;</span>: <span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="78、django-app-如何在后台显示中文名"><a href="#78、django-app-如何在后台显示中文名" class="headerlink" title="78、django app 如何在后台显示中文名"></a>78、django app 如何在后台显示中文名</h2><p>1.在app (这里以user为例)下面的__init__.py文件中</p><p>添加:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">default_app_config = <span class="string">&#x27;user.apps.UserConfig&#x27;</span></span><br></pre></td></tr></table></figure><p>2.在apps.py中</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.apps <span class="keyword">import</span> AppConfig</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserConfig</span>(<span class="title class_ inherited__">AppConfig</span>):</span><br><span class="line">    name = <span class="string">&#x27;user&#x27;</span></span><br><span class="line">    verbose_name = <span class="string">&#x27;用户&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="79、使用python给Excel指定行添加数据"><a href="#79、使用python给Excel指定行添加数据" class="headerlink" title="79、使用python给Excel指定行添加数据"></a>79、使用python给Excel指定行添加数据</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> openpyxl, sys</span><br><span class="line"></span><br><span class="line">wb = openpyxl.load_workbook(<span class="string">&#x27;b.xlsx&#x27;</span>)</span><br><span class="line">sheet = wb[<span class="string">&#x27;Sheet1&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在excel表格第二行添加新数据</span></span><br><span class="line">addrow = <span class="number">1</span>   <span class="comment"># 增加一行</span></span><br><span class="line">row = <span class="number">2</span>  <span class="comment"># 在第二行新增一行</span></span><br><span class="line">name = <span class="string">&#x27;b-back.xlsx&#x27;</span> <span class="comment"># 新的表名</span></span><br><span class="line"></span><br><span class="line">wb1 = openpyxl.Workbook()</span><br><span class="line">sheet1 = wb1[<span class="string">&#x27;Sheet&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制前row行</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, row):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, sheet.max_column + <span class="number">1</span>):</span><br><span class="line">        sheet1.cell(row=i, column=j).value = sheet.cell(row=i, column=j).value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制后row行</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(row, sheet.max_row + <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, sheet.max_column + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> i == row:</span><br><span class="line">            <span class="comment"># 给第row行添加新的数据</span></span><br><span class="line">            sheet1.cell(row=row, column=j).value = <span class="string">&#x27;新增&#x27;</span></span><br><span class="line">        sheet1.cell(row=i + addrow, column=j).value = sheet.cell(row=i, column=j).value</span><br><span class="line"></span><br><span class="line">wb1.save(name)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200526120005871.png" alt="在这里插入图片描述"></p><h2 id="80、python中的format格式拼接字符串"><a href="#80、python中的format格式拼接字符串" class="headerlink" title="80、python中的format格式拼接字符串"></a>80、python中的format格式拼接字符串</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span>: <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#123;a&#125;,&#123;b&#125;&#x27;</span>.<span class="built_in">format</span>(**d))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#123;0&#125;,&#123;1&#125;,&#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;d[<span class="string">&#x27;a&#x27;</span>]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>,<span class="number">2</span></span><br><span class="line">a,b,a</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="81、数据库inner-join、full-join、left-join、union、union-all区别"><a href="#81、数据库inner-join、full-join、left-join、union、union-all区别" class="headerlink" title="81、数据库inner join、full join、left join、union、union all区别"></a>81、数据库inner join、full join、left join、union、union all区别</h2><p>表a_test</p><p><img src="https://img-blog.csdnimg.cn/20200529102527295.png#pic_center" alt="在这里插入图片描述"></p><p>表b_test</p><p><img src="https://img-blog.csdnimg.cn/20200529102549669.png#pic_center" alt="在这里插入图片描述"></p><p>INNER JOIN</p><p>是A和B的交集</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SELECT * FROM a_test INNER JOIN b_test ON a_test.name = b_test.namesa</span><br><span class="line"></span><br><span class="line">Inner join 产生的结果集中，是A和B的交集。</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529102631494.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>FULL OUTER JOIN</p><p>产生A和B的并集</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SELECT * FROM a_test FULL OUTER JOIN b_test ON a_test.name = b_test.name </span><br><span class="line"></span><br><span class="line">Full outer join 产生A和B的并集。</span><br><span class="line">但是需要注意的是，对于没有匹配的记录，则会以null做为值。</span><br><span class="line">可以使用IF NULL判断。</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529102702865.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SELECT * FROM a_test FULL OUTER JOIN b_test ON a_test.name = b_test.name</span><br><span class="line">WHERE a_test.<span class="built_in">id</span> IS null OR b_test.<span class="built_in">id</span> IS null</span><br><span class="line"></span><br><span class="line">产生A表和B表没有交集的数据集。</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529102724731.png#pic_center" alt="在这里插入图片描述"></p><p>LEFT [OUTER] JOIN</p><p>产生表A的完全集，而B表中匹配的则有值，没有匹配的则以null值取代</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SELECT * FROM a_test LEFT OUTER JOIN b_test ON a_test.name = b_test.name</span><br><span class="line">有些数据库可以不要OUTER</span><br><span class="line">SELECT * FROM a_test LEFT  JOIN b_test ON a_test.name = b_test.name</span><br><span class="line">Left outer join 产生表A的完全集，而B表中匹配的则有值，没有匹配的则以null值取代。</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529102808618.png#pic_center" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SELECT * FROM a_test LEFT OUTER JOIN b_test ON a_test.name = b_test.name </span><br><span class="line">WHERE b_test.<span class="built_in">id</span> IS null</span><br><span class="line"></span><br><span class="line">产生在A表中有而在B表中没有的集合。</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529102828846.png#pic_center" alt="在这里插入图片描述"></p><p>RIGHT [OUTER] JOIN</p><p>RIGHT OUTER JOIN 是后面的表为基础，与LEFT OUTER JOIN用法类似。</p><p>UNION 与 UNION ALL</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">UNION 操作符用于合并两个或多个 SELECT 语句的结果集。</span><br><span class="line">请注意，UNION 内部的 SELECT 语句必须拥有相同数量的列。</span><br><span class="line">列也必须拥有相似的数据类型。</span><br><span class="line">同时，每条 SELECT 语句中的列的顺序必须相同。</span><br><span class="line">UNION 只选取记录，而UNION ALL会列出所有记录。</span><br><span class="line"></span><br><span class="line">SELECT name FROM a_test UNION SELECT name FROM b_test</span><br><span class="line"></span><br><span class="line">选取不同值</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529102855430.png#pic_center" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SELECT a_test.<span class="built_in">id</span>,a_test.name  FROM a_test </span><br><span class="line">UNION </span><br><span class="line">SELECT b_test.<span class="built_in">id</span>,b_test.name FROM b_test</span><br><span class="line"></span><br><span class="line">由于 <span class="built_in">id</span> <span class="number">51</span> xh   与 <span class="built_in">id</span> <span class="number">4</span> xh 并不相同，不合并</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529102917488.png#pic_center" alt="在这里插入图片描述"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SELECT name FROM a_test UNION ALL SELECT name FROM b_test</span><br><span class="line"></span><br><span class="line">全部列出来</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200529102937801.png#pic_center" alt="在这里插入图片描述"></p><p>还需要注意的是我们还有一个是“交差集” cross join, 这种Join没有办法用文式图表示，因为其就是把表A和表B的数据进行一个N*M的组合，即笛卡尔积。</p><p>表达式如下：SELECT * FROM a_test CROSS JOIN b_test</p><p>这个笛卡尔乘积会产生 4 x 4 &#x3D; 16 条记录，一般来说，我们很少用到这个语法。但是我们得小心，如果不是使用嵌套的select语句，一般系统都会产生笛卡尔乘积然再做过滤。这是对于性能来说是非常危险的，尤其是表很大的时候。</p><h2 id="82、windows电脑查看端口使用情况"><a href="#82、windows电脑查看端口使用情况" class="headerlink" title="82、windows电脑查看端口使用情况"></a>82、windows电脑查看端口使用情况</h2><p>找出8000端口对应的PID进程，命令为：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">netstat -ano|findstr <span class="number">8000</span></span><br></pre></td></tr></table></figure><p>进程信息如下：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TCP    <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8000</span>           <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">0</span>              LISTENING       <span class="number">1620</span></span><br><span class="line">UDP    <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8000</span>           *:*                                    <span class="number">1620</span></span><br></pre></td></tr></table></figure><p>找出进程对应的详细信息：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tasklist |findstr <span class="number">1620</span></span><br><span class="line"></span><br><span class="line">KGService.exe                 <span class="number">1620</span> Console                    <span class="number">1</span>     <span class="number">18</span>,<span class="number">696</span> K</span><br></pre></td></tr></table></figure><p>关进程：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">taskkill /pid <span class="number">1620</span> /F</span><br></pre></td></tr></table></figure><p>查看程序占用内存<br>比如查看python占用运行内存</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tasklist  /fi <span class="string">&quot;imagename eq python.exe&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/a61afd069e964e6f9d755c5c1884ca6f.png" alt="在这里插入图片描述"></p><h2 id="83、Django生成表和反向生成Model"><a href="#83、Django生成表和反向生成Model" class="headerlink" title="83、Django生成表和反向生成Model"></a>83、Django生成表和反向生成Model</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">正向生成：</span><br><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br><span class="line"></span><br><span class="line">反向：</span><br><span class="line">会根据设置的数据库中的表在自动生成对应的Model代码，并打印出来</span><br><span class="line">python manage.py inspectdb</span><br><span class="line"></span><br><span class="line">以直接将打印的代码直接导入到指定的Model文件中</span><br><span class="line">python manage.py inspectdb &gt; models.py</span><br></pre></td></tr></table></figure><h2 id="84、windows的hosts文件位置"><a href="#84、windows的hosts文件位置" class="headerlink" title="84、windows的hosts文件位置"></a>84、windows的hosts文件位置</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">C:\Windows\System32\drivers\etc\hosts</span><br></pre></td></tr></table></figure><h2 id="85、postgresql数据库"><a href="#85、postgresql数据库" class="headerlink" title="85、postgresql数据库"></a>85、postgresql数据库</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 如果表存在就先删除</span></span><br><span class="line">drop table <span class="keyword">if</span> exists student;</span><br><span class="line"><span class="comment"># 创建学生表</span></span><br><span class="line"><span class="comment"># id      serial not null  表示id自增</span></span><br><span class="line"><span class="comment"># id      integer not null  表示id不自增</span></span><br><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">    <span class="built_in">id</span>                    serial <span class="keyword">not</span> null</span><br><span class="line">        constraint student_pk</span><br><span class="line">            primary key,</span><br><span class="line">    name                  varchar,</span><br><span class="line">    class_id              integer,</span><br><span class="line">    height                numeric,</span><br><span class="line">    weight                numeric,</span><br><span class="line">    write_date            timestamp</span><br><span class="line">    </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">comment on table student <span class="keyword">is</span> <span class="string">&#x27;学生表&#x27;</span>;</span><br><span class="line"></span><br><span class="line">comment on column student.name <span class="keyword">is</span> <span class="string">&#x27;名称&#x27;</span>;</span><br><span class="line"></span><br><span class="line">comment on column student.class_id <span class="keyword">is</span> <span class="string">&#x27;班级ID&#x27;</span>;</span><br><span class="line"></span><br><span class="line">comment on column student.height <span class="keyword">is</span> <span class="string">&#x27;身高&#x27;</span>;</span><br><span class="line"></span><br><span class="line">comment on column student.weight <span class="keyword">is</span> <span class="string">&#x27;体重&#x27;</span>;</span><br><span class="line"></span><br><span class="line">comment on column student.write_date <span class="keyword">is</span> <span class="string">&#x27;修改时间&#x27;</span>;</span><br><span class="line"></span><br><span class="line">alter table student</span><br><span class="line">    owner to odoo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line">update user <span class="built_in">set</span> name=<span class="string">&#x27;张三&#x27;</span> where <span class="built_in">id</span>=<span class="number">111</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新表a的字段为表b的值</span></span><br><span class="line">update account_invoice </span><br><span class="line"><span class="built_in">set</span> sale_order_id=so.<span class="built_in">id</span> </span><br><span class="line"><span class="keyword">from</span> sale_order so </span><br><span class="line">where account_invoice.origin=so.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增</span></span><br><span class="line">insert into <span class="string">&quot;user&quot;</span> (name,sex) values (<span class="string">&#x27;小明&#x27;</span>,<span class="number">1</span>),(<span class="string">&#x27;小红&#x27;</span>, <span class="number">0</span>)</span><br><span class="line"><span class="comment"># 新增或更新</span></span><br><span class="line">如果<span class="built_in">id</span>冲突就更新</span><br><span class="line">INSERT INTO  student(<span class="built_in">id</span>, name)</span><br><span class="line">   VALUES(<span class="number">12</span>, <span class="string">&#x27;小明&#x27;</span>),(<span class="number">13</span>, <span class="string">&#x27;小红&#x27;</span>)</span><br><span class="line">   ON conflict(<span class="built_in">id</span>) DO UPDATE</span><br><span class="line">   SET name =<span class="string">&#x27;未知&#x27;</span>;</span><br><span class="line">如果<span class="built_in">id</span>冲突就什么也不做</span><br><span class="line">INSERT INTO  student(<span class="built_in">id</span>, name)</span><br><span class="line">   VALUES(<span class="number">12</span>, <span class="string">&#x27;小明&#x27;</span>),(<span class="number">13</span>, <span class="string">&#x27;小红&#x27;</span>)</span><br><span class="line">   ON conflict(<span class="built_in">id</span>) DO NOTHING;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把一个表中的数据插入到另一个表中</span></span><br><span class="line">insert into 目标表名 (column1,column2,columnn) select value1,value2,valuen <span class="keyword">from</span>  源表名</span><br><span class="line">比如：</span><br><span class="line">insert into student (name, classs_name,create_date) select  student_name <span class="keyword">as</span> name, class_name, now() <span class="keyword">from</span> class_table;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前时间</span></span><br><span class="line">now()</span><br><span class="line">select now()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">DELETE FROM table_name [WHERE Clause]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加字段</span></span><br><span class="line">alter table 表名 add column 列名 类型;</span><br><span class="line"><span class="comment"># 删除字段</span></span><br><span class="line">alter table 表名 dropcolumn 列名 ;</span><br><span class="line"></span><br><span class="line"><span class="comment"># postgresql数据库查看表所有字段</span></span><br><span class="line">select * <span class="keyword">from</span> information_schema.columns where table_schema=<span class="string">&#x27;public&#x27;</span> <span class="keyword">and</span> table_name=<span class="string">&#x27;表名&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># postgresql获取所有表名</span></span><br><span class="line">select tablename <span class="keyword">from</span> pg_tables where schemaname=<span class="string">&#x27;public&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对查询结果按id降序显示</span></span><br><span class="line">select * <span class="keyword">from</span> table_name order by <span class="built_in">id</span> desc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对查询结果按id升序显示</span></span><br><span class="line">select * <span class="keyword">from</span> table_name order by <span class="built_in">id</span> asc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转义字符, 查找name中包含单引号的记录</span></span><br><span class="line">select * <span class="keyword">from</span> student where name like  E<span class="string">&#x27;%\&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看表记录总数</span></span><br><span class="line">select relname <span class="keyword">as</span> TABLE_NAME, reltuples <span class="keyword">as</span> rowCounts <span class="keyword">from</span> pg_class where relkind = <span class="string">&#x27;r&#x27;</span> <span class="keyword">and</span> relnamespace = (select oid <span class="keyword">from</span> pg_namespace where nspname=<span class="string">&#x27;public&#x27;</span>) order by rowCounts desc;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将结果转换为数组</span></span><br><span class="line">SELECT array(SELECT <span class="string">&quot;name&quot;</span> FROM sale_order);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将数组合并为字符串</span></span><br><span class="line">select array_to_string(array[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 联合子集更新，把sale_order_line的name连接换行符，然后按id更新到表a_test中对应的name</span></span><br><span class="line">update a_test <span class="built_in">set</span> name=array_to_string(array(select name <span class="keyword">from</span> sale_order_line where order_id=a_test.<span class="built_in">id</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># PostgreSQL合并查询同一列的多条记录，针对一对多，多对多字段</span></span><br><span class="line">比如表：</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span>   name                  </span><br><span class="line"><span class="number">1</span>    小明                   </span><br><span class="line"><span class="number">1</span>    小红                     <span class="built_in">id</span>   name</span><br><span class="line"><span class="number">1</span>    小亮        --&gt;          <span class="number">1</span>    小明，小亮，小红</span><br><span class="line"><span class="number">2</span>    小强                     <span class="number">2</span>    小强，小王</span><br><span class="line"><span class="number">2</span>    小王</span><br><span class="line"></span><br><span class="line">SELECT </span><br><span class="line">    <span class="built_in">id</span>, array_to_string(ARRAY(SELECT unnest(array_agg(name order by name desc))),<span class="string">&#x27;,&#x27;</span>) AS all_name</span><br><span class="line">FROM  </span><br><span class="line">    student</span><br><span class="line">GROUP BY <span class="built_in">id</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># case语句</span></span><br><span class="line"><span class="keyword">case</span> var</span><br><span class="line">when condition1 then statement1</span><br><span class="line">when condition2 then statement2</span><br><span class="line"><span class="keyword">else</span> statementn</span><br><span class="line">end <span class="keyword">as</span> new_name</span><br><span class="line"></span><br><span class="line">比如：</span><br><span class="line">select <span class="keyword">case</span> name</span><br><span class="line">when <span class="string">&#x27;小明&#x27;</span> then <span class="string">&#x27;xm&#x27;</span></span><br><span class="line">when <span class="string">&#x27;小红&#x27;</span> then <span class="string">&#x27;xh&#x27;</span></span><br><span class="line">when <span class="string">&#x27;小刚&#x27;</span> then <span class="string">&#x27;xg&#x27;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&#x27;xw&#x27;</span></span><br><span class="line">end <span class="keyword">as</span> short_name</span><br><span class="line"><span class="keyword">from</span> student</span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时表、字符串合并、类型转换、时间格式转换、当前时间</span></span><br><span class="line">WITH TEMP AS ( </span><br><span class="line">SELECT CAST ( concat ( bam.account_period_code, <span class="string">&#x27;-01&#x27;</span> ) AS TIMESTAMP ) </span><br><span class="line">   AS account_period_time </span><br><span class="line"> FROM bi_account_move AS bam ) </span><br><span class="line">SELECT</span><br><span class="line">account_period_time,</span><br><span class="line">to_char(CURRENT_DATE,<span class="string">&#x27;yyyy-MM-dd hh24:MI:ss&#x27;</span>) <span class="keyword">as</span> current_date,</span><br><span class="line">to_char( account_period_time, <span class="string">&#x27;yyyy&#x27;</span> ) <span class="keyword">as</span> year,</span><br><span class="line">to_char( account_period_time, <span class="string">&#x27;MM&#x27;</span> ) <span class="keyword">as</span> month,</span><br><span class="line">to_char( account_period_time, <span class="string">&#x27;dd&#x27;</span> ) <span class="keyword">as</span> day </span><br><span class="line">FROM TEMP</span><br><span class="line"></span><br><span class="line">比如：</span><br><span class="line">account_period_timecurrent_date    yearmonthday</span><br><span class="line"><span class="number">2019</span>-06-01 <span class="number">0</span>:<span class="number">00</span>:<span class="number">00</span><span class="number">2020</span>-06-<span class="number">24</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span><span class="number">2019</span> 06     01</span><br><span class="line"><span class="number">2019</span>-06-01 <span class="number">0</span>:<span class="number">00</span>:<span class="number">00</span><span class="number">2020</span>-06-<span class="number">24</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span><span class="number">2019</span> 06     01</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多个字符串拼接</span></span><br><span class="line">select </span><br><span class="line">concat(<span class="string">&#x27;payment_&#x27;</span>, CAST(ap.<span class="built_in">id</span> <span class="keyword">as</span> varchar)) <span class="keyword">as</span> line_key</span><br><span class="line"><span class="keyword">from</span> ap</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将查询所得结果集的某一字段拼接成字符串，默认的是逗号</span></span><br><span class="line">select GROUP_CONCAT(<span class="built_in">id</span>) <span class="keyword">from</span> test where <span class="built_in">id</span>&gt;<span class="number">5</span>;</span><br><span class="line">结果为：</span><br><span class="line"><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span></span><br><span class="line"><span class="comment"># 使用其他分隔符拼接</span></span><br><span class="line">select GROUP_CONCAT(<span class="built_in">id</span> separator <span class="string">&#x27;-&#x27;</span>) <span class="keyword">from</span> test where <span class="built_in">id</span>&gt;<span class="number">5</span>;</span><br><span class="line">结果为：</span><br><span class="line"><span class="number">1</span>-<span class="number">2</span>-<span class="number">3</span>-<span class="number">4</span>-<span class="number">5</span>-<span class="number">6</span>-<span class="number">7</span></span><br><span class="line"><span class="comment"># 多个临时表</span></span><br><span class="line">WITH temp_student AS ( SELECT ID, NAME, sex FROM student WHERE sex = TRUE ),</span><br><span class="line">temp_class AS (</span><br><span class="line">SELECT</span><br><span class="line">ID,</span><br><span class="line">NAME,</span><br><span class="line">student_id,</span><br><span class="line">teacher_id</span><br><span class="line">FROM</span><br><span class="line">the_class </span><br><span class="line">),</span><br><span class="line">temp_teacher AS (</span><br><span class="line">SELECT </span><br><span class="line">  ID,</span><br><span class="line">NAME,</span><br><span class="line">age </span><br><span class="line">FROM</span><br><span class="line">teacher </span><br><span class="line">) </span><br><span class="line">SELECT</span><br><span class="line">ts.NAME AS student_name,</span><br><span class="line">tc.NAME AS class_name,</span><br><span class="line">te.NAME AS teacher_name</span><br><span class="line"><span class="keyword">from</span> temp_student <span class="keyword">as</span> ts</span><br><span class="line">LEFT JOIN temp_class AS tc ON tc.student_id = ts.ID  </span><br><span class="line">LEFT JOIN teacher AS te ON te.<span class="built_in">id</span> = tc.teacher_id  </span><br><span class="line"></span><br><span class="line"><span class="comment"># null转成有意义的值</span></span><br><span class="line">select COALESCE(name, <span class="string">&#x27;&#x27;</span>) <span class="keyword">as</span> name <span class="keyword">from</span> a_test</span><br><span class="line">意思就是如果name为null，就转为空字符串</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串截取</span></span><br><span class="line">select SUBSTRING(<span class="string">&#x27;abcd&#x27;</span>,<span class="number">1</span>,<span class="number">2</span>); -- result:ab 表示从下标从<span class="number">1</span>开始,截取<span class="number">2</span>个字符</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 interval 时间相加减(+/-)</span></span><br><span class="line">当前时间 + <span class="number">10</span>秒，</span><br><span class="line">select to_char(now() + interval <span class="string">&#x27;10 second&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>)  <span class="keyword">as</span> reqDate <span class="keyword">from</span> account_period;</span><br><span class="line">当前时间 - <span class="number">10</span>秒</span><br><span class="line">select to_char(now() + interval <span class="string">&#x27;-10 second&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>)  <span class="keyword">as</span> reqDate <span class="keyword">from</span> account_period;</span><br><span class="line"> </span><br><span class="line">当前时间 + <span class="number">10</span>分，</span><br><span class="line">select to_char(now() + interval <span class="string">&#x27;10 minute&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>)  <span class="keyword">as</span> reqDate  <span class="keyword">from</span> account_period;</span><br><span class="line"> </span><br><span class="line">当前时间 + <span class="number">10</span>时，</span><br><span class="line">select to_char(now() + interval <span class="string">&#x27;10 hour&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>)  <span class="keyword">as</span> reqDate <span class="keyword">from</span> account_period;</span><br><span class="line"> </span><br><span class="line">当前时间 + <span class="number">10</span>天，</span><br><span class="line">select to_char(now() + interval <span class="string">&#x27;10 day&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>)  <span class="keyword">as</span> reqDate <span class="keyword">from</span> account_period;</span><br><span class="line"></span><br><span class="line">当前时间 + <span class="number">10</span>年，</span><br><span class="line">select to_char(now() + interval <span class="string">&#x27;10 year&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>)  <span class="keyword">as</span> reqDate <span class="keyword">from</span> account_period;</span><br><span class="line"></span><br><span class="line"><span class="comment"># UNION types numeric and text cannot be matched</span></span><br><span class="line">NULL::NUMERIC</span><br><span class="line"> 这个问题，是因为几个sql组合在一起时，同一个字段的值，遇到null时，需要进行类型转换。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对行记录定义行编号，使用函数ROW_NUMBER()</span></span><br><span class="line"><span class="comment"># 按分数进行降序，然后给行记录标记行编号，可以作为排名来使用</span></span><br><span class="line">select           </span><br><span class="line">ROW_NUMBER() OVER (ORDER BY score desc) AS sequence_number,</span><br><span class="line">name,score</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">b_test</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数字转字符串  </span></span><br><span class="line">select cast(<span class="number">123</span> <span class="keyword">as</span> VARCHAR); </span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串转数字  </span></span><br><span class="line">select cast(<span class="string">&#x27;123&#x27;</span> <span class="keyword">as</span> INTEGER);</span><br></pre></td></tr></table></figure><h2 id="86、python控制台输出带颜色的文字方法"><a href="#86、python控制台输出带颜色的文字方法" class="headerlink" title="86、python控制台输出带颜色的文字方法"></a>86、python控制台输出带颜色的文字方法</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#格式：　　设置颜色开始 ：\033[显示方式;前景色;背景色m</span></span><br><span class="line"><span class="comment">#说明：</span></span><br><span class="line">前景色            背景色           颜色</span><br><span class="line">---------------------------------------</span><br><span class="line"><span class="number">30</span>                <span class="number">40</span>              黑色</span><br><span class="line"><span class="number">31</span>                <span class="number">41</span>              红色</span><br><span class="line"><span class="number">32</span>                <span class="number">42</span>              绿色</span><br><span class="line"><span class="number">33</span>                <span class="number">43</span>              黃色</span><br><span class="line"><span class="number">34</span>                <span class="number">44</span>              蓝色</span><br><span class="line"><span class="number">35</span>                <span class="number">45</span>              紫红色</span><br><span class="line"><span class="number">36</span>                <span class="number">46</span>              青蓝色</span><br><span class="line"><span class="number">37</span>                <span class="number">47</span>              白色</span><br><span class="line">显示方式           意义</span><br><span class="line">-------------------------</span><br><span class="line"><span class="number">0</span>                终端默认设置</span><br><span class="line"><span class="number">1</span>                高亮显示</span><br><span class="line"><span class="number">4</span>                使用下划线</span><br><span class="line"><span class="number">5</span>                闪烁</span><br><span class="line"><span class="number">7</span>                反白显示</span><br><span class="line"><span class="number">8</span>                不可见</span><br><span class="line"> </span><br><span class="line"><span class="comment">#例子：</span></span><br><span class="line">\033[<span class="number">1</span>;<span class="number">31</span>;40m    &lt;!--<span class="number">1</span>-高亮显示 <span class="number">31</span>-前景色红色  <span class="number">40</span>-背景色黑色--&gt;</span><br><span class="line">\033[0m          &lt;!--采用终端默认设置，即取消颜色设置--&gt;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">例子</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;紫红字体 \033[1;35m hello world \033[0m!&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;褐色背景绿色字体 \033[1;32;43m hello world \033[0m!&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\033[1;33;44mhello world\033[0m&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200615143709116.png" alt="在这里插入图片描述"></p><h2 id="87、控制台输出白色方框"><a href="#87、控制台输出白色方框" class="headerlink" title="87、控制台输出白色方框"></a>87、控制台输出白色方框</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;█&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="88、xadmin后台编辑多对多字段"><a href="#88、xadmin后台编辑多对多字段" class="headerlink" title="88、xadmin后台编辑多对多字段"></a>88、xadmin后台编辑多对多字段</h2><p>在models.py定义了多对多字段，想要在编辑时可以灵活使用这个字段的话，可以按以下方法设置：<br>modes.py</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    title = models.CharField(verbose_name=<span class="string">&quot;书名&quot;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    second_title = models.CharField(verbose_name=<span class="string">&quot;副标题&quot;</span>, max_length=<span class="number">32</span>, blank=<span class="literal">True</span>, null=<span class="literal">True</span>)</span><br><span class="line">    author = models.CharField(verbose_name=<span class="string">&quot;作者&quot;</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    translator = models.CharField(verbose_name=<span class="string">&quot;译者&quot;</span>, max_length=<span class="number">32</span>, blank=<span class="literal">True</span>, null=<span class="literal">True</span>)</span><br><span class="line">    intro = models.TextField(verbose_name=<span class="string">&quot;描述&quot;</span>)</span><br><span class="line">    pic = models.FileField(verbose_name=<span class="string">&quot;封面图片&quot;</span>, max_length=<span class="number">64</span>, upload_to=<span class="string">&#x27;book_cover&#x27;</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    tags = models.ManyToManyField(Tags, verbose_name=<span class="string">&#x27;书籍标签&#x27;</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    prizes = models.ManyToManyField(Prizes, verbose_name=<span class="string">&#x27;获奖详情&#x27;</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    sump = models.IntegerField(verbose_name=<span class="string">&quot;收藏人数&quot;</span>, default=<span class="number">0</span>)</span><br><span class="line">    rate_num = models.IntegerField(verbose_name=<span class="string">&quot;评分人数&quot;</span>, default=<span class="number">0</span>)</span><br><span class="line">    num = models.IntegerField(verbose_name=<span class="string">&quot;浏览量&quot;</span>, default=<span class="number">0</span>)</span><br><span class="line">    published_time = models.DateField(blank=<span class="literal">True</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;出版时间&#x27;</span>)</span><br><span class="line">    create_time = models.DateTimeField(auto_now_add=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;创建时间&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;book&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&quot;图书&quot;</span></span><br><span class="line">        verbose_name_plural = <span class="string">&quot;图书&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.title</span><br></pre></td></tr></table></figure><p>adminx.py</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 书籍管理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookAdmin</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    search_fields = [<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;author&#x27;</span>, <span class="string">&#x27;intro&#x27;</span>]  <span class="comment"># 检索字段</span></span><br><span class="line">    list_display = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;show_pic&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;second_title&#x27;</span>, <span class="string">&#x27;author&#x27;</span>, <span class="string">&#x27;translator&#x27;</span>, <span class="string">&#x27;published_time&#x27;</span>, <span class="string">&#x27;intro&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;tags&#x27;</span>, <span class="string">&#x27;prizes&#x27;</span>, <span class="string">&#x27;num&#x27;</span>, <span class="string">&#x27;sump&#x27;</span>, <span class="string">&#x27;rate_num&#x27;</span>]  <span class="comment"># 要显示的字段</span></span><br><span class="line">    list_filter = [<span class="string">&#x27;published_time&#x27;</span>, <span class="string">&#x27;tags&#x27;</span>, <span class="string">&#x27;prizes&#x27;</span>]  <span class="comment"># 分组过滤的字段</span></span><br><span class="line">    ordering = (<span class="string">&#x27;id&#x27;</span>,)  <span class="comment"># 设置默认排序字段，负号表示降序排序</span></span><br><span class="line">    list_per_page = <span class="number">30</span>  <span class="comment"># 默认每页显示多少条记录，默认是100条</span></span><br><span class="line">    model_icon = <span class="string">&#x27;fa fa-book&#x27;</span>  <span class="comment"># 左侧小图标</span></span><br><span class="line">    list_editable = [<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;author&#x27;</span>, <span class="string">&#x27;intro&#x27;</span>, <span class="string">&#x27;published_time&#x27;</span>]  <span class="comment"># 可编辑字段</span></span><br><span class="line">    style_fields = &#123;<span class="string">&#x27;tags&#x27;</span>: <span class="string">&#x27;m2m_transfer&#x27;</span>, <span class="string">&#x27;prizes&#x27;</span>: <span class="string">&#x27;m2m_transfer&#x27;</span>&#125;  <span class="comment"># 控制字段的显示样式</span></span><br><span class="line">    filter_horizontal = (<span class="string">&#x27;tags&#x27;</span>, <span class="string">&#x27;prizes&#x27;</span>)  <span class="comment"># 水平选择编辑多对多字段</span></span><br></pre></td></tr></table></figure><p>重点是设置style_fields 和filter_horizontal ，效果：</p><p><img src="https://img-blog.csdnimg.cn/20200621214122315.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="89、Django后台通过按钮显示TextField字段内容"><a href="#89、Django后台通过按钮显示TextField字段内容" class="headerlink" title="89、Django后台通过按钮显示TextField字段内容"></a>89、Django后台通过按钮显示TextField字段内容</h2><p>由于TextField字段类型内容可能很长，在后台显示时很占屏幕位置，可以通过按钮来控制显示，代码如下：<br>models.py中定义了一个TextField字段类型：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Prizes</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>, verbose_name=<span class="string">&quot;奖项&quot;</span>)</span><br><span class="line">    intro = models.TextField(blank=<span class="literal">True</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;简介&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;prizes&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&quot;奖项&quot;</span></span><br><span class="line">        verbose_name_plural = <span class="string">&quot;奖项&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure><p>这里使用xadmin作为后台管理框架，在adminx.py中代码如下：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xadmin</span><br><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line"><span class="keyword">from</span> xadmin <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 奖项管理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrizesAdmin</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    search_fields = [<span class="string">&#x27;name&#x27;</span>]  <span class="comment"># 检索字段</span></span><br><span class="line">    list_display = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;show_intro&#x27;</span>]</span><br><span class="line">    list_filter = [<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">    ordering = (<span class="string">&#x27;id&#x27;</span>,)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_intro</span>(<span class="params">self, obj</span>):</span><br><span class="line">        <span class="comment"># 显示简介</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> obj.intro:</span><br><span class="line">            <span class="keyword">return</span> mark_safe(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(obj.intro) &lt; <span class="number">20</span>:</span><br><span class="line">            <span class="keyword">return</span> mark_safe(obj.intro)</span><br><span class="line"></span><br><span class="line">        short_id = <span class="string">f&#x27;<span class="subst">&#123;obj._meta.db_table&#125;</span>_short_text_<span class="subst">&#123;obj.<span class="built_in">id</span>&#125;</span>&#x27;</span></span><br><span class="line">        short_text_len = <span class="built_in">len</span>(obj.intro) // <span class="number">4</span></span><br><span class="line">        short_text = obj.intro[:short_text_len] + <span class="string">&#x27;......&#x27;</span></span><br><span class="line">        detail_id = <span class="string">f&#x27;<span class="subst">&#123;obj._meta.db_table&#125;</span>_detail_text_<span class="subst">&#123;obj.<span class="built_in">id</span>&#125;</span>&#x27;</span></span><br><span class="line">        detail_text = obj.intro</span><br><span class="line"></span><br><span class="line">        text = <span class="string">&quot;&quot;&quot;&lt;style type=&quot;text/css&quot;&gt;</span></span><br><span class="line"><span class="string">                        #%s,%s &#123;padding:10px;border:1px solid green;&#125; </span></span><br><span class="line"><span class="string">                  &lt;/style&gt;</span></span><br><span class="line"><span class="string">                    &lt;script type=&quot;text/javascript&quot;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    function openShutManager(oSourceObj,oTargetObj,shutAble,oOpenTip,oShutTip,oShortObj)&#123;</span></span><br><span class="line"><span class="string">                        var sourceObj = typeof oSourceObj == &quot;string&quot; ? document.getElementById(oSourceObj) : oSourceObj;</span></span><br><span class="line"><span class="string">                        var targetObj = typeof oTargetObj == &quot;string&quot; ? document.getElementById(oTargetObj) : oTargetObj;</span></span><br><span class="line"><span class="string">                        var shortObj = typeof oShortObj == &quot;string&quot; ? document.getElementById(oShortObj) : oShortObj;</span></span><br><span class="line"><span class="string">                        var openTip = oOpenTip || &quot;&quot;;</span></span><br><span class="line"><span class="string">                        var shutTip = oShutTip || &quot;&quot;;</span></span><br><span class="line"><span class="string">                        if(targetObj.style.display!=&quot;none&quot;)&#123;</span></span><br><span class="line"><span class="string">                           if(shutAble) return;</span></span><br><span class="line"><span class="string">                           targetObj.style.display=&quot;none&quot;;</span></span><br><span class="line"><span class="string">                           shortObj.style.display=&quot;block&quot;;</span></span><br><span class="line"><span class="string">                           if(openTip  &amp;&amp;  shutTip)&#123;</span></span><br><span class="line"><span class="string">                            sourceObj.innerHTML = shutTip; </span></span><br><span class="line"><span class="string">                           &#125;</span></span><br><span class="line"><span class="string">                        &#125; else &#123;</span></span><br><span class="line"><span class="string">                           targetObj.style.display=&quot;block&quot;;</span></span><br><span class="line"><span class="string">                           shortObj.style.display=&quot;none&quot;;</span></span><br><span class="line"><span class="string">                           if(openTip  &amp;&amp;  shutTip)&#123;</span></span><br><span class="line"><span class="string">                            sourceObj.innerHTML = openTip; </span></span><br><span class="line"><span class="string">                           &#125;</span></span><br><span class="line"><span class="string">                        &#125;</span></span><br><span class="line"><span class="string">                        &#125;</span></span><br><span class="line"><span class="string">                    &lt;/script&gt;</span></span><br><span class="line"><span class="string">                    &lt;p id=&quot;%s&quot;&gt;%s&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;p&gt;&lt;a href=&quot;###&quot; οnclick=&quot;openShutManager(this,&#x27;%s&#x27;,false,&#x27;点击关闭&#x27;,&#x27;点击展开&#x27;,&#x27;%s&#x27;)&quot;&gt;点击展开&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    &lt;p id=&quot;%s&quot; style=&quot;display:none&quot;&gt;</span></span><br><span class="line"><span class="string">                       %s</span></span><br><span class="line"><span class="string">                    &lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &quot;&quot;&quot;</span> % (short_id, detail_id, short_id, short_text, detail_id, short_id, detail_id, detail_text)</span><br><span class="line">        <span class="keyword">return</span> mark_safe(text)</span><br><span class="line"></span><br><span class="line">    show_intro.short_description = <span class="string">&#x27;描述&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>注意</strong>：复制代码后需要做如下修改：</p><p><img src="https://img-blog.csdnimg.cn/20200815204246956.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>一开始效果</p><p><img src="https://img-blog.csdnimg.cn/20200621230038819.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>点击展开效果：<img src="https://img-blog.csdnimg.cn/20200621230120177.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id="90、前端判断上传的文件是否为图片且限制大小为300kB"><a href="#90、前端判断上传的文件是否为图片且限制大小为300kB" class="headerlink" title="90、前端判断上传的文件是否为图片且限制大小为300kB"></a>90、前端判断上传的文件是否为图片且限制大小为300kB</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en-us&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;body <span class="keyword">class</span>=<span class="string">&quot;login&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="built_in">input</span> <span class="keyword">class</span>=<span class="string">&quot;form-control input-lg&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;id_icon&quot;</span> name=<span class="string">&quot;icon&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;file&quot;</span> onchange=<span class="string">&quot;imgTypeSize(&#x27;id_icon&#x27;,300)&quot;</span></span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    //判断是否为图片，若为图片，判断其大小是否大于<span class="number">0.3</span>M</span><br><span class="line">    function imgTypeSize(FileId, maxsize) &#123;</span><br><span class="line">        /*获取图片内容对象*/</span><br><span class="line">        var imgFile = document.getElementById(FileId).files[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (imgFile.name == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            alert(<span class="string">&quot;请上传头像哦&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> false;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            /*图片类型正则验证*/</span><br><span class="line">            var imgStr = /\.(jpg|jpeg|png|bmp|BMP|JPG|PNG|JPEG)$/;</span><br><span class="line">            <span class="keyword">if</span> (!imgStr.test(imgFile.name)) &#123;</span><br><span class="line">                alert(<span class="string">&quot;文件不是图片类型&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> false;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                /*图片大小*/</span><br><span class="line">                var imagSize = imgFile.size;</span><br><span class="line">                <span class="keyword">if</span> (imagSize &lt; (<span class="number">1024</span> * maxsize)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> true;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    alert(imgFile.name + <span class="string">&quot;大小不能超过&quot;</span> + maxsize + <span class="string">&quot;kB&quot;</span>);</span><br><span class="line">                    document.getElementById(FileId).value = <span class="string">&quot;&quot;</span></span><br><span class="line">                    <span class="keyword">return</span> false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="91、form表单提交前验证"><a href="#91、form表单提交前验证" class="headerlink" title="91、form表单提交前验证"></a>91、form表单提交前验证</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;login-form&quot;</span> onsubmit=<span class="string">&quot;return toVaild()&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">input</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;id_account&quot;</span> name=<span class="string">&quot;account&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> placeholder=<span class="string">&quot;账号&quot;</span>/&gt;</span><br><span class="line">&lt;<span class="built_in">input</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;id_password&quot;</span> name=<span class="string">&quot;password&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;password&quot;</span> placeholder=<span class="string">&quot;密码&quot;</span>&gt;</span><br><span class="line">&lt;form&gt;</span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    document.getElementById(<span class="string">&#x27;id_username&#x27;</span>).focus()</span><br><span class="line"></span><br><span class="line">    function toVaild() &#123;</span><br><span class="line">        var account = document.getElementById(<span class="string">&quot;id_account&quot;</span>).value;</span><br><span class="line">        var password = document.getElementById(<span class="string">&quot;id_password&quot;</span>).value;</span><br><span class="line">        <span class="keyword">if</span> (account == <span class="string">&quot;&quot;</span> || password == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            alert(<span class="string">&quot;请输入账号和密码&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> false;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="92、有序字典"><a href="#92、有序字典" class="headerlink" title="92、有序字典"></a>92、有序字典</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line">d1 = collections.OrderedDict()  <span class="comment"># 创建一个有序字典</span></span><br><span class="line">d1[<span class="string">&#x27;a&#x27;</span>] = <span class="string">&#x27;A&#x27;</span></span><br><span class="line">d1[<span class="string">&#x27;b&#x27;</span>] = <span class="string">&#x27;B&#x27;</span></span><br><span class="line">d1[<span class="string">&#x27;c&#x27;</span>] = <span class="string">&#x27;C&#x27;</span></span><br><span class="line">d1[<span class="string">&#x27;d&#x27;</span>] = <span class="string">&#x27;D&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> d1.items():</span><br><span class="line">    <span class="built_in">print</span>(k, v)</span><br></pre></td></tr></table></figure><h2 id="93、Python在Windows系统下实现TTS（文字转语音）"><a href="#93、Python在Windows系统下实现TTS（文字转语音）" class="headerlink" title="93、Python在Windows系统下实现TTS（文字转语音）"></a>93、Python在Windows系统下实现TTS（文字转语音）</h2><p>导入包：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install pypiwin32</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> win32com.client</span><br><span class="line">spk = win32com.client.Dispatch(<span class="string">&quot;SAPI.SpVoice&quot;</span>)</span><br><span class="line">spk.Speak(<span class="string">u&quot;my name is ldc,what is your name&quot;</span>)</span><br><span class="line">spk.Speak(<span class="string">u&quot;大家好&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="94、定义一个简单闹钟"><a href="#94、定义一个简单闹钟" class="headerlink" title="94、定义一个简单闹钟"></a>94、定义一个简单闹钟</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># pip install pypiwin32 -i https://pypi.python.org/simple</span></span><br><span class="line"><span class="keyword">import</span> win32com.client</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"><span class="keyword">import</span> winsound</span><br><span class="line"></span><br><span class="line">spk = win32com.client.Dispatch(<span class="string">&quot;SAPI.SpVoice&quot;</span>)</span><br><span class="line"><span class="comment"># 定义闹钟时间</span></span><br><span class="line">clocktime = [[<span class="number">19</span>, <span class="number">19</span>], [<span class="number">11</span>, <span class="number">10</span>], [<span class="number">12</span>, <span class="number">10</span>], [<span class="number">18</span>, <span class="number">47</span>]]  </span><br><span class="line">runinghour = <span class="number">1</span>  <span class="comment"># 定义运行时间</span></span><br><span class="line">times = runinghour * <span class="number">3600</span>  <span class="comment"># 次数</span></span><br><span class="line"><span class="built_in">print</span>(times)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, times):</span><br><span class="line">    time_now = [time.localtime(time.time()).tm_hour, time.localtime(time.time()).tm_min]</span><br><span class="line">    <span class="keyword">if</span> time_now <span class="keyword">in</span> clocktime:</span><br><span class="line">        <span class="built_in">print</span>(time_now)</span><br><span class="line">        winsound.Beep(<span class="number">1000</span>, <span class="number">1000</span>)</span><br><span class="line">        spk.Speak(<span class="string">u&quot;快去看下饭好了没有？&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">60</span>)  <span class="comment"># 每分钟对比一次时间</span></span><br></pre></td></tr></table></figure><h2 id="95、根据年月获取当月天数"><a href="#95、根据年月获取当月天数" class="headerlink" title="95、根据年月获取当月天数"></a>95、根据年月获取当月天数</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_month_days</span>(<span class="params">year, month</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    根据年份，月份信息显示此月份天数</span></span><br><span class="line"><span class="string">    :param year: 年份：</span></span><br><span class="line"><span class="string">    :param month: 月份（1～12）：</span></span><br><span class="line"><span class="string">    :return: 当月天数</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> month &gt;<span class="number">12</span> <span class="keyword">or</span> month &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> month == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">29</span> <span class="keyword">if</span> year % <span class="number">4</span> == <span class="number">0</span> <span class="keyword">and</span> year % <span class="number">100</span> != <span class="number">0</span> <span class="keyword">or</span> year % <span class="number">400</span> == <span class="number">0</span> <span class="keyword">else</span> <span class="number">28</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> month <span class="keyword">in</span> (<span class="number">4</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">30</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">31</span></span><br><span class="line"></span><br><span class="line">a = <span class="string">&#x27;2020-04&#x27;</span>.split(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">year = <span class="built_in">int</span>(a[<span class="number">0</span>])</span><br><span class="line">month = <span class="built_in">int</span>(a[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(get_month_days(year,month))</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure><h2 id="96、Django获取favicon-ico图标"><a href="#96、Django获取favicon-ico图标" class="headerlink" title="96、Django获取favicon.ico图标"></a>96、Django获取favicon.ico图标</h2><p>制作一个ico文件，使用PS或者某些在线生成ico的网站</p><p>将此文件命名为“favicon.ico”后放在static&#x2F;下</p><p><img src="https://img-blog.csdnimg.cn/20200805104730363.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>在urls.py中定义路由：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> RedirectView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line"><span class="comment"># 访问favicon.ico 网站图标</span></span><br><span class="line">    path(<span class="string">&quot;favicon.ico&quot;</span>,RedirectView.as_view(url=<span class="string">&#x27;static/favicon.ico&#x27;</span>)),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="97、django-静态文件配置"><a href="#97、django-静态文件配置" class="headerlink" title="97、django 静态文件配置"></a>97、django 静态文件配置</h2><p>settings.py</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br><span class="line"><span class="comment"># 添加静态资源路由地址</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">&#x27;static&#x27;</span>),</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"><span class="comment"># 使用python manage.py collectstatic收集静态文件时时使用STATIC_ROOT</span></span><br><span class="line"><span class="comment"># STATIC_ROOT = os.path.join(BASE_DIR, &#x27;static&#x27;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>urls.py</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> RedirectView</span><br><span class="line"><span class="keyword">from</span> django.views.static <span class="keyword">import</span> serve</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> <span class="string">&#x27;你的项目名称&#x27;</span> <span class="keyword">import</span> settings</span><br><span class="line">urlpatterns = [</span><br><span class="line">   </span><br><span class="line">    path(<span class="string">&quot;favicon.ico&quot;</span>,RedirectView.as_view(url=<span class="string">&#x27;static/favicon.ico&#x27;</span>)),</span><br><span class="line">    re_path(<span class="string">&#x27;static/(?P&lt;path&gt;.*)$&#x27;</span>, serve, &#123;<span class="string">&#x27;document_root&#x27;</span>: settings.STATICFILES_DIRS[<span class="number">0</span>]&#125;),</span><br><span class="line">    </span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="98、django-JsonResponse返回中文时显示unicode编码（-u67e5-u8be2）"><a href="#98、django-JsonResponse返回中文时显示unicode编码（-u67e5-u8be2）" class="headerlink" title="98、django JsonResponse返回中文时显示unicode编码（\u67e5\u8be2）"></a>98、django JsonResponse返回中文时显示unicode编码（\u67e5\u8be2）</h2><p>原因<br>这个unicode编码，是python3默认返回的编码。</p><p>解决方案<br>JsonResponse里面有个参数json_dumps_params，设置为json_dumps_params&#x3D;{‘ensure_ascii’:False}即可。</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = &#123;<span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;创建成功&#x27;</span>,&#125;</span><br><span class="line"><span class="keyword">return</span> JsonResponse(data=data, json_dumps_params=&#123;<span class="string">&#x27;ensure_ascii&#x27;</span>: <span class="literal">False</span>&#125;)</span><br></pre></td></tr></table></figure><h2 id="99、获取当前时间月份的首日与最后一天"><a href="#99、获取当前时间月份的首日与最后一天" class="headerlink" title="99、获取当前时间月份的首日与最后一天"></a>99、获取当前时间月份的首日与最后一天</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> calendar</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_month_start_and_end</span>(<span class="params">date=datetime.datetime.now(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    获取当前时间的月份首日与最后一天</span></span><br><span class="line"><span class="string">    :param date:</span></span><br><span class="line"><span class="string">    :return: (首日，最后一天)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    year, month = <span class="built_in">str</span>(date).split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>], <span class="built_in">str</span>(date).split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">    end = calendar.monthrange(<span class="built_in">int</span>(year), <span class="built_in">int</span>(month))[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;<span class="subst">&#123;year&#125;</span>-<span class="subst">&#123;month&#125;</span>-01&#x27;</span>, <span class="string">f&#x27;<span class="subst">&#123;year&#125;</span>-<span class="subst">&#123;month&#125;</span>-<span class="subst">&#123;end&#125;</span>&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="100、xadmin后台批量操作"><a href="#100、xadmin后台批量操作" class="headerlink" title="100、xadmin后台批量操作"></a>100、xadmin后台批量操作</h2><p>adminx.py</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xadmin</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span>  Sum</span><br><span class="line"><span class="keyword">from</span> xadmin.plugins.actions <span class="keyword">import</span> BaseActionView</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCountFeeAction</span>(<span class="title class_ inherited__">BaseActionView</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        用户余额统计</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">    action_name = <span class="string">&quot;countuserfee&quot;</span>  <span class="comment">#: 相当于这个 Action 的唯一标示, 尽量用比较针对性的名字</span></span><br><span class="line">    description = <span class="string">u&#x27;统计用户总余额&#x27;</span>  <span class="comment">#: 描述, 出现在 Action 菜单中, 可以使用 ``%(verbose_name_plural)s`` 代替 Model 的名字.</span></span><br><span class="line">    model_perm = <span class="string">&#x27;view&#x27;</span>  <span class="comment"># 权限</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_action</span>(<span class="params">self, queryset</span>):</span><br><span class="line">        all_balance = MallUser.objects.<span class="built_in">all</span>().aggregate(Sum(<span class="string">&#x27;balance&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">f&#x27;用户总余额<span class="subst">&#123;all_balance&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserAdmin</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;用户信息管理&quot;&quot;&quot;</span></span><br><span class="line">    list_display = [<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;balance&#x27;</span>, <span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;addtime&#x27;</span>]</span><br><span class="line">    search_fields = [<span class="string">&#x27;username&#x27;</span>, ]</span><br><span class="line">    list_filter = [<span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;addtime&#x27;</span>]</span><br><span class="line">    list_per_page = <span class="number">30</span>  <span class="comment"># 默认每页数量</span></span><br><span class="line">    model_icon = <span class="string">&#x27;fa fa-user&#x27;</span></span><br><span class="line">    list_editable = [<span class="string">&#x27;status&#x27;</span>]</span><br><span class="line">    ordering = [<span class="string">&#x27;-addtime&#x27;</span>]</span><br><span class="line">    actions = [ MyCountFeeAction]  <span class="comment"># 添加批量选择操作</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200812233442373.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="101、xadmin过滤器外键显示特定值（比如只能过滤自己与超级管理员定义的数据）"><a href="#101、xadmin过滤器外键显示特定值（比如只能过滤自己与超级管理员定义的数据）" class="headerlink" title="101、xadmin过滤器外键显示特定值（比如只能过滤自己与超级管理员定义的数据）"></a>101、xadmin过滤器外键显示特定值（比如只能过滤自己与超级管理员定义的数据）</h2><p>首先，修改xadmin源码，修改xadmin&#x2F;filters.py,在401行，做如下修改，</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">把self.lookup_choices = field.get_choices(include_blank=<span class="literal">False</span>)</span><br><span class="line">改为：</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用自定义的方法</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">hasattr</span>(model_admin, <span class="string">&#x27;&#123;field&#125;_choices&#x27;</span>.<span class="built_in">format</span>(field=field.name)):</span><br><span class="line">        self.lookup_choices = <span class="built_in">getattr</span>(model_admin, <span class="string">&#x27;&#123;field&#125;_choices&#x27;</span>.<span class="built_in">format</span>(field=field.name))(field, request,params, model,model_admin,field_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.lookup_choices = field.get_choices(include_blank=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>如图:</p><p><img src="https://img-blog.csdnimg.cn/20200812234011656.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>然后，在adminx.py中定义过滤的方法：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xadmin</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span>  Q, Sum</span><br><span class="line"><span class="keyword">from</span> xadmin.plugins.actions <span class="keyword">import</span> BaseActionView</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MeasurePointAdmin</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="comment"># search_fields = [&#x27;user__name&#x27;, &#x27;user__account&#x27;]  # 检索字段</span></span><br><span class="line">    list_display = [<span class="string">&#x27;num&#x27;</span>, <span class="string">&#x27;elevation&#x27;</span>, <span class="string">&#x27;correct_num&#x27;</span>, <span class="string">&#x27;cumulative_amount&#x27;</span>]</span><br><span class="line">    list_filter = [<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;is_default&#x27;</span>, <span class="string">&#x27;create_time&#x27;</span>]  <span class="comment"># 分组过滤的字段</span></span><br><span class="line">    list_editable = [<span class="string">&#x27;num&#x27;</span>, <span class="string">&#x27;elevation&#x27;</span>, <span class="string">&#x27;correct_num&#x27;</span>, <span class="string">&#x27;cumulative_amount&#x27;</span>]</span><br><span class="line">    ordering = (<span class="string">&#x27;id&#x27;</span>,)  <span class="comment"># 设置默认排序字段，负号表示降序排序</span></span><br><span class="line">    list_per_page = <span class="number">30</span>  <span class="comment"># 默认每页显示多少条记录，默认是100条</span></span><br><span class="line">    model_icon = <span class="string">&#x27;fa fa-users&#x27;</span>  <span class="comment"># 左侧小图标</span></span><br><span class="line">    readonly_fields = [<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;is_default&#x27;</span>]</span><br><span class="line">    import_excel = <span class="literal">True</span></span><br><span class="line">    actions = [MyCountFeeAction]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义的函数名必须是  字段名_choices</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">user_choices</span>(<span class="params">self, field, request, params, model, model_admin, field_path</span>):</span><br><span class="line">        <span class="comment"># 超级用户不做控制</span></span><br><span class="line">        <span class="keyword">if</span> self.request.user.is_superuser:</span><br><span class="line">            <span class="keyword">return</span> field.get_choices(include_blank=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 过滤器只显示自己与超级管理员</span></span><br><span class="line">        user_lst = field.related_model._default_manager.<span class="built_in">filter</span>(Q(<span class="built_in">id</span>=self.request.user.<span class="built_in">id</span>) | Q(is_superuser=<span class="literal">True</span>))</span><br><span class="line">        <span class="comment"># 返回格式 [(&#x27;pk&#x27;,&#x27;标题&#x27;),]</span></span><br><span class="line">        <span class="keyword">return</span> [(user.<span class="built_in">id</span>, user.username) <span class="keyword">for</span> user <span class="keyword">in</span> user_lst]</span><br></pre></td></tr></table></figure><p>效果:</p><p><img src="https://img-blog.csdnimg.cn/2020081223440761.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xtX2lzX2Rj,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h2 id="102、Django中的CSRF局部禁用"><a href="#102、Django中的CSRF局部禁用" class="headerlink" title="102、Django中的CSRF局部禁用"></a>102、Django中的CSRF局部禁用</h2><p>为了避免没有csrf token而产生的403的forbidden错误，可以使用csrf_exempt装饰器来处理POST、GET请求的View, 这种方式是CSRF局部禁用。</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.decorators <span class="keyword">import</span> method_decorator</span><br><span class="line"><span class="keyword">from</span> django.views.decorators.csrf <span class="keyword">import</span> csrf_exempt</span><br><span class="line"></span><br><span class="line"><span class="meta">@method_decorator(<span class="params">csrf_exempt</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_data</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">elif</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="103、使用python命令创建django项目"><a href="#103、使用python命令创建django项目" class="headerlink" title="103、使用python命令创建django项目"></a>103、使用python命令创建django项目</h2><p>创建django项目<br>方式一：直接打开pycharm创建，选择file-&gt;new project-&gt;django<br>方式二：通过命令创建<br>先创建虚拟环境：python -m venv django_venv<br>然后导入django库：pip install django -i <a href="https://pypi.tuna.tsinghua.edu.cn/simple">https://pypi.tuna.tsinghua.edu.cn/simple</a><br>最后使用命令创建：django-admin startproject my_django_project</p><h2 id="104、-二维列表、二维数组行求和与列求和"><a href="#104、-二维列表、二维数组行求和与列求和" class="headerlink" title="104、 二维列表、二维数组行求和与列求和"></a>104、 二维列表、二维数组行求和与列求和</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 二维数组，对列和行求和</span></span><br><span class="line">a = [</span><br><span class="line">    [<span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="number">4.1</span>],</span><br><span class="line">    [<span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">4</span>],</span><br><span class="line">    [<span class="string">&#x27;123&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>,<span class="number">7</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aa</span>(<span class="params">x, y</span>):</span><br><span class="line">    x = <span class="number">0</span> <span class="keyword">if</span> <span class="built_in">isinstance</span>(x, <span class="built_in">str</span>) <span class="keyword">else</span> x</span><br><span class="line">    y = <span class="number">0</span> <span class="keyword">if</span> <span class="built_in">isinstance</span>(y, <span class="built_in">str</span>) <span class="keyword">else</span> y</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对行求和</span></span><br><span class="line">row_sum = [reduce(aa, i) <span class="keyword">for</span> i <span class="keyword">in</span> a]</span><br><span class="line"><span class="comment"># 对列求和，只能处理相同长度的子元素</span></span><br><span class="line">column_sum_1 = [reduce(aa, i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">zip</span>(*a)]</span><br><span class="line"><span class="comment"># 对列求和，可以处理不同长度的子元素</span></span><br><span class="line">column_sum_2 = <span class="built_in">list</span>(<span class="built_in">dict</span>(pd.DataFrame(a).fillna(<span class="number">0</span>).apply(<span class="keyword">lambda</span> x: <span class="string">&#x27;&#x27;</span> <span class="keyword">if</span> <span class="built_in">any</span>(<span class="built_in">isinstance</span>(d, <span class="built_in">str</span>) <span class="keyword">for</span> d <span class="keyword">in</span> x) <span class="keyword">else</span> <span class="built_in">round</span>(x.<span class="built_in">sum</span>(), <span class="number">2</span>))).values())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;行求和：&#123;&#125;\r\n列求和(相同长度)：&#123;&#125;\r\n列求和：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(row_sum, column_sum_1, column_sum_2))</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">行求和：[<span class="number">5.1</span>, <span class="number">4</span>, <span class="number">20</span>]</span><br><span class="line">列求和(相同长度)：[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">12.1</span>]</span><br><span class="line">列求和：[<span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">12.1</span>, <span class="number">6.0</span>, <span class="number">7.0</span>]</span><br></pre></td></tr></table></figure><h2 id="105、获取时间字符串的月份数"><a href="#105、获取时间字符串的月份数" class="headerlink" title="105、获取时间字符串的月份数"></a>105、获取时间字符串的月份数</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_months</span>(<span class="params">start_month_str, end_month_str</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    # 获取时间字符串中的月份数</span></span><br><span class="line"><span class="string">    :param start_month_str: 开始字符串</span></span><br><span class="line"><span class="string">    :param end_month_str: 结束字符串</span></span><br><span class="line"><span class="string">    :return: 月份数</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    end_month_date = datetime.strptime(end_month_str, <span class="string">&#x27;%Y-%m&#x27;</span>)</span><br><span class="line">    start_month_date = datetime.strptime(start_month_str, <span class="string">&#x27;%Y-%m&#x27;</span>)</span><br><span class="line">    end_year, end_month = end_month_date.year, end_month_date.month</span><br><span class="line">    start_year, start_month = start_month_date.year, start_month_date.month</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (end_year - start_year) *<span class="number">12</span> + (end_month - start_month) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">end_month_str = <span class="string">&#x27;2021-02&#x27;</span></span><br><span class="line">start_month_str = <span class="string">&#x27;2020-07&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(get_months(start_month_str, end_month_str))</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"></span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure><h2 id="106、字符串不足补零"><a href="#106、字符串不足补零" class="headerlink" title="106、字符串不足补零"></a>106、字符串不足补零</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;hello world&#x27;</span>.zfill(<span class="number">15</span>)) <span class="comment"># 补0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;hello world&#x27;</span>.rjust(<span class="number">15</span>)) <span class="comment"># 右对齐，补空格</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;hello world&#x27;</span>.ljust(<span class="number">15</span>)) <span class="comment"># 左对齐，补空格</span></span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"></span><br><span class="line">0000hello world</span><br><span class="line">    hello world</span><br><span class="line">hello world  </span><br></pre></td></tr></table></figure><h2 id="107、时间戳转字符串日期"><a href="#107、时间戳转字符串日期" class="headerlink" title="107、时间戳转字符串日期"></a>107、时间戳转字符串日期</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">t1 = time.time()</span><br><span class="line"><span class="built_in">print</span>(t1)</span><br><span class="line"><span class="built_in">print</span>(time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime(t1)))</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"><span class="number">1621741567.082192</span></span><br><span class="line"><span class="number">2021</span>-05-<span class="number">23</span> <span class="number">11</span>:<span class="number">46</span>:07</span><br></pre></td></tr></table></figure><p>使用函数：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@contact: 微信 1257309054</span></span><br><span class="line"><span class="string">@file: 时间戳转日期.py</span></span><br><span class="line"><span class="string">@time: 2022/6/27 17:16</span></span><br><span class="line"><span class="string">@author: LDC</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确10位长度的时间戳可精确到秒，11-14位长度则是包含了毫秒</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">int_to_datetime</span>(<span class="params">intValue</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">str</span>(intValue)) == <span class="number">10</span>:</span><br><span class="line">        <span class="comment"># 精确到秒</span></span><br><span class="line">        timeValue = time.localtime(intValue)</span><br><span class="line">        tempDate = time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, timeValue)</span><br><span class="line">        datetimeValue = datetime.datetime.strptime(tempDate, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="number">10</span> &lt; <span class="built_in">len</span>(<span class="built_in">str</span>(intValue)) <span class="keyword">and</span> <span class="built_in">len</span>(<span class="built_in">str</span>(intValue)) &lt; <span class="number">15</span>:</span><br><span class="line">        <span class="comment"># 精确到毫秒</span></span><br><span class="line">        k = <span class="built_in">len</span>(<span class="built_in">str</span>(intValue)) - <span class="number">10</span></span><br><span class="line">        timetamp = datetime.datetime.fromtimestamp(intValue / (<span class="number">1</span> * <span class="number">10</span> ** k))</span><br><span class="line">        datetimeValue = timetamp.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S.%f&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> datetimeValue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">time1 = <span class="number">1656321420</span></span><br><span class="line">time2 = <span class="number">1656321086560</span></span><br><span class="line"><span class="built_in">print</span>(int_to_datetime(time1))</span><br><span class="line"><span class="built_in">print</span>(int_to_datetime(time2))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">输出：</span></span><br><span class="line"><span class="string">2022-06-27 17:17:00</span></span><br><span class="line"><span class="string">2022-06-27 17:11:26.560000</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="108、列表转字符串"><a href="#108、列表转字符串" class="headerlink" title="108、列表转字符串"></a>108、列表转字符串</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;,&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>,a)))</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">`<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>`</span><br></pre></td></tr></table></figure><h2 id="109、pip国内镜像源"><a href="#109、pip国内镜像源" class="headerlink" title="109、pip国内镜像源"></a>109、pip国内镜像源</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install 库名 -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">清华：-i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"></span><br><span class="line">阿里云：-i http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line"></span><br><span class="line">中国科技大学 -i https://pypi.mirrors.ustc.edu.cn/simple/</span><br><span class="line"></span><br><span class="line">华中理工大学：-i http://pypi.hustunique.com/</span><br><span class="line"></span><br><span class="line">山东理工大学：-i http://pypi.sdutlinux.org/ </span><br><span class="line"></span><br><span class="line">豆瓣：-i http://pypi.douban.com/simple/</span><br></pre></td></tr></table></figure><h2 id="110、python把时间字符串转换成刚刚、1天前、3个月前、1年前"><a href="#110、python把时间字符串转换成刚刚、1天前、3个月前、1年前" class="headerlink" title="110、python把时间字符串转换成刚刚、1天前、3个月前、1年前"></a>110、python把时间字符串转换成刚刚、1天前、3个月前、1年前</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">date_interval</span>(<span class="params">date_str</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    获取时间间隔</span></span><br><span class="line"><span class="string">    1分钟前，2分钟前，10分钟前，1小时前，2小时前，1天前，2天前，3天前，1个月前，3个月前，1年前，3年前</span></span><br><span class="line"><span class="string">    :param date_str: 时间字符串</span></span><br><span class="line"><span class="string">    :return: 字符串</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    date_str = time.strptime(date_str, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">    <span class="comment"># 将时间元组转换为时间戳</span></span><br><span class="line">    t = time.mktime(date_str)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 当前时间</span></span><br><span class="line">    seconds = time.time() - t</span><br><span class="line"></span><br><span class="line">    years = <span class="built_in">int</span>(seconds // (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">365</span>))</span><br><span class="line">    <span class="keyword">if</span> years:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#123;&#125;年前&#x27;</span>.<span class="built_in">format</span>(years)</span><br><span class="line">    months = <span class="built_in">int</span>(seconds // (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span>))</span><br><span class="line">    <span class="keyword">if</span> months:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#123;&#125;月前&#x27;</span>.<span class="built_in">format</span>(months)</span><br><span class="line">    days = <span class="built_in">int</span>(seconds // (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>))</span><br><span class="line">    <span class="keyword">if</span> days:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#123;&#125;天前&#x27;</span>.<span class="built_in">format</span>(days)</span><br><span class="line">    hours = <span class="built_in">int</span>(seconds // (<span class="number">60</span> * <span class="number">60</span>))</span><br><span class="line">    <span class="keyword">if</span> hours:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#123;&#125;小时前&#x27;</span>.<span class="built_in">format</span>(hours)</span><br><span class="line">    minutes = <span class="built_in">int</span>(seconds // (<span class="number">60</span>))</span><br><span class="line">    <span class="keyword">if</span> minutes:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#123;&#125;分钟前&#x27;</span>.<span class="built_in">format</span>(minutes)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;刚刚&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    date1 = <span class="string">&#x27;2019-07-10 15:27:51&#x27;</span></span><br><span class="line">    date2 = <span class="string">&#x27;2021-07-10 15:27:51&#x27;</span></span><br><span class="line">    date3 = <span class="string">&#x27;2021-08-10 15:27:51&#x27;</span></span><br><span class="line">    date4 = <span class="string">&#x27;2021-08-12 11:01:51&#x27;</span></span><br><span class="line">    date5 = datetime.datetime.now() + datetime.timedelta(seconds=-<span class="number">3</span>)</span><br><span class="line">    date5 = date5.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(date_interval(date1))</span><br><span class="line">    <span class="built_in">print</span>(date_interval(date2))</span><br><span class="line">    <span class="built_in">print</span>(date_interval(date3))</span><br><span class="line">    <span class="built_in">print</span>(date_interval(date4))</span><br><span class="line">    <span class="built_in">print</span>(date_interval(date5))</span><br></pre></td></tr></table></figure><h2 id="111、Django使用ORM执行sql语句"><a href="#111、Django使用ORM执行sql语句" class="headerlink" title="111、Django使用ORM执行sql语句"></a>111、Django使用ORM执行sql语句</h2><p>通过raw函数执行</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">alarm_datas = gsm.AlertMessage.objects.raw(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                select am_all.id, am_all.sensor_number</span></span><br><span class="line"><span class="string">                    FROM alert_message as am_all</span></span><br><span class="line"><span class="string">                    where </span></span><br><span class="line"><span class="string">                        am_all.real=&#x27;1&#x27;</span></span><br><span class="line"><span class="string">                        and am_all.is_show=1</span></span><br><span class="line"><span class="string">                    order by am_all.alarm_level desc</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> ad <span class="keyword">in</span> alarm_datas:</span><br><span class="line"><span class="built_in">print</span>(ad.sensor_number)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="112、Django通过变量字段获取数据"><a href="#112、Django通过变量字段获取数据" class="headerlink" title="112、Django通过变量字段获取数据"></a>112、Django通过变量字段获取数据</h2><p>通过方法<code>__getattribute__</code>来获取</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">alert_messages = AlertMessage.objects.<span class="built_in">filter</span>(real=<span class="number">0</span>)</span><br><span class="line">am_fields = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;real&#x27;</span>, <span class="string">&#x27;name&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> am <span class="keyword">in</span> alert_messages:</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(am_fields)):</span><br><span class="line"><span class="built_in">print</span>(am_fields[i], am.__getattribute__(am_fields[i]))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="113、Django查询变量字段、更新变量字段"><a href="#113、Django查询变量字段、更新变量字段" class="headerlink" title="113、Django查询变量字段、更新变量字段"></a>113、Django查询变量字段、更新变量字段</h2><p>通过<code>**&#123;变量名:值&#125;</code>来操作</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">field = <span class="string">&#x27;device_code&#x27;</span></span><br><span class="line"><span class="comment"># 查询</span></span><br><span class="line">device_infos = gsm.DeviceInfo.objects.<span class="built_in">filter</span>(**&#123;field: <span class="string">&#x27;012&#x27;</span>&#125;)</span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line">gsm.DeviceInfo.objects.<span class="built_in">filter</span>(device_code=<span class="string">&#x27;012&#x27;</span>).update(**&#123;field : <span class="string">&#x27;0&#x27;</span>&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="114、vue生成dist文件"><a href="#114、vue生成dist文件" class="headerlink" title="114、vue生成dist文件"></a>114、vue生成dist文件</h2><p>安装npm，到<a href="https://nodejs.org/en/download/">官网下载</a><br>在vue项目下打开cmd，输入命令</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><p>如果报错，npm ERR! missing script: build，<br>则使用以下命令</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">npm run build:prod</span><br></pre></td></tr></table></figure><p>具体看package.json</p><p><img src="https://img-blog.csdnimg.cn/eff15dcd4c1d499f9641d0ac25c09bc0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5Lic5pyo5pyI,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p><h2 id="115、python获取电脑磁盘、CPU、内存使用情况"><a href="#115、python获取电脑磁盘、CPU、内存使用情况" class="headerlink" title="115、python获取电脑磁盘、CPU、内存使用情况"></a>115、python获取电脑磁盘、CPU、内存使用情况</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"><span class="comment">#  pip install psutil</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取本机磁盘使用率和剩余空间G信息</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_disk_info</span>():</span><br><span class="line">    <span class="comment"># 循环磁盘分区</span></span><br><span class="line">    content = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> disk <span class="keyword">in</span> psutil.disk_partitions():</span><br><span class="line">        <span class="comment"># 读写方式 光盘 or 有效磁盘类型</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;cdrom&#x27;</span> <span class="keyword">in</span> disk.opts <span class="keyword">or</span> disk.fstype == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        disk_name_arr = disk.device.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">        disk_name = disk_name_arr[<span class="number">0</span>]</span><br><span class="line">        disk_info = psutil.disk_usage(disk.device)</span><br><span class="line">        <span class="comment"># 磁盘剩余空间，单位G</span></span><br><span class="line">        free_disk_size = disk_info.free//<span class="number">1024</span>//<span class="number">1024</span>//<span class="number">1024</span></span><br><span class="line">        <span class="comment"># 当前磁盘使用率和剩余空间G信息</span></span><br><span class="line">        info = <span class="string">&quot;&#123;&#125;盘使用率：&#123;&#125;%%， 剩余空间：&#123;&#125;G &quot;</span>.<span class="built_in">format</span>(disk_name, <span class="built_in">str</span>(disk_info.percent), free_disk_size)</span><br><span class="line">        <span class="comment"># 拼接多个磁盘的信息</span></span><br><span class="line">        content = content + info</span><br><span class="line">    <span class="built_in">print</span>(content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># cpu信息</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_cpu_info</span>():</span><br><span class="line">    cpu_percent = psutil.cpu_percent(interval=<span class="number">1</span>)</span><br><span class="line">    cpu_info = <span class="string">&quot;CPU使用率：%i%%&quot;</span> % cpu_percent</span><br><span class="line">    <span class="built_in">print</span>(cpu_info)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内存信息</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_memory_info</span>():</span><br><span class="line">    virtual_memory = psutil.virtual_memory()</span><br><span class="line">    used_memory = virtual_memory.used/<span class="number">1024</span>/<span class="number">1024</span>/<span class="number">1024</span></span><br><span class="line">    free_memory = virtual_memory.free/<span class="number">1024</span>/<span class="number">1024</span>/<span class="number">1024</span></span><br><span class="line">    memory_percent = virtual_memory.percent</span><br><span class="line">    memory_info = <span class="string">&quot;内存使用：%0.2fG，使用率%0.1f%%，剩余内存：%0.2fG&quot;</span> % (used_memory, memory_percent, free_memory)</span><br><span class="line">    <span class="built_in">print</span>(memory_info)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    get_disk_info()</span><br><span class="line">    get_cpu_info()</span><br><span class="line">    get_memory_info()</span><br></pre></td></tr></table></figure><h2 id="116、max比较字典列表"><a href="#116、max比较字典列表" class="headerlink" title="116、max比较字典列表"></a>116、max比较字典列表</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">使用max函数比较字典列表对象</span></span><br><span class="line"><span class="string">需求：找出用户组最大id的字典</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">com_id</span>(<span class="params">f</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    比较用用户ids列表</span></span><br><span class="line"><span class="string">    :param f: 字典</span></span><br><span class="line"><span class="string">    :return: 返回最大的用户id</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(f[<span class="string">&#x27;user_ids&#x27;</span>])</span><br><span class="line"></span><br><span class="line">friends_added = [</span><br><span class="line">        &#123;<span class="string">&#x27;user_ids&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>], <span class="string">&#x27;create_at&#x27;</span>: <span class="string">&#x27;2020-01-01&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;user_ids&#x27;</span>: [<span class="number">3</span>, <span class="number">6</span>], <span class="string">&#x27;create_at&#x27;</span>: <span class="string">&#x27;2020-01-02&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;user_ids&#x27;</span>: [<span class="number">2</span>, <span class="number">1</span>], <span class="string">&#x27;create_at&#x27;</span>: <span class="string">&#x27;2020-02-02&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;user_ids&#x27;</span>: [<span class="number">4</span>, <span class="number">1</span>], <span class="string">&#x27;create_at&#x27;</span>: <span class="string">&#x27;2020-02-02&#x27;</span>&#125;,</span><br><span class="line">    ]</span><br><span class="line"><span class="comment"># max函数中使用key参数，指定自定义函数来比较</span></span><br><span class="line">item = <span class="built_in">max</span>(friends_added, key=com_id)</span><br><span class="line">item_1 = <span class="built_in">max</span>(friends_added, key=<span class="keyword">lambda</span> f: <span class="built_in">max</span>(f[<span class="string">&#x27;user_ids&#x27;</span>])) <span class="comment"># com_id可以转成lambda函数</span></span><br><span class="line"><span class="built_in">print</span>(item)</span><br><span class="line"><span class="built_in">print</span>(item_1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;user_ids&#x27;</span>: [<span class="number">3</span>, <span class="number">6</span>], <span class="string">&#x27;create_at&#x27;</span>: <span class="string">&#x27;2020-01-02&#x27;</span>&#125;</span><br><span class="line">&#123;<span class="string">&#x27;user_ids&#x27;</span>: [<span class="number">3</span>, <span class="number">6</span>], <span class="string">&#x27;create_at&#x27;</span>: <span class="string">&#x27;2020-01-02&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="117、django查询表的具体字段"><a href="#117、django查询表的具体字段" class="headerlink" title="117、django查询表的具体字段"></a>117、django查询表的具体字段</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ExampleModel.objects.values(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;username&#x27;</span>)</span><br><span class="line"><span class="comment"># 返回的结果是QuerySet， 里面的元素是dict格式</span></span><br><span class="line"><span class="comment"># [&#123;&#x27;id&#x27;:1, &#x27;username&#x27;: &#x27;Austin&#x27;&#125;, &#123;&#x27;id&#x27;:2, &#x27;username&#x27;:&#x27;Sam&#x27;&#125;, ...]</span></span><br><span class="line"><span class="comment"># 相当于SQL中的SELECT id, username FROM ......, </span></span><br><span class="line"><span class="comment"># 只返回对应属性（字段）的值</span></span><br></pre></td></tr></table></figure><h2 id="118、MySQL查询数据添加自增序号"><a href="#118、MySQL查询数据添加自增序号" class="headerlink" title="118、MySQL查询数据添加自增序号"></a>118、MySQL查询数据添加自增序号</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> @i = <span class="number">0</span>;</span><br><span class="line">select waveform, <span class="string">&#x27;沿桥风吹&#x27;</span> <span class="keyword">as</span> label ,(@i:=@i+<span class="number">1</span>) xh <span class="keyword">from</span> alert_message where is_real=<span class="number">1</span> <span class="keyword">and</span> node_id=<span class="number">138</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="119、MySQL-时间截取年月日"><a href="#119、MySQL-时间截取年月日" class="headerlink" title="119、MySQL 时间截取年月日"></a>119、MySQL 时间截取年月日</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">select <span class="built_in">id</span>,</span><br><span class="line">addtime, </span><br><span class="line">date_format(addtime,<span class="string">&#x27;%Y-%m-%d&#x27;</span>) <span class="keyword">as</span> short_time </span><br><span class="line"><span class="keyword">from</span> alert_message </span><br><span class="line">where date_format(addtime,<span class="string">&#x27;%Y-%m-%d&#x27;</span>) = <span class="string">&#x27;2022-03-13&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/37cec67fa1e1458f9aba1b745600a493.png" alt="在这里插入图片描述"></p><h2 id="120、-列表取奇数下标值"><a href="#120、-列表取奇数下标值" class="headerlink" title="120、 列表取奇数下标值"></a>120、 列表取奇数下标值</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">list1=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;奇数下标值&#x27;</span>,list1[<span class="number">1</span>::<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"></span><br><span class="line">奇数下标值 [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="121、列表取偶数下标值"><a href="#121、列表取偶数下标值" class="headerlink" title="121、列表取偶数下标值"></a>121、列表取偶数下标值</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">list1=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;偶数下标值&#x27;</span>,list1[::<span class="number">2</span>])</span><br><span class="line">偶数下标值 [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;e&#x27;</span>]</span><br></pre></td></tr></table></figure><h2 id="122、列表相同元素分类、分组"><a href="#122、列表相同元素分类、分组" class="headerlink" title="122、列表相同元素分类、分组"></a>122、列表相同元素分类、分组</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">data = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">a =[<span class="built_in">list</span>(group) <span class="keyword">for</span> key, group <span class="keyword">in</span> itertools.groupby(data)]</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>], [<span class="number">1</span>], [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>]]</span><br></pre></td></tr></table></figure><h2 id="123、ubuntu切换用户"><a href="#123、ubuntu切换用户" class="headerlink" title="123、ubuntu切换用户"></a>123、ubuntu切换用户</h2><p>1）从user用户切换到root用户<br>sudo su<br>2）从root用户切回user用户<br>su user (user是你自己安装时候的用户名)，或是直接输入exit，也可Ctrl+D组合键推出</p><h2 id="124、numpy二维数组获取某一列"><a href="#124、numpy二维数组获取某一列" class="headerlink" title="124、numpy二维数组获取某一列"></a>124、numpy二维数组获取某一列</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">a = [</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">    [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>],</span><br><span class="line">    [<span class="number">13.2</span>, <span class="number">14.8</span>, <span class="number">15.9</span>, <span class="number">16.10</span>, <span class="number">16.11</span>, <span class="number">17.12</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">a_np = np.array(a)  <span class="comment"># 把二维列表转成numpy数组</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;第一行&#x27;</span>, a_np[<span class="number">0</span>].tolist())  <span class="comment"># 获取第一行</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;第一列&#x27;</span>, a_np[:, <span class="number">0</span>].tolist())  <span class="comment"># 获取第一列</span></span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"></span><br><span class="line">第一行 [<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>, <span class="number">6.0</span>]</span><br><span class="line">第一列 [<span class="number">1.0</span>, <span class="number">7.0</span>, <span class="number">13.2</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
